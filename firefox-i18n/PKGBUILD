pkgname=firefox-i18n
pkgver=43.0.4
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
)

pkgname=('firefox-i18n')
source=()
_url=https://download-installer.cdn.mozilla.net/pub/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('dd50f1ed0bb838b96d818148d8ef7345a31153951e972fac29bcfd953b3b4ffc'
            '5f7f10a08b43cd36234a0e53babc21171deb1ebc9b6746d431258891e9122725'
            'd55447d434d724ee1f1155931daf8edaeca0dc5bc78520502bee37825ff3101d'
            '1cf1994a374d168b2a342c02b780498903de6967c1d44ec60244a73666606d6b'
            '05747452729e5bf2aac0b27e72e88bad70b381d58a64bcafb71b65cbbcc02ac8'
            '073e9de79f2113c20ceba2ad4c9f1736099a57f15404f8cbce96c2108890bccb'
            'f978413b00a3a296181da028d9823908eaf6544ad3cdbd984cebd1485f58e1bc'
            '6be0efa8de5bdf9e41e4a3b37d032d55eb0f5dee7101175f0b266d1e627e7ba0'
            'fd4e4bcdc37218c17a8a236eb9175ed9567db99e13f20bcf4bd2abe5c13624a4'
            '7a9af62ee37bf04d45dc376e0ce01eec9c5379c49b95b505c79df4f94abe1188'
            '52fe3246f17ebe6fb353446ca85af796a3b478ee22f89f3e83c05ac6bfa9db48'
            '5bcf2f957724b61658e4eb3b299dcf22c9c73ab35d330cb6f1566d3673839ca0'
            '7d4379dc3df84449ae1b131811726d0d9856819f6cc48c3d7375d4cee069f8be'
            '3c7dbe3319e0998d474aaabe3a7ffdadf0078913656ce8524cea948cbd180507'
            '55b172d9c059c3a5a1c13cad241ebea9542eda3de10179003d289254fd2e9cec'
            'be141e2110ae864940cc527fb41e4ab4536d9000684c1c686387eaf1b599cc93'
            'afce11d16757c5cf0aeb8d9a86d46013750548457a373efcae9685ee2795ceec'
            'e2dceff32ea3df23035ac589da6ec00efecadb119afcba5bbe659b3ec4354c7d'
            '4ae90e2b7156f22b3b5dcfd0de44d80bf29f55d238079ca23a7eaad01a5fa0c8'
            'a316ba1349ccb7f6403c3bab2a5627b9415671a142025a8a0b1b0d87236e887e'
            'a66df785414853c8f48292dda9698ca9f63475c58a7ed3dcdb04364dec42fb6d'
            'e642f283efbe6297bf22e284a3aae21a663915af6542ba3eb32472f08c6e80cd'
            'a38c00778d13fca705b723c9bc7f806500cf97fa7cb3c5edd77448bdf8ccc3b5'
            'b127347dfe68fd5e1b630e43c9ceb2ff3b1f91571d8e7c6d3b08dd0dade057e6'
            'da5e4289bafd45cdf85ce23d43a2e420553112361f7c2c66ee6f03d85f7decc9'
            'ed372755f8add4bb05422cddd44c01b940a7d3160734aa2644da8a3258a93fb1'
            '8418c0d32f0fd4a862ee888bfcc6ea23e20d0bcadfde38988a66f09d4fc4d60d'
            'cbb8b5f2280bfb9b629cb8065ccaefd2ae915dca7d2ef5c39ec11549111ded18'
            '5035cfcc8eabb1826c3e65801928fcb344093397d82ebbea148ef182f928933e'
            '5cb04224a8dfd697f64eb19e20d03e48a0610a880085722f505448d06179e1c2'
            '7712b2d1f7f5f9bef47fd1ac966f42047bc2ead9a6ecc40ff9a5e72a07a06787'
            'fe421ecb71a6c0df8aed237548decee33beae8acbd8f2eb96047721e11330dd3'
            '2ac483171b09fca1a201474466b97e220b82b6c7721e6f410fce5ba226b0e161'
            'b043975f4efa5419f79487983e00651dcfda57bf781197554001393b645c5ba9'
            '16cec9732881e478d8cd2b1ff307dc4df359d12a17fd9bdc5ab7c26df8445590'
            '2efa335929623ba3934b90649e008c34cbc346c857a92a2aa7b87d913054cca6'
            'dca866d967421296928ecd619ccaf882177cea41e6e41dcdb28e1483f496db90'
            'e3d8c5ed0d83d11d940edf9e0f41f10c5d89f98a3143f8b24d117af082224179'
            '474c2ee9574597fbed40b2b7f35687c02a00a7479c309245179f372a8f77040b'
            '2c0810e96f8f14703299c741aea6a953073db08732766cc051f97398cf6217f4'
            '29e62fccab5ab4e90f97ecb36051560e261f7bc54192e34fab9a802a6eeae17b'
            '5e3dfde9bbf44161f53b22c642457c3309af642d316dc1fb4f22d33964670327'
            'f7b884fc238085ad2590472ba420b17c8138c9bc98314d9e395df729cc4a1dd2'
            '6ee13fe83352d3f614fff3bde477d0d04ffd7fa3b134d2eaa1e8ee3376a7cfd9'
            '639b20adaa0bcd48bc3caa8da143f9ca483df63593d0043c796216cd7985510b'
            '8450cc6f8d7009b0af50a3701260b64609f4dfb52cfd69fa3a454b908d4760b8'
            '256e8067420f8d1fba27862ee92b93650367b957901e00b68947e0140548a33f'
            '4eb94a7e30389d68453f582f64c9e7e37135c97d91359804159cbb14c2fd147f'
            '0354cc76d5d4cf6a4f3b35c9acb022291087fd49263e58e9befbcbe31d45ab83'
            'b764d1cf4c901ddf9ee88cd119024a68986c5340137aedcd31a513ba1342ef94'
            'c48a84f717491a7dd7c80d66f106c60c1ed9d92cf3df45c8ee5e007aea612fe0'
            'efbca775303af64478fa16186e91cc14a54f832e9dde8f2dfb489004d3648b6a'
            'aaedddee4532c89580eadb3fed6cea723ab947503f56304917f064b9144cb25c'
            '3d62502c284a8a737fa45410e1ef7c3001afc0fc29cd2a86f633d054316cc03e'
            '3f633939211ead89ca62ccc23539592d4d54117c5125798472bbbaae6d8eac06'
            '61d913e28f772ef9b6fcfb7830c4ff1381a8c3371b8e52301b76376d6d3311ab'
            '221659f99a8e5ae8d57ff3d0fd6a3fa7cf345b6f0e53ede47dfca1f00f75bcd8'
            '7ad155c06ce8155a61ce66a49c598eda006ce96d2ab22a29aaa7aa1892c434e1'
            '06289814689c96c7a31a0e288f117791f33d1949f579e8a1a543145db863891c'
            '04eb0fb4dbb34ce9da0e17a2d9954301e823c00d49dba4c95fa9c143b0c0fbc0'
            '09035f96e79325208ce6798dd62e9cc1880b28a9867e624b9c5e1cbddfb308bc'
            '4781578d5a66e99c7fda682990393cab0b31c6182438f44c03459a756db22394'
            '1975d8580c232aac4ce4bd8ec5fdf28c28eeb12c532345f2a4a3b916b97e069a'
            'bbb28e5c2434926328e42de497db7be06f606e7fc56a3f302851c65a47c5d4c6'
            '3eabad802630ebeb024f6dcbb6bc39a60881a99a84b24e8b859eb8d07dcb344a'
            '1d0c03800d0b6385c4ff03e1208063e8f44285f6c066245cf2f66d250faf2998'
            '0967a1a9f37c325389156e0f39ebd1cb8c59f85049ea855a073f4cdbd831d257'
            '6837c5599eed1c014f36bee1dde4f67e9f26f9167e39d9055d0fb5dc8b321e93'
            '672fa646ddb5a05a3637b0d0dfa4d4fdd0f1ff28eb50c42b41e52afa19fb4239'
            '25b79ecb6ad34cb88dc4910d73ccd95420f0667b3f312c8cefa3d772ac3cf446'
            'f4df6a2f952908be5c15ca297300643d94aa1b104a11bdf23fcffeb3db8c8921'
            '445f36fc826d3dc0c636b0f161009c4f53f3167d4ceee293e072b5a5d12837ce'
            '88be75a6d674ed277f256b72f44be371710fc1807ea4d6548e3070cc272c5977'
            'dc85ff74b1ed34df628a5413ee822404adca755f5e531cf5eee7dcec22c61e19'
            'a3bbaa1214583c89b7d2051e24a6bbd6d3d7615d2e8438f8c5cb9bec5d7835ac'
            'a3cd41bcad69eae7e8407ed19ba0f86d6032b8092d268dd1cc66b35e945615fd'
            '9ff46fd0cd32a06d6a9b6cb03d00cdcc0ecdc5fad6c56811e4c26f2a430f4fb8'
            '14fd6f8b34bdb9f261c6a7b39d5369af8c3edd1f0a292c6661214bbd9ca4bb6c'
            '56d68f20a11ac65368187cda9aab283c2c5edb6669bdf578ab1501b3f9b2f08a'
            'b87ea8dfad7d4860ffab48070bd2b98368e41b076b8a8443e29c4a2d2319c6b5'
            '8f7a70ba71865794ff1a9d76989de363a667806f322d9acaba1fe40a66156661'
            '5915d0693d8a5e99e43f6b30bfdbed21bdbf02a3c1fbb6004fc16f57351ea798'
            'e52aadb34d3449162a2c71d1fb02bdacd614ac964f87be1625e530720681dbaf'
            'e13cf7e139b00f21b8cfd5dca0fbbcf7105b0e54fddd738d6cccab7152ccd296'
            '5626ec9a780b63fc8d50d5a14ab83b91782dd868725653340863a97b61f4216c'
            '661656ad309340f0054eaae452e8bd466cbbc36d3a3fbbcbf3d8364f61e98479'
            '814132563420bcfa580baf412ba29333d361af8bf0da773b1656d70f74af374f')