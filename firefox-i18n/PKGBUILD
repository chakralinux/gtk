pkgname=firefox-i18n
pkgver=32.0.1
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('any')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'csb    "Kashubian"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'ku     "Kurdish"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokm√•l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
  'zu     "isiZulu"'
)

pkgname=('firefox-i18n')
source=()
_url=ftp://ftp.mozilla.org/pub/mozilla.org/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br csb; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

md5sums=('9a20720c08392e867a351627d31fa96f'
         'fce0708c9411acee06bc2a4cab55597b'
         'b92cb33ba4e3666f78b0051427329af0'
         '5845d19a721fcd090deae573f95218a2'
         '9be2fac883f8dba55143421fd6f21adf'
         '7a95b3589bdec9a767afab6d051b583f'
         '7df3daa2bccefbb7c2647b4862aa14c8'
         '3af67c2e7d5b79eebf0dc0f5b79d12b8'
         'c458472802b78a403cafdf95ac5378b7'
         '6cf52686575149531218a1bea90f5691'
         'c0f10cd24fa5d44537d7fae18d5d2653'
         '7c5c9b06a7a11d3637b2d6739844a241'
         '8484d98daa0e223c15c052c5fe5b7428'
         'dfe9e2aae9745553f13e2102fa5814b5'
         'e6eb53808330c6f92751f63f7b9e9e74'
         'f4f528c9316e9e54845c8429f42c6353'
         'caf9f418eb18d23ec2c717caa517cd16'
         'c46e99ab636d0715bcc8614fefef4d5e'
         'da723e6033fa3f7b4d6c810712a55031'
         '536c43913500f96d7a1bbeeb247f31dd'
         'fba7204c9bc735d1bae4391516459d81'
         'fd39a86865c67d60d7444549544bbe41'
         '9249a7c1e2d1dd74573c8448de5426f2'
         'bc418f6d6d66c27c2729bce6c5df5a45'
         'b404c5e81018542d6368171d013be570'
         'df14f25e67fc1909a86f53845dd5066e'
         '8388f771044184c6a589dbcd4e8fbb90'
         '4b53c377f0d6c179866d98ffdb28d75c'
         'a5fab74219e5ef38b307f0d05718c3c3'
         '2abd4d6c2afa6a8cde1cff58e68b124b'
         'cc2a12c9456eb173adc78d57e952ab7c'
         '40b79e4a45a1123566214837339463d6'
         'c7c5373333a13e1c2aaa8e00aeef2566'
         'a9f18f8e40917189dc2c0eafef2086cf'
         '5da3beb679ad155612db3481a0798991'
         '48070040c263f7970abf6f771e7378c8'
         '4e11345ace4c84e759c37c8fa39daf4d'
         '81079b253cd12113f8ebad0fe90b0cb4'
         '7663596fe9543e0ad027481067c3fd25'
         '963d1b09ebc1b1fdcda2416ab3538402'
         '42871973a27454f276da5500bff74cfc'
         'd13d555afe26466c816fedc5f64ed9a9'
         'b74c11d7f5b1ae41288737f88df38756'
         'a5b53b9c059166617e83cc1aa216c85b'
         'eac4c482a66f057d0ea76c42a2e62466'
         'be4f121545fd6da674dcf00ab0a6cc29'
         'f376c0c44ca2d460aeb1c5f13859f235'
         '4cfa87fb3cd0591b240296d87234da0a'
         'be4bfbdacddabe7ecedd9bf898622ca5'
         '404da7ab45ab9261263829b8b4ec9bbb'
         '3004021b72e86aebeb3d2d06f9720b54'
         '0d96c6178c9555af7b3e438562c0505b'
         '171ecee060ab072ca26083c2e05c6ee4'
         '71b6005b72021d361042d55533fdd0cd'
         'd246be3a1826dee8cfa35cb36a512f17'
         'a177bf0a85a815959c27518d097ae2be'
         '8f2f62cc9dd4edc169bd346004ce3a47'
         '96d1b2c2440a66acd32e873f8463f93c'
         '29a0731504f4a6a93401f50ac016e975'
         '397a73e54e6bad67fc5939f897323eaa'
         '19d370b1201aad9bf288417061653977'
         '6813493b8e895033b773745c89a25818'
         '04afc5a2b26b7782adf1b88b3b0b62b5'
         'f14b39c723e50926432688336f552a0d'
         'be482eb3525677fa09519c05bed647ed'
         '49cae3b4412d56f9214052de719d7fc3'
         'eb4f5453b07289a72f20b991fb83180d'
         'f0696003ff09c8599a20a081eca41358'
         'e8991ef84876b4f85e7b67af28e42d74'
         '04345daab1bce429972c1426c4dfa4e5'
         '094aefa5b9d66d163c914f0462dbd0c2'
         '3b78dca375467945017daa537887bb29'
         '9d021abc8986ca83e97f150860d6005d'
         '4a64711de2b12a12b2304fdcc24ce266'
         '8f8d8c7eb17e70f2ae1b304f9ec8aa18'
         'f8afa5ed7bd36d7ffdb44a06905bc3ef'
         'd5b616c08eaeec55d10a9d869ea78a8e'
         'eca38f55b9916fe560ebfc1241d68d0c'
         'b97448df0c894432eb92686cdaa40c9a'
         'b8cec077da9efc67802f6001a477bfe4'
         '09b5044c9f31a7e24757dbfd9c7bf880'
         '2cc72405f876cf853cbde4d589b43a54'
         '5d97672165956e6b4faaad5d0c81bb43'
         'aaa1bd7544392804c0d30e3138ae10ad'
         '1e2b5f803f4b42fb5e65c1ddd7a0576b'
         '9920e66fae8136ed7be156aedcf0e634'
         'ed3f26091caab53fb552b2a648eec562'
         'c3743d6b70a3a9734d2ba85292784f59'
         '56043369554bd4a2d96e8870b2361cdd'
         '9721299d827330938c677a5ffb2d8d70')
