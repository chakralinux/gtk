pkgname=firefox-i18n
pkgver=38.0.6
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
)

pkgname=('firefox-i18n')
source=()
_url=https://ftp.mozilla.org/pub/mozilla.org/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('c8a1c9cdbe5557b1a305f446071325202645de6a0071141b64f8c7deb4909bea'
            '5edb21b51d272c2065b03c9cf31132fe4a11f6508219e64232b3ee8f87fbe346'
            '59750d8655ea5a9faf5cfd340212c9b83d374d3b92491f82f2825bbb5188eb60'
            'eadda9721442c5566e34667352a36a1723451ac06bb32a3af1372b0d8cd516dd'
            '36ddfd92d8a20d36350284ad521a5e889653208ab67ccc5ac99b23dda0910d62'
            'd69748682223dcdb7250fb32d9f7718c9a7f861a52d00f66a0165dba7f49eecd'
            '300411be5102d1d866b61d2923b6462ea8329f01971083873d23847c38bb5911'
            'afa18e46ce4d41601b6ff4c4483eff59bab9fa0eb10b9accbac52432e30f99b0'
            'c63daf0d87469a2ae17a27fa2fe1c4cd71cadfbfcb9e0d5b4805774e2541e268'
            '9af552beae29aa64995efb3b38620d62447b031746374e95ac1969f019d6bc42'
            '7fef5b39b3098e00d3965f4d9a0e0e015d07239cce4a6d7088c2b4033ef18cd0'
            'b3b05faaf363b5b62e1ae6297ce9429eaa60fcd3ee671a6c0ae076f177f65329'
            '814407f5e5fbd115a07f551c8a1dd52ff6b5ed0efd6cc86697a61b757b00d4c5'
            '8c1f080d8a6f7f1e20d36fe9c119804b4d1eb15c67cf7a67b4f61ff972310ea4'
            '1da17d2bd6052c02cf428479eeaf582b37ca0281b215ce2908af94fdc452db1d'
            '1125399d02c4e3edd1e551e5873624f683c3b1d699e51e15af7fe820030d84a4'
            'c44b9965c8f53f4012977b220d1b48a8d46ead21678b3811b96b5199900ef6e6'
            '839483d620aa707f64296041880414f08d7c69cf33fa06e3327cbb4ff8cb2030'
            '1792e6af9d537e735b760335c3d8e09f2f306cbda4f5251e94e71a2aa6a9e79f'
            '1a19107821f64bcaae0cd290392035d8bd85a4903c97364e9f3626b601ad3ccd'
            '6cf0b4b4bc475a60c084a810a2ef77f37292a681ab8c171ad737869ba4b815eb'
            'c6afb39123ba2679a7cf8407dc255eeb74e3ca110ab4c36869d6f6f91bf56ee6'
            '4e730df07fbcbc0af5234a5377aff059e39232a6cbc1ddfbc354f98c3ad689d7'
            '659d397e1da284405ce4654c50d314fff3283ef491e6c35662ff0630b2228d22'
            '92f4f8463c35bea777ab5925cba2dc6b8d9f96b095e3ce78251db4ccafcbe584'
            '4f22229f41eee8db7a2867ccb4c49f9aa56f8fb2047bb58b43d03a9dcf81031d'
            '33b4f1db62e50b87e7af277855dc7e5a5acc3c24c58f5349d49714f0838420c3'
            'd673ba1c16906b2d15f07ba8511f8be7fb0f6391aed9ffea63960f92c81ece24'
            '293f67f17c5c7b66bb4f4d2f3b852dca797808930c85c8bfb268912004c7312b'
            '469e161c411a7e32c1ee34b3d7208ad431b34a2e807f6bfcb27f8f679eeb2512'
            '071ea2aeb0bd5d5f539e13d7bf313f01f77530493dcee1b5bdb8965d47f0c4a4'
            '760ce56864ff5f95e0a168bc0cf52d2a7c9d2054954118957869f6c9d7ec8883'
            'e41c3b93f17f83411fbf14529b27aec967a64c09cbb256bb6ef4dcaa0171abfc'
            '0c0766fad1d7e14720a5d2e379690bc285cf0dc970e3c2c1e9d75a146bc4e792'
            '72ae785c81ab4aba1dce7bcd1f74eea5e0450dc38905326d89fb5f14f91d00e0'
            'd746eabd3821f3682becf0f0d9cd4df3f26c94533cff7d1d95ea898bab43c32c'
            '212217365fb10ce56c1fb13d5b69b251d7cb44d3f1605a72e617c1721f9b4a77'
            'f4b290accabb073f57e740f1eac330de9682d5e499c4e3fde1271663d3e5d980'
            '797233a9297d79423ddd63ae3da1a3df818c96fd2827961ef3fe869dcdfb6008'
            '1d2fa1222d3c89f79e92a0340a34d299ff412070f106c3fb61db6861eacdda7b'
            '6d4471cb361f6af1d19afc28da7f39cd938ce67438f75b0c6f9b8b341166a68e'
            '9a749406615b56f43549eade9bbf40349b3432d56aac8a91be0707515e632287'
            '2919ac34ff6546ac0497c87d21a8cca876e5cf96ad7afd01e93a40479c38614d'
            '9772276f56da9eb434e39e1ef2e88472d54134953f4df3a12c938db0e148207d'
            '6ba24051deb1810477ab612e66e5d9f8b3dd4d7a10503daec5d9c0610a156939'
            'a75de41784a921a8fe1a347bfe39b248dcca12fadeeb9931d78484f46769ac08'
            '285de88c3a53af386c1dc198d3e3e8d3403a0b57a51ee5e4b2d66e2083e1aabe'
            'f4d2bdef64c15d7b2f058d0936da9b3444e635b56321c64e289e0bc7b7b9e34d'
            '6a95972420869f8d7dc85afa5d16c4cf61019d56eb071521049bacfe12537bad'
            '0c5ac2381ed3766cbe9a9054cd08a734dcb91080af554820fbd2a426b847599d'
            'be3e45da0b0652bebde5b024dba38b56870cf3e6d910d9c3ae2ddc440eaeff03'
            '806a258b202857e85e399dfc1b80154d9419c723762a0a755b624b41ed0deab4'
            '0fe77a6e6097ad41ad30d03ccc7e89d82e77a3085f3b515fb0910c4676510d9e'
            '5ff1cfff0499fce216e2c7d5dacb8ef31b8f8a7774c665fd8f23e9c04284741c'
            '7ea4acba3881a20195e6da15bc3571c6eca5f58f9103a68cc07ca8b4037a1015'
            '136f3a92d08cc3e17eafe94e36d7e5ad346abea75943e5a842c0b91de2c320ea'
            '7e31932f1c4841c8e88aed9e09ff0361090e41aeb6f7beec90610908534e692b'
            'ac5ebb95eb498b3fbb43d47ae6d624a223a4508669b7ecdebd2bf8ec047989ac'
            'd8e772fa433f85a343d059331889dfdc449a14411d789399b75e516fb351ceae'
            '450588ca2681c99bb010af01c3dc454cd18e5e16a5786248c33717387a80fd12'
            '522f38482da772a07e17d6081e780d01e89656f5932c88b963221baa717fd1e9'
            '3e4ac1df4b37735806d756bc8f0e7b83ca3e31a0c5ac8efe2745fe916c357500'
            'f54dc72adc0c1090c8712a8dc705c956b0d3d6226cf7719b2f1e3c7656e521d5'
            'c2c8634b69c995c10043ee14adb5c78f4de7f7eeab29336ce5e4d98e54b59a2f'
            'a7fd4a2fb547d7ea5b665d96ca258dce074fee7f308c3e89741388a03ede660f'
            '4ad108fd5c8b9d756e4dc33f828d06a0112060d90dd32fa2b22fad0caec6227b'
            '26722cdd0310fd74533bc43cd32f060ad948d44c1f6a6989ab3378283d220bfe'
            '183fabfccf3ae1283b0bc47f8cb8c9d6cb654d2078e54ec1d5ed5a88106fa5f3'
            '793d0538ec5a4e693f7f54c54fb76e90023a819b2cb7e5fbfeb9581e285a60c7'
            '24216421225a530cd2f22e7e73f17b4f5ea490cf1aad8f28fead1d40c442fdc8'
            '2e4464ecce5e824984ac04c6dfeee7d314a756769256235e555853834470776e'
            'e53eba41c37692c2ace18a3f176370c3d2b2d822ed116798c33bfb950751641d'
            '7b2b193a201d2f9dd5959d2964aca779a63ef052f094be07b1936e84c60c1e25'
            'f906bf04cacfd211e290ac24b82e714fb07d6a74e1f5e7d91bfa6d4a5a94f734'
            '7d84fa5a195c09bc5479b4f06e2ce82f7bcaa388d54bd088228fa86f1e898fb2'
            'd0627df388b9104212003dd8c3b1f395371f9f9406fab24d5c23f79ca567657d'
            '97e2a36444a1ec817b282c23fc6c6137bcadeae5e12581bffbb170c5858d08b6'
            '2effab0badd9b762de23a2678b4231dc51508b7436859c4787aade28b444abf8'
            '64e8ed98d98b7caa45d046879b9dbf09e8a70794eaf5e0f2ff907465b3fcdfc8'
            'b885e3c41ffa5da681e57fe07522d76eec276e84e05b9134aaf79b25827302f8'
            '2ed79ed1bd5e899463ecd86f1eb8c189c5cb81401a18ba225d15a837efb8f45d'
            '843b629981bb58fe65bbe2a852e5064229da25b4d1d5d2610c557fb3bc90a669'
            '0c80e026dd24016ba51ebe1651c1f7e99e1ae398e70a0b53eee9a13cce2f0ef7'
            'e49b89fc8bf2aa45fffb7649318ac80412b48721ab7a946c417b39e45ad3288d'
            'bc881c1f95ea6064f7783ada26302e3eac1f95123439f4913ca81aae103c1c18'
            '91b93b62e4f76ddf91ef6be9734c0c3a5ade3173f4e6c4de71864ab353cbbd90'
            '66c6eb732d4b17456f88ac985344a2d2c6a6fbdda4028c08fa30497ccb54cc32')
