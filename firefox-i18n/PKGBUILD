pkgname=firefox-i18n
pkgver=40.0.2
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
)

pkgname=('firefox-i18n')
source=()
_url=https://download-installer.cdn.mozilla.net/pub/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('c6d802ace28f3880b279a8245b525270c898a7dfdda0c750af9ec3587c055f90'
            '34a127df8e4d6a4a3e74680a72dd77c2a2ef60f1fa9192c02ac875b7296c0852'
            '7009f9ba2294e3e1eceee85dc60cf04db8a9bdc3e3f02bd8db06c056a65cc940'
            'eabfe7760d78718a40a0fb8d9c1c110e3b1b29f40fd4a9f4b460449c016d76f1'
            'e32457cc8845fb25b7b4db6b2aba1060eb14e3bb29de435672c8b052aa08141e'
            '99cadba163c31f4aa9708ea0de3b7e240a3dbbc665daa7dfaacdb7b68893128c'
            'fb52910dbcb973c7bf66a4ba530b62dc27d7e0d54d702c2c6f07b9fef49de64a'
            '1f50a4a6ddc7403822b7e0159ab794c0b9d32c349d61da1998a376f2b971e445'
            'ebe4fc439ff0f18204efeb1efecc4346918b609403e0704c04c3e2764a9d2c92'
            '0ee5f37093959525a592f3a7eec6db15f3f54d0b2cbff60241161aba15146983'
            '9bd3aaae57063ab00e815f4a34534dc5fb020c45bcd0d5a69d93711f53dfcddc'
            'eb6fc438a776ec658892ef017efdfd5a75bb3bcc9e16c640c5b42948048a9b1e'
            '1cc05c4d0b0bf1d47fe907e7346891e852b9fa93d81729432c684e60c64b4c6d'
            '0467c700b678e7b7cf00050635a498cb807c85476e65b6e170db53deaaef3e6a'
            '5d1bfe525f0ec653f21cb8c5f07cd26b2b0539d64e0b0695e87cc98f923f43c8'
            'ab4f998680ac2743f796033e252195c10555a208d0902224d1a90b8aeb0197b3'
            '0898222de50266b29c9d3267b9fbda6daafa80020f85571dc38b4f4a11bd4017'
            '71faa9a60ab4fe7a0dc8cbe164ef63b0160a5d5d30405f36cc57454510573d5e'
            '281fb4fdd98703eaed59aec856d53df0d34faa2f341beab423a8fde9baba5aac'
            '6be2bf1788c93dde454f363840ff0a1479b2511ba0a75a9151ddf85c67194def'
            'f0ab8305e00e14f1013c13704903e67184260eb15ea5803adbde63b81dc11180'
            '1fbd3c81db8ca756f9d2a12de84a9d076f44ab96fc60a0256768cbbd1c77a1d1'
            '05b8ae430f0b7b75cfdef9cc2a3a7ee718d913051108177b19ee50435232f937'
            'd717017c3a045ddfbe3d6888abf5a33216d31853e0f79153ddb9255aeb04d7fd'
            '7ec3c54add7fb8286d0b20acf46bb4a4ef1b3037574c9e8fe95be66315cf8b6a'
            '06c147f90c66c8bd6cc61ed274ddb4402f9706fbe7a2b15477c93878d0412a64'
            '538a1ef783140232514d5d31e22216e6fdfed9b57c3eb57f7bc0bc6c2460b333'
            'b838188267d99c23c912d4f5f6bd48628db86503b436212c31cb28450721687b'
            '9c91319f880c404187d8453bd983751de854de417e9b891c473c727ead0c4eae'
            '68182bc43f7c0d40d7d3bc3348b57a6a6acf2894bdfb299b944fee6adee12eaf'
            'b2e166453de67a998c5adf729fcea21a3ae907d91b67505380956f219413534e'
            '8fee8fdb93280ac53c7f35c2e37a707b3296435028155b6f1dee89876b4aff8e'
            'b0497d5d8c9977110c1e73f34e7864c731d4881120d63c981ba9d09d03337942'
            '2daf695c9ac4b31118203dbd36ad903826bae72e0476139ee682c592c5b3ff1b'
            '6ffd5a59c5215aac38cfd1ec428d78e4c2eb1c127f5f7536e7ad48aae7dbab33'
            '64017257a038b7518fe945e0174c24bc5296b7b4533cc601e4fd04f3b927b0b0'
            '177d1ee74affef2b348e93ff83a14fe1d025d2a2f5ca43cc8d68e6d41652b255'
            'f18e5191bdcb3038d99de703baad1543d0634afd5ca14d5424645a682103c4d2'
            '285fbdfa121a492573816ca39ac17507392e9c1a0102bc49e744346b3856b995'
            '1ea8049a57544eda199f9adead894fdf41c2bb240c6688e51521dff19a67c124'
            '3114024e9de52cae5c24f245ff515a12a0ce2d36c210790bbcfb258cb6f25c78'
            'b0ec5e50c339152de38fee8aa24166e58a0f77dbb58e372316ff2be701e081e3'
            'c5bfa6b7e1baf059a18d7c46bc446e7793966267639afcabc9cd0df5f2df9bf7'
            '38452f420ff4c6b450634ffb617771046132da370085492915df99d99362ae50'
            '8309eccc52db6549e76a8f90ae05f30ca4a235fd7109caee0aea701213ea358e'
            '3827e5d116355e2a64a67b8a0c7507e47e294c1ef107f5bac80886dd3e0bec8d'
            'ef045abefe67df47ffce4e1874d509cc09861b129c633c187c527c8d846356b2'
            'dbe1d09325aec9dc24cdf8362edf1999bd1748e980f37c6513579b34c3960934'
            'e2859ea4e71cd1a42858c1d3d8ab4759272858812abf17902cf118307c1a2765'
            '11d4b8c454da83234063c0799bfbc9d9ef95e4adff421f8dcc46729059ea4d56'
            'c56ba5acdb10431677c9f52f4d18bc167e68a2c1db141afceffda2cf9e4c5d40'
            'c37b25857eaf33dd7b6003fa7b7e2f7b286b1f75320da1f68335fdc61fe6aff1'
            'd6bb8360be7cdc10adc21411359c87073bd692cf9c56bb1ff7d50c50de4a479b'
            '71e2bbd25a86aa362f5f5c87d731b0d2eddb19bc149cd77caaf343f596b18e3a'
            '154aa2f11cff5b1b8e99b1b22b9b724da0b09f1add841adc8a05ee2a073f3978'
            '81d9fd335d372d5afb6f88bd862c359dfb065b1e83c652048850de45497e83b1'
            'ba4fdc41c430fc9d09e9bcbbe769051c273a860e8d067293466ce8b990573b25'
            'ee79eddf776919fdefe400c1188fec2849a9c64ef6eb450d3ab420bc836470fa'
            '01d19eb04c012ad0a4864b48209d3ea4871ae560a24237d481d6df0e4674a9a4'
            'd5088172820de63603dec5a99373150ab20448b481214ca520a0c628f541d06c'
            '447a65f5a7c00be43c23ab040671f3d9c07cf34b57b28d8b363438c2057bcec4'
            'e3fd2f1d9036ace711fab4de4cf7377ee0f3683d42e49b48d783fa04b6863201'
            '4b5d5fa271ef00f2644aab520ce2a46540df1cfc842ea2219d2a53aee2fb1826'
            'a74be0e424e07b46aac5ea35fb3624747627048d11ea6b45fc7e35f3ebf7f6db'
            '0ff37fa74939af1efcd56fbb8e222bc3aa933eb7213432953179abf392e5ef82'
            'a81205ded444d0dd8604d30e549892de80103ab1a1a12e5f313b079b4e9536b4'
            'b2746c8c334f42fb61af52296e6f9677fc40410ae88e90b75d0695caf227e9b6'
            '5dd74989afb14e3b294ed62c7a00c58ee02d17e943b230f3a80ea5f2deea47d6'
            'e51a395fd5e21f253288bca2d473b6fcbea06b24cd553cff10460bbcf483224e'
            '72a184204b394cf807eb14ed7c269f2b0af7b10cf1c25d033f99a8a27c471260'
            'a6823a50998eb222919f2f3892ebe0b317278ac0b4fb5c576e64f18349c54212'
            '6ee4201bc514447a38c341771bb051fe0434515d66f335abcc00849d9c070f5a'
            '0badac11183b629b8a81eb1e6ec67fdcd1b93936c69a22268064178972963927'
            '434b65cfb315198704bdd34de481f5687d06388ae7aff423fdb3350d4efc75b4'
            'a1c7739e37de855c0058ede8c270b4b3d90c11c89668f3bdf87a7b9976924697'
            '44ef32a280dba9c9d3dd1a44084a0ae4db98893777c804675f6e934a16f847d1'
            'b9769b7c9c453ca5ae0d81b91a55ba474e760331a3b7ad96a0bee90be6ddf225'
            'b912baf5a16c4182ab5c32ebfec066833c151ecb09b9ed9a2fe492a29d42cf90'
            'c97eb0ee4c4c61ab73725dfec7205fbf51b9e8eba5c283f23f1669b492c76ca5'
            '332364e5dc4d0029889fb47ea7d09170990a409f0b0348a7cebbf9e310cc59d6'
            '78db56b0516a04ef98cbb9787b9f4769e81ebefce6705cc808ee8bd089ee0713'
            'f0a8287b5dba593d4560d88cb4477c4bf5a4e657d519d13e3028437ec3ca6c1d'
            'be0c7c373a9a15e1abc5b7519e6367a88bcb2c2a8d4b016cb584d5a007b97593'
            'e914d22d10caf37a89aa92f7bac7de2458e68f1a09b77c228743611c0dea7063'
            '71940ac0558c603e5cc09be9cc873e887d3d16ebe41685c47137d0f445f6c505'
            'd53a2dcbb4452cd0bca083918123461c197be6332136334cd09b347ce9cd316c'
            'a139e8ad1d35aa88d02b52c1e4e6480977c449491a342274d163e1d10fafa2b8')
