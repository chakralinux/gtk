pkgname=firefox-i18n
pkgver=46.0.1
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'az     "Azerbaijani"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  #'csb'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  #'ku'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
  #'zu'
)

pkgname=('firefox-i18n')
source=()
_url=https://download-installer.cdn.mozilla.net/pub/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('d50c3241c5996d6a51ba7851191ac9eb027392ff10e6f7b31ada709d61b8ef47'
            '0854a596bc3c7ff882469690a87ed71d8f4225c7ede33d9e251f4b33ef023755'
            '687bd8ba2e6e952106f63c9996decd1cb716569786ba4e3c0c7ecada1ad1f807'
            '6bbf60ef8f9788dfaee844a541ba5fbd2ddaa3ade37c8b3631141d5555703b1f'
            '49ef827fb65e975a31c0696c98387a24cf9e6a692dd4dfcff4919f77c48f622e'
            '5f37397876459c11acb1e6637da11868692f85ab3c9a772ba1abaecb299f0815'
            'd198000a44e5bf6b3789b3b2a3ed5b1ac1efc7ada71fe323aaa9fefcb6e27095'
            'd3b5ab7fc16facf80fd5c0df2760c47bd088ca183f42cf80b1fc08f756105dca'
            '53d0fc70d6a6fafd9ab13dcf5e760fec059bc7fb697a8e9e0306179c887f0cf9'
            '46b084252cf8fe8ba931dfc515b2e15ef70973fcb9bce284c36522b8bbda8978'
            'bf983e961a096691ad6fa7c53634d1ce698d637d5e59a967b496495326a2adf8'
            '83c5c792c48a15020664f9de58879a972c16c81b9a8ce2ea1b7489dcf163d72f'
            '11171c878a2a2708ff5c8b9889f7417d23f056bda41d94bf5378d30d5a4b7513'
            'ecae62d3ee46109e5c59e7c8a2921b1dfd6bf9a8f620de7ae894146d2ad376c6'
            '615ce2d9cb9b85c27fcec6980e03326ed1003be40510e774ffb00798e4c32516'
            'e82e27385cf20d711f037d1d13be08a8f80b7f976344f2cd9b2d6b7d1e1c120f'
            '6f33f1b34171c32c98250af76c733a189ce1b19dd28af8d7463a7496f236a18b'
            'c920b51fb66fde44cabdb0bb52453299446705749ce4a0a6aee85cd9410aaf10'
            'e6d521b7a1c6fc81701376ac2857066a6774cc04dd061d0ecd186f2b7c4aa42c'
            '9839181c5353a7a48716c9096547aa51d989669326c4e16281a464192964b288'
            '748ea2178e819fdc9b097f3a50b2da093dfcb939487c2d0b75efcd5466856a9d'
            'cff20c6f30fe097e778388f66a7f637165bee7c2a14faf8637823cf914206c23'
            'd7ab499a26f7aae9d07a17c6146c44318859557fa56cabfa8daac1b36518a520'
            '03ab2aa8c0c933c71f169a37cc9d8a6aca66867c2ae91382e8133b5ecfa850de'
            '62076f735e481f39070ae99c5b21cf7297a0dfda100d71f4f35a9af39438c0c9'
            '6a9d63950e6998c5e45c63ca624e8dfef9d64492e36280ead10cad116349d773'
            'd9fb6171d95edc84781856c4db7bfb867614746dc396f64aca3235d57f690645'
            '1172cc96dfaef3c8bfad28639a5df07399172f794dd8bdec00c72a3e58cb5599'
            '27e252ed9f5fa183a0569c12fec45108b83d00c624ddfa2c720d9996fe6247b7'
            'cd343650002eb294f3f7ce3dfa341fa5571611371fdae38e523ac915092b653e'
            'e0cc6a29caf1ea98ce0860c405ca798e6618a42c8f94fa2df7431834cb24a9cf'
            '686b41599a3fbb45e0000348250f4960da2f4f7f10027ec9013da134880bea28'
            '6cf4ed8a53198118a7c770a30ecd2b414f42bcf7e51969625200e9a4acd157d0'
            'f3607dd9b49234faa7749620b2797457712cd7a97a54a60bb3775af8ca9c9231'
            '2754c27dcb8c099568b382cf48faccc95a8919ec7cfa306f6c1c004a9c58436f'
            '0d7b8c59844f544a49c9eefa7935b70226bcf5d47768d90bcedea28700ee9b08'
            'fbfe363a24a3c62ed47a9fda032649b75ffe7f2d8af8d785b21a09471f15c38f'
            'aa746cc021177f6eb3a28446656ca3ad8afeaa23bd975060ab7bf848b76068b5'
            'f6e7792d11cd4f9328824f8ec80775d6017afa6a569893604e08e1b6afd57e1a'
            'f0b5d32788079779193fad12b2afe72a193b64c5a099df0d393eb2498b0d6ad2'
            '98cefe134855b4bfae3babbcbc4ad3d7d54cc698a47b0e0853b490a3d42fc6c8'
            '59153dd981700df9f6fb744331396db6366dcda383cff4d436df04786497d461'
            '6793a34a05d9dc7f9b8822daa097322438d567d6ed684da4bf743d36f101686a'
            '756d3f345ba18402ac0e1a5580171be9175afbbd85165d332c4a4afc88a2568f'
            '484e870276d53bf48688a9aa358cbf3406259cf34d2022c435f709f8fc2b6235'
            '18a19106987dbacd6bc9c9bbffc732bc208508e31a5268b99aed3301af56fc4f'
            '9e9dfb927fa1bb241fabc3a39b86602726c0c8e7982d24034f8af976958e94a0'
            'fd4a62c392bd7b86042986310fc6e04c07a8902de4db110febc47e04fd4fb042'
            'c0cf32c76cff9203d3637eadcc08cd892c92d2c90e2b43b528711d479f3bfb35'
            'f447c3aae87e700ef3c7f9a3a990dbb4dcc4c13c2b055340a7550fdf96982e00'
            '3d2b25e3f4bda1144b71e8fa306b79447cb3f724ed1374f6092473540f72d9c8'
            '527976d5d9339bdfd08aeabfe36e05b6eba4c976f2a9a36b3c80a64515a4a1d2'
            '82b33a2bc517dffba3453429cc72065d23d534fb123300aed9a8e2578a16f340'
            '5457c13ca2181c009eec178cadcd8ea768593938c80a58604d047454c011413c'
            '009e1848374b32ff1299c98cc0a15ea766feca661a5aa080e0959e7df701831e'
            'ac3c4f72e2143b44a8a469500b86a251873ee99c717587137aa6b3534322277b'
            '38804016c515b0a42b5f1599d127218f84ef64d4f18f6dd4d6170f23b16ad99c'
            '99027e3b87ac2f772ef3981e6edd168592bc19eaa79f5c5fcaf5504200b16b0f'
            '27b1738545ab5a156e4859a475d31b83655fc6a14ae3daf3babb39920dbab5ae'
            'a47c6a2115301b958d3c74c9e2361abb2a0a979d8ab913a07ec874357f4ceb7f'
            'fa469a76782dd77231e65912de7673f176fa04d81d4373fde6314f0bd9cf4879'
            'b4c797d375734971cada8870e10ac2bf67fd5c3f6a9508a10160ae60dfe6ddfe'
            'd8434f648def909b6099880f2465e38d1923456030685faba16ce180ad5937aa'
            '915867e74d5c03a06fe4e5570f4ae55c87ee9543685404cb1c2ba8d58cadd86c'
            '36de0c8a3662e61ca1435a83758dd40a773e76a8c6eb3a3bbe0896af702e8fa8'
            'fed9a6f496c993dd26cf5f20a597fdb107df96f987ccfeddc60b2f04acc5efa0'
            'fa5f381514926ba39995687676ba1a1be2570871ca0db573b79e1dd147898ab7'
            '473a5a49e6350369d3b15aba810cc300c3f833b1fc8304816a143ee4529fe85d'
            '8bf27cb8633b78a8b0e024e88a66f408637b73a2284c7875d068691e424e78f0'
            'b69628e094fe8bacfcb442b8335173e17785476d4c4c3e542746c4ad22c0f094'
            '84f40dd88fe60b09e0205d9af4fe6eeba7851a4a6ce4e18083864dd635a927d2'
            '32c9cb135a50783d703835b0c1f106f9f1ff67e13f7dccd9ae9d95e33659a14d'
            '564b915b21a558f8227d1a57611953fd77c421751710671bd9d627b767667f8f'
            '7fd088017f3a10c78871f178e5c6e3ce929794dc962354d970165831f1161015'
            '0620e194e7bccb3188b4db621a60b55d4e95ed20fb5022341c392c2fb7db3e3d'
            'f2cac00939d14c5998655da7c2242a4f5730099106898fd53b2a32702edac05c'
            '3c001ebf1b50abda305cd36632733e51058aa98177a990bb5bf73b601e9437fb'
            'e92e1e73aa9fcd0d81395bb205262f431cc2c3f74c043c18b8aa615fc88561cb'
            '488d19d5d26cd3058be318868cbbb346d3d46b11306bd536f09b4fba7908f1ed'
            'b83c0b592096751432bf6a0041bfd6e3a0631528cbd65800e26075eefc23f884'
            '5a0c1c689bd3ab1f63e69d60c11da2f82af547c8901c985cc0ff3a1f9db43676'
            '6375d4645894418707df84996185cf22f4395bdb7a4a9ba8104e37417a3bd3a0'
            'b53ff4a1fa5473afb4ab91fbd705d23d3ccf6b203439633d10acbb46e8ca56df'
            'ce592ec2c92ec63289877dc13b3d5bd33f90dd9cf737ef7ba76d26165c732d88'
            '6e211e37b75dfb541977ac203c81a87bf050d01f9ed56d06277419e2bd7bcfb4'
            'f10a71fc36059580db344dd4fd026a5c108a0253e3b8d3d0d95b1a0b7b5c7017'
            'e0ff8979d7beac465297a49089687809b1a5f17a913d107dc454a4c2927285c7'
            '904693927b895535c07097113f9b95cdd3d408f3820161629677de7954ebf4b0')
