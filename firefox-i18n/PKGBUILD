pkgname=firefox-i18n
pkgver=41.0
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
)

pkgname=('firefox-i18n')
source=()
_url=https://download-installer.cdn.mozilla.net/pub/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('2195125b223461f1c63b4dd0c3f625aafa5a2872b0282a67d6c86a893bbab34b'
            '9605831802db83df3ab05b452e02a85f614300b8a6de4cc35a9ae0b408af7fd0'
            '7cf32ee74e6b9717fcb78f4bacb272a4f6111f3141124581d7607e13bcb55a7b'
            'd6536d75a1a21bb98155a1a1ea91a4b8e0423418dbd7de093723411515f12440'
            '56e6b2e0ad19d36959ae891e8d81266bf983c8da4dddd703b7b1f66a0dc4a485'
            '24ea35c533d8cc3a29457e1a135c1e652642d72e987c6209ac8247eed24efc2d'
            'e0f079cc50bff9ac9c01e98b2454ab374f125c4eb1088720b25eb9976b7d1372'
            '085627f13de1faf0edb8c90d62719f41c9c364c849ad7280eba8ebe294024512'
            '39e1fa1082bf5fef8a3384fd439a60be535e2a1e526342ffd1339834385b255f'
            'cc60645bbdf2f9a8712859738d8b6cb43ab9ef6f9d504e7d004c14b1d7b122c0'
            '5df295a40577660a6d0ddf551d1b453f29b7ffa339d1b926039fdb9cb6e1292c'
            '07c6424a51175a9d0b7be2101de7102efcd4a5a42df1ae3561ff1a3911660d0d'
            'b2d1986587df855818695f57b67efdef956e113ba868d32b65e6892c8f69c842'
            '9e02b8665ea9bbb7140c548ec999bea995091df7fd1c88ee536ba49b757e1461'
            'ca9de56e744bd446d09b2d013b1ec18236e5e869842b6491efac6933ca70ef94'
            'cdedfb89b7db5157d07204be9c3b367c9c4204de58c6bcda17e935349a1a800a'
            'dad8a90572dc48b68293661e9aa16845f1a09e99cbd61673ad58e254589ee2b4'
            '6e209aa276c54dbf5ee231b0e3e2671ed9588f2fdb30939334c685b69660b2cb'
            '1add4b0aed5d3c5cb230e6532b64f1aa51fa36c4bcfff606387acb8300d2060c'
            '370c5632f86718fbae2e8c50c065c311c78bbe306d81d35718192a0505a88e2c'
            'cf8573a83644a297a93038fed4e4aae4466a842af5a4edb54aa7d3ccbb8e6a82'
            '0756df6e8ced3566663ad9e7968d794acfe4dc28f2a17d7109329a0a67e1226b'
            '25a5f575337be680cf535ef6aaf560c842181e6789e4beeae47bfe8b68a466f4'
            '69c9f0025dd915b7341d4005130d070c1ac6f2669d28f813a835c3af1361e41c'
            '623b7777793b2c9696599ab2c7ee340cbd9de623058acef6a1f37870915a940b'
            'a095e1951293b5985bab99c868a1406f43af87c26ced6126d66a56440850b593'
            '12b325e32b05a8604ac923691260b8f4bdb3b5ce5d7138ec8b2cc40f79630689'
            'fce77bccb417cf7dbb8fb9997917b654cce1f620e6a9ca3699ab34e92a43f7a7'
            '171b4c43e31186c422757e0d88df4646efb1622ce34964a38b740ab49f95fdae'
            '8e8ee02b9d65706d12ce72afe84f4970a5db22bc569b27a6395ba5943de50ed8'
            '87e378b4c4b89a4a2edb9522e6c0ea386a3d76f9d8f83e177ad67205bbeeebe8'
            'a26e5ad25ef72d8049d7d2d42abc1e96d2219150760ff1ecdd1f011265431c39'
            '951943f188efdf878f1add821806d5d1aa5c9849ab5ba9d84c1e5828d8071204'
            '497581157f600f12cd1d97d8a9316719118518aca903394b723e43f8d7ef044a'
            '855bfb2e339d391e96e05bf936e972f1702216556f590055e8c3f304d12e0e45'
            'de350c620945926b67b34135b0994a6a6db01095a1a05e5009bf7989acc86bf0'
            '3f25d1ac441de014931e9b13cea73037e6ab10f964505607c1b5dff6d7d83b50'
            '207f9203b8954ebdee507813091b4f8e89cd257440966924b8576ca0336c116f'
            'c4446505674e78e3e19ddf650d4239f3974ecd5dea1d4a6fe358454a2356c007'
            'c7f7bdf9dfc4a97c637136e9ec8e29c1672a4523feab339e3e6c33c5e158232b'
            '90c805809aed43e1bc13f53c9c75cd9e4b81dd49790aedf57d2395305f47eaa3'
            'ab79d9e0eebb45ef3528865c6152a65692e27a5d2186c1ecdb105b4d1457c080'
            '5ae9f1feadd20b09101ce6d9c281f58c50a755fc3b1959e2d6ef61746b1b4410'
            '723165aa5ba7ab04e831cca71ceb85fa87ccbe07f0801d904ef19ce139e7ed22'
            'a8e9e3a22095dc492d0967ecdc7791dffd34311b7b0890b74cbd25ba6001910f'
            '12d30f7657da0b70074cdf44343194f79f43cd2daeebd349008dc0b8d805758d'
            'c623b5ac3f75628cbc31edfd21de9fff90a031da0a018e779cfe0ed768c0f137'
            '7c588df87770048bdac07443d794c5814e4e10b10dc7a455d8aad49858b18130'
            '26b8276f35cc1c8e81638583cd627415fad74ed8d417f0f321e6fdacac1ccb5f'
            'e5fde01b29ab655de138eef0c12c9275ad2f92602fe8babc52d78b8d8a5ac65b'
            'd852ef91d9651f3b67ac46e67bfc9b6c806ff3ae8e2bba2b1bc191faacf3a4c9'
            '433bc6aa3442e82f7c1b1b5aaf3b812ae415f34124514042405b0f6ddcbc7834'
            '6c2ad5a7b3fc0e29a0c52936d11e5c55abd102d342a5a989710adb16038012a6'
            '7e3d5e5f2c5c81f4fcd6caa13650f012bbbff6bc48b73250227ac938fb4404cd'
            '2edf2332a7f8078fe98664d7003485dbe46779afd1eff6fa95f672bb842f243e'
            '163f592873e9a164a9548a2f7544cd51fd953a75b2c25e28550dd08e237f96fb'
            '8be0f41afc855fd5dd620cac2548d8a7246096ec8f9a48f88ab7b762db66b57a'
            '3b7a5a3931fd4682e0412c5c98c316916cf1aa78727dee9adb389245048e30cd'
            '7710508a6e95b7b441b56fff07ee74cc21da0031a31c1479f8c4829c17e7b561'
            'f17b4a1e7be3a9be81a3a141e52d5e3f03907e83f8e062d43e2144c81a2ee0b1'
            '1f9bd3662a8ae88aea653917fbccb0be054becbf9e941cd2053ce7d5f48ba4f6'
            '24463531867c76b75201212d5f7b66d80b724c1a1d6d40a05a00f526a7eca5c3'
            '5b7110119f44c154cfc01b3b6238fa03626af0be4bc0d6935dddb76e4d12941e'
            '3a32069499eb145f01f8bbf209f03b364f54ac291c85b45f41e39945fbedc9bf'
            '1cabab0c27b52154d319c81d87c27905b267071b88fba514d760228a059e93e5'
            '4ad9933161a5cb6e4c75686f973c865d2a346e2810eca8ddaf8ac4adb0c4abe4'
            'ada65ff845b0ed30691d80552499945528b94177e9c66fcd982bfd037be920c6'
            'ba3c462f2133dd968ff2dd28bb5c9f9d22f526d3ee4a87aacd5bb4a2934eb5c6'
            '8341907315a7a09d407d710822736b535020d708d9a2edf7541ee1cc80731784'
            'f18e20519876abe587a390468a958560f634c857c7b822afef0c2b94bc2f1708'
            'e403f75646a0a9ca718100c9909dbc5017d2f9f6ca92edede72e4b61ccbff4b8'
            '5e5ee9d48c1475fc282b7318dd616862f6d327a5090b2efdbcbc689fb2bd9f42'
            'baa1884866133ae302936082927a0d8d3f4711c745824df2653c32fb73a69602'
            '2068b3a854592d5909f113460996c15cabe72967b2276ef0381556cc30d78a01'
            '12ce8ad7acce53b25c5c1b0d648b78fa06e3cf77e33bb183878c61f022f46c7e'
            '5e715d85a4cbd9cba0d07ca46439b06ed14180ec940f1977f400a7f45042b962'
            '2eb804c553a2fb06f94519e6e586e63f07023f224a3aba44ceaf7e5afc97d56a'
            'fe0cf48da7365ed8db035a41a9e857ed136f712715a397187d37bf3c00f536f6'
            '5ec07be4a58c8e3a085f4e7010fde97237294e5b094facc0de30015f14b42280'
            '4d744c40c623b36456a714a31b69fd49306ee9b82f9ed6a9b32adefd9adbea64'
            'fb28838c7788271b49b26bc0b778057d7d597881b9f0afedb797f6afade07645'
            'c0c097acf3b2557cc3461478ae528da203062c57d38df5bc562f95f71a3c599a'
            'ebc0df64bc536ee96d0f1eaa273bc45b767f8580fd2056caf23cfcdf2a28b8e2'
            '75e9d7080fec4b34f7201aad6bf92d3ae225cd388712baa914f22842d3ceae2e'
            '13e0a316a5f70f73eb1d37bf0a9728e548df8d8d235fd17e6151a00a58e3a5dd'
            'd0a599276ed397aea39a0377a9e282326c7b99e1ad80b84ef4fd3e965b0cc54d'
            '398d6dd2a4105f3c2402d7327121c75e2d6488833779314d553fdf44b2358c33')

