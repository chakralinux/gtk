pkgname=firefox-i18n
pkgver=36.0.3
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
)

pkgname=('firefox-i18n')
source=()
_url=ftp://ftp.mozilla.org/pub/mozilla.org/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}
sha256sums=('f632b02a4589191836f3574c638dd28529fd3a00c953f76a85fcaab96c8e7084'
            '2b5866179b40cba588df5dc0a0e5527259a03721b119dc01f1d2395bb76cd637'
            'd70c7691881f2f0dd17e7ba63f8882942ce64f59afed1ec873ed4bc9910d16e9'
            '88caa212ae6cf39990331eb818997ba529421683ef3663fb1f5457b98fe2ed15'
            '27394d8191a8ae76a7c9684382450f1c14d2d4f7b40fe49f9b587c5010aaada4'
            '733379c2edfd37286e1e4f2c05df74fc32eefcaa457bebf77e2b3b2e383fc284'
            'bc8031004a5a741a9244e9bf688bd6b3dc8cccd0169a76342214ca7a1c346479'
            '226a53b2b20654624311153b54c6d48800f9b20630ea18b6d6fb37d673084cad'
            'bf37e0a850287649976fe08e5790b351cbdb72d16686dcbcc9237ac72a80ad2d'
            '3d66437e52fc62c02a75584e42c92e03e1b693b47b25035c186f99e394fcf8fa'
            '0fa73b67106818c1b227c7fa4f44a6da2f6933d56a0c2f928ed4b1a5bb18167d'
            '89fe3596f54e0a61b3bd48838a39a1c9fa71bfefc378fca876b58e6e75e1faea'
            '7f3c583c2123e3e8a2c5751c1a2a2c6fad15ac4387568b2a7dad1d9d7f109d92'
            '6d96f13ed95e6fb7ff058db86f50d66646c690f96f2287a01e63349b5942a2df'
            'ddc3af795cd4bc5684d10700da556d9b37c7a7d2d1a0799738f5c05691a1c5f0'
            'f48f9b90845423789769f7ed69925dbc2913ec45d596f5ad251a9c7b34fa86e4'
            '44c252c191253c206dd59dd7158107480b1c9bf79f5c51f26bf0f74c162f4c3d'
            'cacbb2cb1d1cc02505571a9648dda58ad5359e3233dbd0d7351d5692b1da1d47'
            'a03d46080ad05b95e33abc91672d46a80c9b2b0e238d4d5c1f8bb0926f77d02e'
            'e48cf6a5eff26972a6506f49dbaf0a248f845e6a326080b01313cc4bcc8c7167'
            'f82fc3f93142b810ac4cbd7c9042a651e52d36e9b7bf1b779b173b64f29533ca'
            '635c1c8ce2ed2119b3b4eb56e83bac4729360648326a4821b5fd328179c2e22e'
            '0fa5d739b5320ddbd720878885a3b1f36b8e485ee1049f50cdf8455644934193'
            'de5f373c73f459a434a6c76f70b3fb03d16f1acd056d13298d54acc50ff3bafd'
            'bf9eb5663290a1629f71aea4032175ccae294da24d6ec404429096d2516a2ab5'
            '6529e2206d318176bd972eca27487cd173b8d0f6e8eab7e2e21aee9532bef1a4'
            '1b7c20c66e970ead147ce1eec5d0755ecd894df107b65295751afcb92844979f'
            '111da0b4508f9640671203778c403610688ff2171ee06f4a9bd3e20a398cc404'
            '18ee636f4def2abc44323e53a5d912a695a1d4f8fb0e3d59225dccd7c2172db4'
            '00f5f77d152b08cdd45f7d10c4248ed6743fa5cf908f7e578f394caefc0d4e3a'
            '4a7813d901f804f2ac668fabbb097069a33b2ae7fd02e1d7216901bb36d9d7d6'
            'd31a085e56e8f0d50dabd6b27269b91b036a73bc4eee60a56c6724e9cbaf523b'
            '42800ae82ef9683967f311a9fefb4afda4bf6c880cad0af749bc444d6bce98be'
            '5b065154c89108082dd84deb3005c2d2dcdd8a5cd4039ce41a95b74c14a79e6f'
            'e5a98750a4daa5ef94bed955f1a2aa995da4206141b24c1e7486aa6256a2d1f5'
            '2773c5b1a95ded75af8ab802e5351ed07b9082b7ae65381436561a4e33059124'
            'df58e6fe6cf60b4ea0f0c0ae0cd6e41537ad4e79ef5d51a622973ece2d8095b1'
            '281054ab1f8400ef36094793852f0bda51f22eb9435e93cedee9e926b96b7e40'
            'a5b6b098735bc6346b743300f4ab3f4fc3df817f6c0b79f141bddbf3f76bb25e'
            '3287a277d76d7e9cc0a8829b8f7735a7168ff7ae405c404e1da354502eb3cc6d'
            '7b21c4f7f7419d800a1abe1f0cb1b23d4d21fdb2d2e5842a3867e440637b6ce6'
            'c7095d1a4fac5101958bb5581240d9e32ba82e9c06e61ed73fe702fa8564a77a'
            'c47a29c5a7b9d304c024f126876b86de9ee4a01dcc3b674184c4bd6dad00d6c5'
            '6994af4f50fe2dba91700dcd4ff9c80fc8c7a446830cfd2138f41fc0117c130e'
            'b6cee2fd1668297adb6258ed2242a44b1926d79063b2f638cb76cd17a3654fb5'
            'debd5fca03b855263cce4729acfa66ee016082fb76750035316e38a3685a57fe'
            '2b978b5ec55d21e25f768eea189754361e1979066f36d99a7c6152ce6343ffa6'
            '890e27f9e52666e3e65ed70e969ac7cac033c4b356fa9fdbe5b35747c4beae09'
            '29be4c4df5b52e558a6b3bd8e1a62c735b72090c290d683a307b2814d5504ca7'
            '78bf608a2f081cfa13a51eb39afdc4d680bdfc48fae8b039589993316f103212'
            '984a0cf070f75fde1ccaf3107d83c8be4759da41b5bcb43f31f2b099916703d5'
            '12bc04d2de3f6230713cc5efa605b7a2ca58a6cbe2a0975e8976331deb905496'
            'b7c491e97b52d1ecc0499dcb6f664e6f4cdd9aafc9f35831e2af950b9ec18b12'
            '7a4d6135e300528e1741a3a50634045b56d2c820cdb501c48c4eaafeecf34765'
            '4fb1e6407c3f0a32e0bd5c3b19cca60c3b868b6c5fb82ed7c9330970fc67a5e5'
            '05899cea8d97a72bf8406b5330ae2df163e71627607927d1da38543b58b2bffe'
            '128992396c747880076f12cc55e6562f6c81f3516fd702f31083a23002399c6b'
            '8ad5b894d23fda268ccfe351adf488a1dcccfcf9e5c64b6aa484786680f5f712'
            '488d52b9906a4a5e9a6b484c17349024fd2ef6c7cf63631963ba3901ddf2fa57'
            'cf4b7596bffe2eb5d3510f3cf566bd8187313348a6c9eecf02de1120c635fff6'
            '0862c6d9cc6c601b3c91db6a68e6b2e5d8030dbe6dd09a4c6c37617d24dbe785'
            'ce422d2e69e68337fcfe864681ae1eb28c22b63f49d8ff88b64b805bdc3aa47e'
            'a1f4ffb26b7b2e4c6e4c10224885bc1eaeca7ed7c5d64816bd6352215524ed58'
            '85d1b101e9d737f87e2e0eebb7406818e3e495c68643af11a33e1c4405bad5c0'
            '21f933a028d84d45ffae1dd2fe7141fdda4ab5db833ae45fdd2540d16cd52cdd'
            '17501c8d9e6dda1937daa6f4c38c1bb2283967b4b56bb95f7822335d93b7f76d'
            '54493aa5c6aedb3252c6e37c4824597e6da7e9298ddb16491e034f65e69ae01e'
            'd36573200310c77a145955105e3204a23c9851add9609e0b91021acbee84790c'
            'aa5fc04b6c1cc31505e2c6cf1575d6d7018ccc232682c7e96d5670d1faf955b6'
            'c0c0cf162dcdde119df23d9bdb70ff4b2e31fe016579f8ba484c1b9c5ef15fce'
            '8e7345f2bcf0a431e54e5110d46f40f3f5f396702731d252641a6053f50919d9'
            '99d967cdda5802bbf4a3ccfc42c62fa825a6b781020c0f775aca297ec075f748'
            '78ff2ad88b6b3576232a975dcdb8b4decd0c3cff1e119b186af4077d7c49b6f0'
            '3e7dd5a0ab145e3c35c694790a055d0d506313378b779fcec5f452d195a46ef7'
            'a21ead50ad39090f384eae77856ebef725aae46b9496f6e27b8c79a88a32b06c'
            '9b4adea848808eb3740c92f60f8e7caf95cba1ae74da6a1cc8d7017330bd2923'
            'bb616d2fda55597f4a3984c40fc2239161772e4d41591e2f14bdb0f88ab5a423'
            '6800ae5f4540b8e4e57f8aa1fb3fcbbc56c2269ac0811380478ef8cfb7524415'
            'ed084e74029f53b589dbde019fa7ebacc69c8921446a842b0ac0914c19daacb1'
            '6a6611130e11deb2b6354f698f67f744303de57f9659d86509e770517f0c3d51'
            '6dfc3ccce511feb7cfdd5402345d724ba986761ff3b8945aed2221e602291336'
            '93851e61944f3059276b0df3d98314d0c4c6761c313ee768ac1b869d35c06fcb'
            'e63f9b347df199e54900807ce67ff9d64bf008d9c03b802624a18ee8efef7178'
            'ce730f48ecc060912e3846e046db5128ab6ce31275919cadd446d90d4992be65'
            '912cd716b1ddf105acb6ec740a7e4ea80aaf56573bd3169caa1d24ddbbcd0d95'
            'a4f4a5adbb76ab17e6547de6fd2789a8c6a1dda71059e39da5d52e3f5e841f7b'
            '742d8496cf8e72e255bf306d14fee964a942406f9755788089a953a2e17ab784')

