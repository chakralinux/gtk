pkgname=firefox-i18n
pkgver=32.0.3
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('any')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'csb    "Kashubian"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'ku     "Kurdish"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokm√•l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
  'zu     "isiZulu"'
)

pkgname=('firefox-i18n')
source=()
_url=ftp://ftp.mozilla.org/pub/mozilla.org/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br csb; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('b30193a584ea6abc9668212ff749d0ca691e9ccbfb18cf8fc18e12fcce522a5f'
            'e94d842af914521d5b3abad43565322e18c77fd2df630d8b18925c58a24d41c2'
            '134b8f8bac3094ad22d1b7e4f34348cdcdbb894c57bd4eab0f30a74afb85ee9f'
            'e542b13beb37dcc6bab54efecd5550807984cda1f8f1e99216265e880c5e2e97'
            '4e145adafa212d856df17f6c02b57d0f66fff0a4330dc8864ba931a2052351a1'
            '1dfa06cc737eb2c5e840895e3709dd371430f1c052eda0384a7040637e732290'
            '026fa81f03fd385aba337eb9e2e2defea806f89c0d1450fc3bab8540e2cc80d1'
            'a6af2a053876f7a36794037888678b141c4c845f95b99fdf1e37267952e52041'
            'a3eb4f3b2d77dfefabebf0c588d47779dc4758053406525c71aa7636fcb4da71'
            'bb344c4559b8052f13e7128e9fb45a855020e2e15773ca13f12084e69d669b9b'
            'b8b60bfb70dcf2b904d58c8540723399d3a677b8ea8e8960334f02b0c66f3de9'
            'dfde14d8af3a6edc964a14a257dc28ecbf9e78e53b3732c9aad9185e5eac73de'
            '40c2be583ed35142d3f5b7a57af9398096ba640b2f5bb4f85ddd9273a3573fa5'
            '40dc69dd08f7407e813719babb13ace352d16c32901b7e6f2a5adbc471769521'
            '6d913ce74f0e3cb5f6331f92410f4bb120e34382cfc9eac12a94ca1e48f85a95'
            '2f69d15ca9f051a1d3e4f4bc4af9a6c162cd93d2692438e299e029e47aba4721'
            'd0daf9f042d32f7a53104f11c6f22287a512bf6809cdca24ae53a23fc1aa7168'
            'b83008f06dc89335e2603837e6245e5201244bfbcd2ecf2b572428921a3fd874'
            '0007acb18958e574423fdc2c7e55ef8c30714b7dcb1e313af57f3e8774cac95b'
            'e44a4aeaac13dd4c58584ef31309dfad30a686d702166ac93fa190e9a8e0a619'
            '81bd07b37c22303c234960e0c63c748e6a19dd3c9b1c3f3f95a35016f567c219'
            '6712b1db5dda5fc66cbb61aea4cad4ff5b55e729ce8202847e4826f86d19a6fb'
            '8b25bd4d0d0ca5617f67bef0f848fa07f8e68e8461ba573dcff6feb0b4c4a77b'
            'd19c3387123017b1e2e020be921630f85822ca1640608499255e337b5c064104'
            '07bafe7c001ecf3c8a87fddd50fd772d8a13582f95b4107f4d07fe4e947ea4c0'
            '8f183512264b8bb3716b5f8b351dc7268b66553056499524cef68a92de30b0b1'
            'eeadefd8c1ed735e0029ae0638146974e0abbf499e6b245d78f5dbda9b8d6ec2'
            '4f1df90b882eb271fbdfc7e83acf200c09390f4cc4d7889d459477e34fe88a38'
            '2c445ca370f5d7f5f8e859463efa64cb5c6efdfa19e8df4d04cbbb416bb5c6dd'
            'f2c14aca2f7d421ab7e084aa4b9b8fc2b093d01a38ac7cc5098dae4a037d726b'
            'ed91689fa375e349cdef09bdf8d6489c757f44d16f1003f0d78e94e65b62e3dc'
            'fa7e5225741be4ed489b6164ee0b15c4fc845ef9ed1f34efb5c26e087ac9f7cf'
            'fca990a1daa444b65095a0aa041a7f607c04d930200de315351033de2a34b171'
            'e4ed07149264818451f0878fb608ace7153b624d4ff668bd317f40ca0768e62a'
            '71b933d3ee7b8ab1b69ee848ec1dcbaf3174e5fb3fbb8e807ecc21f74edc9ef0'
            '2ff04ffb6c488f1e9f562174bdfcdfd7fd499e45d8268ce680038c91888a3c47'
            'a9bd081fd351750be1d54ee4deedcb27e1abcb922fef621f2227d80bb636617c'
            '8482802ee9ee07d4ba5fa9f11bb4d02abcfb80fe540c532f93f075dafd8f8b72'
            '86c81ffb1636fd8c6dbeb86a40f874f0eb15ad75420bc0853127104cd7db8f9e'
            'e387866f413f8f75b7c45e129ab3e44c3784eb9da3485566d59692fc5e89e8da'
            '6eccea72a1beb1536483ffae5f4222c9089033d1fa4a9912b5371717e27eb7bd'
            'e5af3f548c322bf8376aac9bf0a62fd35fc00a40165ef5d4c5b794a1cb7cdc9e'
            '9acf41a526f2253cfebd3ab2f578502458fac4ad3a6f64582fd2a40bb3b14ba6'
            '6b2b8245d555dca31106b0f46d863b80d5c53707b35520c1f8db877c94da1498'
            '0f198e444bfaeee06f89dec9d2b035ad01a199978b1a470853ec9c84ad78b8bf'
            '052ad9a37d8cbf09bf5639bd8b7a1203c001b86f548c43ac6b61fd310b017f68'
            'f049316cc4a08d93fa6175db449600b73547c62e64bae3d5f2c6c262da32e86c'
            'fba46bf01ddc60220058d264f7924087dde99576e4769d66f49dd5431bedd333'
            'e98074aa678e7271c7a93b1bffadfd53eb3c3212f29707c78bbba43b2c8917cd'
            '13d282d86e9af7d520b503b02146cd3d25c82ffec34b96e0a849f8df8a84d94c'
            '4b69ca16d852732680fe88c07774afd6bea3a939605defe2da9c89283b2b0a9c'
            '0296ec89e27b1abb99311df56d18cfa661ffdfc09fe227e6d9873249ffa61366'
            '3f2d41c7117c88ecb7e11e002e0a02626a8f4ec0c435c297f603c0ae74f15988'
            'c1d0f92044a79a3467923086f6bb6f51a75b1e8776e4733c420ca3fe4010edfd'
            '2777fe44971fbf0fafcb7b106127e0a339195fc7a6fdf1e24bc572443811ad0e'
            '41bf1d93fb5d9fc2ffa048f66ea146d5a60cbe11e4251761f082dbfd0b9e3dcb'
            '2502775b6e70b1c9a150b7113d7d13167ac5dedd80dc7545efde57473f1b6480'
            '19fccd8ee6c9e457f2f05d65f2f45689c03986e9dfcca857ddc41b1a2feaf946'
            '8ecf49e5fe323e927b6f48a5e4c979bdf9dda240485d9ea6c0dd7cb370219f22'
            '21f71b0f0f5ca5d0e92978f77757fcfc1d2997e2fe8d5185b74f5c6abbe51ec1'
            'df93fcc5b172a0450a9da8d44894f4d3ba4957e1a455af6d46eca2005c2a9f1c'
            'd52d91e5777a0645cfaf77efadb7ffa76d0c0108d4eaf27f2b31f6ea55935faa'
            'a43c019dd8ba81e012fedb111f7ec43105ffcea96a95e8e7c7d989c485c98b21'
            '0fe1c6744f04cb59b7c8554e5aebb7ca95ccca3536d5472d3a91305b009eedac'
            'e0e746246d0bfee33b3ad0eefa56f9495d257ff2ba955a619738a42fd32d1afb'
            '169e163a1915770fc4b4a60417e8fe94d9bfe7723fa594e12214b7ec83fc5915'
            '5c61d521b99861024cd5aae76d27cae3ecce1be3cd567f58df97afdeac457eeb'
            'db3ea9a052dd299a2fa0d04a9b227e1bd1613e7d8371d75122b5d7f4ebfa6769'
            '0d6cad9bd3e221df032a5b57ed4417e0c77a78226df09d3a33767ffae129f446'
            'da5d95bf8c2b41c2029ab5f2bb6bfc485acd18012303d7b8986f7f5c6b479f4c'
            '99050557c9c04d5eed4fa8b5a4dc88732ddb4898ff1ec977eb12410921680eef'
            '9002f5bf4dba2cab159872d1a3fcc0542f13546e32bc6f7be51df2ac5edd62da'
            'e0f66a9300554eb5cb75b273f641825a20f56283fb1fc212df67499f6743e206'
            'd55aa1d5e22dfc27a66274a1386cffd9b43b164f26724665d1f8489d5bd0156a'
            '996b99a00f67588e24e8fb3113f95e6c0ea9f9aac45fd3f16f6159f22f252466'
            'bca24efd40e930eab3933e5e86b89bc56e3bef62d130a100b866dc6c798afb2e'
            '454c9b0e0377def0ee1f1da693531aa82e03bead90b9085959fc8886914b8e6e'
            '9d80a12868a7bcec5bf69bf8c4f6b6e2031233fb8352d0236f87a0d4a80358f7'
            'a1e53c9f2e15e646fcec33fb866438f3fd3174555f5be06a557bb9fbd99c0d34'
            '5720659d5d2d436492dc0024e386d6327a1123e0bc3d1cec6a6201e661e4c355'
            '994f4989ed24559351884b69819a4cd4dc5ddda489f03a965abdcd5534eb1e65'
            '1ced0dae2bce13b39321078ecbfb885964823e2760681366dd64f7ffb1346119'
            'd6beb70019dd7e050628d3f7c4d9b90ce6057c135c72afe70fbfeea01b1b2a40'
            '26c28ca1d776705895b1120a03fc53cdfd00d098b56f3e6fb5b2e35dce41bdee'
            'e38c309be4611a38c0693ed3be7f2b9032134c5a0e5255ea5db2efab571ed159'
            'f63cc499e2976a22d705d7dbc819ccc0b0a0678ec82c3d0ba481b7ac48b40258'
            'e51dfca34fb0fa32fda9403f024044df00d8c2d5bfa42c90c2793ef07ccbf826'
            '1a7e7c8551b7b60d44591acee099f45c343fa0b64118ca46146b4775389f38e3'
            'b53e36bf7ef5401eef285dd16640045de672d6ea12c77870085503f901f15f5c'
            '6520863fdbc116b4f93df1ddc46938e7ae982bcc62e8c442cc288bc8e6e41267')
