pkgname=firefox-i18n
pkgver=45.0.2
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
)

pkgname=('firefox-i18n')
source=()
_url=https://download-installer.cdn.mozilla.net/pub/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('5a216e33afd744f69a600763f69adbbf48ec4c402e92497b4d54703157fb64c7'
            'a1ebb54de3b350d211b715a98602e05106f05e770ab35c5bd9a3cd2e2880b4b5'
            '36e378393340275335542f0b2246178ce40ab669b354b1de460704bb0da0517f'
            'b56b8f5c3009cc7949f76c86c7b88db0c919c6504c2f6c2e913ca98446dca4f8'
            '698a2f2c1bb051a7fb65459ed8d9bb4dfc7ebe58c1639cf392e6cd6f225553ab'
            'fbfbcada14878997fb0eb14de2082c19e6010b76983dd4b74fa70378a9a09200'
            '8db61ba0383d4d03a12a07bd4d847732e6d4c8d62e894597e2b70359cdc02182'
            '6a381aa9bed7c9561981941de106d3cc8278c019b09c22a063ea6c3d4c9ef814'
            'f232cfe53154afe1ea15b9138f61db804398cec0b4697babfeb3c904fc096df1'
            '523035724a70e01c9d56f9eef5c7fd9ee77615e54e1afaec98fc92a35c6de1e4'
            '03136e0bea9280b8397e843744327d9990d638baf55bfc3ba1d95035f1e61f14'
            '1a6cb102c7cc729b4e4710146198a1ab2d3bafc22d105fc307c5cd184b649dc6'
            'ac9a5cd7ff4fa1526236a7a3e5b4cc404ee2d18e386dc299e8162dde499c970f'
            'ccdf253bd176c31b22442020a2b1f6257618aa9fd0481f53ff11cdf9a4ece7dc'
            'db911c23d51d2acd7397aeb7ff3dc0077cd5c5cec2071e118e11e96701050aca'
            '830bb1a77b13c01411f6e66a47f4b62dd486a640a040d9e1524c6783b14cd877'
            'c7fafd31439326171c7144d0197eda2d49c79ded97fb52d6d2c21aeeb919d05d'
            '4ef5f1048f3006fbb6584e6a21d1972ac357413756553db3ff4f881100c25c57'
            '616d386d45c88dafee82d99f73722111de9ae458f420e19f90488942b566bc98'
            '1a46371917ee7ca0cfbb8af4a88579e5de80b8d1f970042acae43fc7afcacfc0'
            'b1298d468bfb0dcbab66e0f603f273ab32e8b28e53adf5cf30ce74d661073b7a'
            '61df0817163bf854c79d5c50ca14958d5be22408d926d133630ad643e5d1cbe2'
            '73ae240702cd240d786c02b8fa416a0119ffc55fafc47e769029107af9051318'
            '9bf0f9b4e41e9e1d8929ee79eebf9843cf0db26edeeab7d4ef39f15333d3529f'
            'c2f184bbc0f28e697204acb9b7bdd0e47559b2f6da3aecaf0daef5a6125d84a2'
            'a0b39ce95e8b6f65d47c599f1c643311d47916554ac76852ef5b0eb2f6e9be00'
            '5c0f9475aa171a8cc47a606bac7c2532aa70567fc82815f66a1ee20fbcfa8688'
            'cd63e148060d378020a23a2881e4359469b615c56d786aa33395f5b3cc2c9fad'
            '583bd6fbf3240a52b049492161c66b613de1f93c2a1abdda9dcc7e29556573ec'
            '94684ead844f1ae5ff89781cd0cb1ff790a413b2b5cdffc1a5b876474ade6285'
            '2cddde195e0e0ad47ccd5578f70a4d322a63406d206aacdece34e5e48afcf3a2'
            'ee7316be448b07b7aea957e4e13697be633cd531fc95312a116c6f2dd502573b'
            '5d3c72d6b2ff96e60951ebb10bae1522ef9fc4b535e7e17b068f8bd1476c1c8b'
            'e190849d0d1ac4ca2e4fbd916f599148dc4d7ffe9226708a01651822b1eceb45'
            '1a16987e9c219f2cbd8f4e3f82c30bf2e04c0eba503ac338737d50d1118f66d0'
            '6e188d482ccac5a5fe2ce55b49864c7ebb4c047fba8423a2aaa85f914a35e6f3'
            '8e8681e21fb153146239f5e6450b0da52305b90eab4fa24379ce58616a4d5ead'
            '3729070492b7739b8b30829aa9ef8f5932c15e936559a1b8974f17f45f49d1d0'
            '26a08152e8ac7389f64716a82f050b0ce7d1e3561cb7fb93967cf30e8c6e33f0'
            'c4c479ed134e338e736fb7eca60b077a1f633bddc47376093ec424be9286f762'
            '09dad4529a1c6c7313939c0edb3fd2291f10f8f35a35390e6ca87248eaa82ac7'
            'a887900b2dc64500cc7636cf959894392a0d40912709accfb678131382878d82'
            '7fadd9ee64c2bb44f49aa84c06580403ccce15f23ee4065d6de5500ea60ba295'
            '8804b457992fc23e91a629bcf9e5944dd253eac151bbedbb2b7174d7c29a9e0c'
            '552aba150ee33db11699e6cd93f027bf51f2e09f248ebcb4894ab757bfae285e'
            'ecc9e0d6f9572663d3f397722b632a9649995c845acca3caa3bfd7bcbe770e39'
            '2a5556d03c463801782484d1bcb828c7fadb3f49d12ad852473ab2a407e41842'
            '2faa2391e800a627a32c40961947ff7c87ca782c8d8e85a05acde0951f21ff73'
            '4f7f41335d07d5467b19a5ea8a589f08c47652c54a19c09622edb2c2354356d3'
            'cb11cf330962e7fc8c54154b631a160101a597d308ffbbd5e707390358f21808'
            'e71450b04492fe2a0e116da149a8bd755b5f9062b706b8da4a047ef0fbb32d05'
            '91444c42898e0ded98ae43cc22847d405cfca33d89fea743e3ec410a34e1bc01'
            '64f23886e2dd8544640cac6b2a5ba346a2c797e9d0bab735bfd63eb476b885be'
            '8f3140630f3cbc91df83951a8695cf12357b3e07921c931d95f97fd2f31ae867'
            'f656665049d1931fc662401d87540ee7b31faeb8d33d9ba1e58628a503cf0275'
            '9761980e2fcd181a0ccf998de7dfbc03115415a1fab38cf2e395413a28d1b7ef'
            '7371ca8511935260e0bf35436e47bcd25bf08d6f6f1cb0e775ccfbc07d0109d2'
            '5f4684da6b5548964bb51535f90506f72e5c98cb6da12814ae46712205dead59'
            'a76b6cf31f6cbe30bc44399dc8a9fc3fc09f652a164b7daa970bb74208483e41'
            'c181f07861b7bac5f352af05449fe2c06a1c16d6f8c1f9e7f855bae0567fc234'
            '3bec273a06bdda27f36c189b6ab5855ae38e7287955aaf88192cca7573a1f964'
            '954a0c28422c1eb460ca3a8d7bb6fc858f40f7c145910c9d9124d952e3499db1'
            '6783b618bb670b352d9fb9f23ac4c8ae5b9dd367cceb4dd24a626c04237c9dc8'
            '5e2e6abd0d2410215b169739cef0ed59b3217e241bfd175669cf42dbe7a7ec2d'
            '8064f2050af7c5cb847950a275a770db00e424feb512569279162a5743b125b7'
            '3d3ad888a22a8f5303fb03f14fdda3fcf3225ee487ffff8527924c971c750b19'
            '18d7a4a709f962eb3386efb0d125ce119a43c9d41c09be45d38e65e565508e98'
            '27970be87e4e265d138be72454c8ed4de120fd85b6ab304a98114f584ebc7aef'
            '97cc80d841b706ee5b7c573be9bb6eba263d2ea0639b92c26cb0dd23eb51dde4'
            'f2aeb2aebc2a6a1caa747cab90b32a7ebfa53b16923741e15248993c2206febc'
            '31c5249accc7469c8c4bbc62dcdec03d884944542e40cd91d59d4ca707829aa8'
            '39ea5a489ef0f2c85fdcf74dcf1c6de8b9d831b4fd958700cd2e6af6ae72cd45'
            '6f59242141eab6005d8a3ea9096ab683dd2e4ef86f14befb7fabe3081b9b19a6'
            '87c7a643339e5af14ecca723be759a30bb6d73c719334b2f7d283f3be0da5056'
            '9a22c040a3c6cafaf0cf2c2209b75c19286661e7aa727aef7c4d0f33105d3bb0'
            '87cec296cc39e64044595d7d5a10d25b3e2957b6dd758206c9b1ff04400c4773'
            '7d9d4527567bb2e2fe41b6b7995979ad545cfca5ec585fca05e472db8f3104ff'
            'f6643499739a702b109d0be78c2a964fb1b5a4178bb4db7ffd080b0f8cf20df6'
            '71d5d0bfd51ce72ebf325a4c667089efc3f086de7bd084dc6bc4ada51e9d9a47'
            '8a11854dc121c7b6c35327abbe90fe3df9ec66c98c41b871cccedb4fa96aeac8'
            '158b2bc0c904934f5863ac7fc8b577b598c9f2cea833c593a068dd9dc708c9f3'
            '4bb8299bc0a68166a497aaa2a0ebd1a61d6bbc5b4b161a95d9e7c0f04f5eba2c'
            'c68b56bb128e85f4b1489bd5cf1bad6dfdb1a694c0336fb5a5f83b70a3936164'
            '6937eaf21836b7625b71f7d614f5584269029fd95499d2a68cfd1a70d85e1259'
            '8c08a1c8189212ed8439dd2d0fe65708ac6372dc857f026e29665248a79220d9'
            '1c00492848400c00e7429a2a4a1d0c8e6e3361fd7bc2e832894dcddb4881b0ea'
            '0d7df0e3359f6bf3c4db4f146dc8a748d0b2c043290947e8855015de03e5bb5f')
