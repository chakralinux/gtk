pkgname=firefox-i18n
pkgver=45.0
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
)

pkgname=('firefox-i18n')
source=()
_url=https://download-installer.cdn.mozilla.net/pub/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('05ffaf0c4eca7dcbfcc75f95191754578b2dc13e7147a8108943ae15f6cfd537'
            'ae380317a497f1a40f95dbc9c65f8a3b6d6330a2c9bec073cc82eaba5ae9d9d1'
            'daaf9a3cf717f3eb69ef4e2dd7a23f77bd2a40b052da7c0d99ae3a3c9d1a2b0d'
            '7f7f22e324b9bf9bdcc27e4d4d165f96aed373a17cfccc48ad377c388375703d'
            '08e16787330a987b9ab96dca4ac9293fe39a35cbc625d9281d3354913e8c9313'
            '345c8b277724434985e86fd9273cadeceaaca6d5b41c0e29e787bbd78e3fd148'
            'e42985ab06e2236c31364f9504a245538bf19d3fc31d78dfb228808a79fdd850'
            '0a934e265459181e7190641bfe1a577a47b85fab0e294cc2bee13b50613dd110'
            '71a29abbb793b9f0412160b47d7977fde3729e24eb6823bfda54eae9b3befa53'
            'f4e815a897e5777abcc3d8fed4f23297cbe6aa8c0b3e351babedc7d6fb4a9da1'
            '9001cf92696c43c01156d28777af31dd4d1b9fe19f4a5060c65db8c5847cbbc3'
            'b3b8cfdf188926a2f727f29426b3ab9c28ae10f9b7e1966dc20856952b60c211'
            'e9afd0d185eebf4511fa6bb7939d76cfffa4ffdb9f1021134a1583c40691b945'
            'f55f2b4605a41e4bd993405e6f0802955b8535e00ff95b921454a76ef4aeb98c'
            '1f8352befbbb7ac59ec2fd531fc5b64da489e5473b51d79e7f8c0d8bc59fe60d'
            '5dcab5a956e2f702a566f5feb38539e9682cef92b9e96dc229f22a614f5255aa'
            '7065e64d3594ff1e1fc074a377fab5546c24f0cca8205489c89bf50cc69bc311'
            'f1323cb18515855c98741dbaf48d72453ab8f439525ac594590552fb313539e1'
            '932ef8806e8efc36498ce189e2667d5bca04c8befe90a74f47dcb1915b088b53'
            '02b26c59fa9c169e1ef1f0a2f5fd1e653a33251d779ca6697605fbbd02666a12'
            'b2af12d24e22e62caba08202323a903e6103898e91cbebd24974fa82e2669ead'
            '838d189b2c6c9b81e095dc9f3bb2391f8afc5ed9cf9fa145b8dff5f0adc862eb'
            'a810808030e74a8ab24826f857c61ca96a58a157f9355eae17f4232f3c671e87'
            '5af7c04cc40b1f129363925078e3958e66f2c4a94f7821d358115a27876df9ea'
            '58fd93ab9f76c21598c27d13a23f668897728bfca40b50d59b67b16cd89be051'
            '5be987e95fa654de4c3e1d7ded68e9ad5e8a4dda7f1582c70d33ecd2cdb3731d'
            '4a45f745573a858c5d84c4a5f0b9f120ca9f1ba46ae15feae9e47d0e8ab8ceb0'
            '9f9948c6a66913f2a4d7391e8a33e50a90164370021450437f7e21da1e967594'
            '9c3ddc14288aaf9b11d212d8655523fab4bb420340ac844e2d23b353e4b8e1ea'
            '4f83649b0a0f62d68263da8a181a46b942c5944ca1510a344e1fa395db676870'
            '460a998d5fd57afa5441dc381a63eb909b36394223255c228e65200db5a321f6'
            'b6b4e6e802204a476bd30d5496377e46191c907b56d98cf0305373118eaf8f7f'
            'dc4c5406c83279d0eefb8a767cac3770f8bc14e458b8b1a3174a62da4a13cf51'
            'c6c4372b4c5f9c6eba952ac027fb6fa1856590b07014e8b5695e7c0c65510e80'
            '34ef064d04c509fcc8f6f2447813da2527800695e775bcb0bda6213cbb6bcd5c'
            'bc20b6b9e4751e2ace72a478b4932e19c098e8aa8c63435a8cfd0020a1f18286'
            'cae4c28b293eddb529f9ead07348f25ec0f1e83562f1f3c04be5cfefbe8d25db'
            'f4245e517d24c7b09c5128a7b742b020c79702622aab98ab49dfeefb287655e7'
            'cd7c51f6da42d4adb7fd151358ca08411f099252f9ae41105978ac13154566c0'
            '7e33569f64837b387ee21c9db3a953e3e50ce5aa88a612352683f9722b67f6c5'
            'd9fa276149f9fd6b006f938ac48d1195561176d07911e0aa5234332cdfd3a75a'
            'c58a6d483b8d9c5a022026231f092f8bd4518822899dc55df1af9690e0c2e524'
            '3d4bb431d0246f6dd4a1a17abb0959f21832af470e53ab90c72394d61bdd425f'
            '8c1048fca87c4c170c2108023eb12c0ebf6dcdb298d866ce22a999b6f0a49adf'
            'a6df414d8e090eeec56c03c9094b813651895f88396566c93d9a7b3f0a67fdea'
            'd81c5140cfd59194795c3753ca66c7347058396af78fca562443104ae333aeba'
            '73a3b7c60bc6af9f169fb0bcf244c5c87e789f132624b25294e7611627b77b61'
            '4faba91aa16ae9b05fa078f82f3250d3d783872d548648b3c3ea9b79fd1c8102'
            '345b7c72593f81e0f23fd518cba2986f5d9d638cf465dd1e42e79e0256a61457'
            '1f3a53e306459bf994c1a00f7ff936486d5bd341b1c76196c8768048607b9501'
            '40aa7043b454b662e880f108ec870302f9585690c04550d2ef7346cff738adc7'
            '05a98ec0077da24e1786a9c75452ddde0ab55c5a8fb061e885a563ba4722f759'
            '42245876c63277239f1931cd5c5d9a00f73979ffa0e5dd8e3f31fe15cd9103cc'
            '2e9bce0060a5f51fc8e48cd64c74f1445dec16ebec8c300bd94af684e6ade9b6'
            '35fe45c1360eb14c989faa2036ffd0dc27be425dd135e6b4737cb7922ef33243'
            'd7b1d0f22ca97ded7d8cb3b50b20ab72bfe50e76bb932ae52554b83f23b064fc'
            '9f5633d282e8427cab25a261d9b39603d70046f67020130a80ae99ba3b11005e'
            '18ccaffa6540ce83048aefecd118268908efdf7f0301ca86545f85e4299ed271'
            '6c0ee6768f3e95f91b890d3523520ef95deeedf2c5b56de347ccbf01526a02e2'
            '8217c568c8cf15c3bc742e30961580a20174084838988be70c810eae057d2558'
            'c83d3e8d9c476aab853185891370685bada5072a072d4c4dfacf03af4842b6a4'
            'c1edad123323880803e36d84a55239b283199d30a412c9bb1fce745c9a156448'
            '8687ac996c520f2190eaae823bfb1e351dda7a2e750f14b1e405a091d5fbc120'
            'ec327493cf9cb09fdece74f58e9c03dfdf41dfb7f1cb0df292ea4eab73de0e17'
            '8671b70e0a64eb2caf6feba0347fd323c41c416f00fb684ad904e19e784164cd'
            '1b549df1747e59a62e171e37b5abc2564f4b5e77ed35750c3b7ac8804f105b5f'
            'f2b63f5c819757e6a05ed616fefbb24236486e139e6a062442fce8b7ac9f521f'
            'c6e962b6d338d7d11a41cf472e433af5966cbb5e47411e7ce69a49a80755913d'
            '72c2c5df076d309f10da1775ab1b945f4462cb790d1312420c64f274a680211d'
            '4357b43806113a2b65b315286ae15d85c92d24360ed8f80be82d847e5eefa17c'
            'b046f06bb47e2e64958f67c2b5f5077fd3f775303cb940817a46997854456e6e'
            '034de7755bd194acd47d488f533096dd4d748793d56dfdb4735e801a5e8f9163'
            'c8ae15d035e77ee7f1adbf0867b8dfc3a758e50dae60c9b9c100f806b86959fa'
            '23eab4c6228adb1d95e44a82856cba4631830cb80b619fb5fbf50feb6d2a9bd7'
            '04989563319701c93c28a1d312a2fcd3f71e0c120aad88e4dc510fdbde32d813'
            '83572d3af0b95c01103bed6f2911770e24ea9180a0c04d308c020a8bb97edc2f'
            '3d3ef97610d61a31b092ce8ce0e66f05ce160e4f68343748bd85283c09151653'
            '4824c042afe87c345186825f253754103d0d97951b159e08dc515bdbbc0db2af'
            '68dfb675931d5f330be821f2fee55f5632f935b18259767c32385b6e3bba467c'
            '1d2ef65e10999dbd52b5ff68d7fcb53081e414058ad41d77d5f06a74635f47f5'
            'ede063030a87354f468828f8a5383f378d8ad33e2af14847802157ddd07ced5c'
            '445b5a447eabd42b143565bbefe90942744c1673fe350e6c30f2c5600ffbde12'
            'b9cd2f31340086b898e346eb133390eeaa89b10b5fd39075fc0595915f4116f3'
            '4fab5143229bc61fb4219eab4efd3732b2ff267690119860d540167b2f14bf33'
            'de64fb5d89b66cbe374a245eba4f6691fd4794db2374c85a41011ca12a946012'
            '4c5bc9abfd07be33e2500c1c6e5f131d7cd7f069713faa3ec4f77e541aa0a9b0'
            '255e227af060d0f301eea9dfb78adcc9cfd64723c805b7487397ee2996ce8fa3')
