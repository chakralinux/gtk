pkgname=firefox-i18n
pkgver=33.0
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('any')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'csb    "Kashubian"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'ku     "Kurdish"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokm√•l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
  'zu     "isiZulu"'
)

pkgname=('firefox-i18n')
source=()
_url=ftp://ftp.mozilla.org/pub/mozilla.org/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br csb; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('8835a2e6b81f253a6c1ec2e6d1e7613bc6824ba7c140e17d0006333add7bcc21'
            'c19e0b16351f7c880728cecccd8da874d9b9e6c5ead349478c3a51b455633827'
            '02768f6fe8986b7b2a004bf93188fc487028e20b52bfa30d14be2444a68f4530'
            '2e35f226d3fe50bceba8c76ffc811b4beac6da1c781352b73f12d76809b19d29'
            '8666c123dd0457d700f100ef5dda71f0f94ae9f56f487821762338c782be2b54'
            '77c75cb36ddc5bfbba7734f7fb7c29709a4ff192017e127d71aa6a6db3f70233'
            '312e0bda70b15cb910212391f3e6672ee79491a3c9507b03567f859575a3f1f5'
            '47a3a09016f75fe597d90120fb704d01a2a4c1763bae83f22d59aa7970512ef6'
            'a5bcf7112ccec77bc64f148b27f84b3cdf15e02a0202adc55ef02886ea5615bc'
            'f08a7cb6df5fbdd4504e15632568016d129c69203e8146cffe8ad30c0f2223e3'
            '2172f81260998d6a75ef4e94132daceba6a376de365030f84e10ddfa377c43a7'
            'c55853e352180fb382713eb3bb573ef12a2b2983465682d35deb2b6dcec03f08'
            '01c97cc376e027844b6e415b150cfe97e329b9d7b24a8a74789b167c513b8569'
            'e276b7ad157d457873e4ba53ed2148ece651edcd286e0b1e47b352466cfd2cfa'
            'd67f93adda258b0891c175fb8096057f4cf57b5d33e88a95f8f1cbb67e35a7c5'
            '14bf70b1729d00e1dbc45ce02a0b1ac8e36d222a4d5aa8e0a761d81f98ed3e21'
            '926ace3e56c05de322ef2661f0c0ae0fcf19363ef25d54250d7bf57ef8014feb'
            '2246ca285d257244ad3cb93decf0f8e94beb0a4e74f62c998764d05740604d5b'
            'f003ffe749b6963e48071093ee9cd9499df0c4317f7ba41b81c06715340e1e5a'
            'da6acfcdd66f9026849b8dbdebfbd9bb57e34d13caf1b1554ed186a1cb12f1c6'
            '60efba590fded95650e5469df0b1a7651299efea772003dc416039960d734845'
            'c9e481e72d40e14aa4b9262659a831d5a6ac81bfcf21218b39c4e560da1d5868'
            '91f7ee5afd64b479e351182e087212f28165f0f6e70fef51c000ed202c5859b1'
            'd0596afbcca5f6e0c8a812c36124ba959bf32eeca4400d251309a1aea536d0de'
            'e2525f97b00112f62c21658fb1cbc15adb965eb8f6b9c74fabf466ec98bc853f'
            '8d2317ba2d14a474630bdcb7f5d64758f2bdbc6898d41062121dbb51db2ecb00'
            '68f5a65c0c2fcd4c812633418fc61dce162d5563af349642a79e8bc19f8914a9'
            '5fa5cb79d9252f040e7ac305318b7a9d90a3ec9a40467080808d9eb702a79755'
            'f89c54162e76732ba4897f5461a226f28543f1e86501f569ce7ff39fbd0e8f35'
            'b0496eb0f4669bc23f574be42d76320c5703dd175f7c5ee22ee4f1af9952fddb'
            '2eb64b13627f120bb67af106f8fa5134ce6faa87be8ad17b0f2f329b06323c09'
            'b9ef72b8f60967aa6545f7394cfbd94c30e5f6f4f3deb07b1dde8d5b17431fa5'
            '41e716bb736fc8b075131e253298bd0bee141a9e799aa38ce7b49e4ef3471541'
            '9ffef3441cfaff31391da11e888f79abf0d165ef54b950dcd1d287e0a5fc5b93'
            '3ee4aaf2c434b26698ad34c727ebe88630367290b9150fe232c7559601399dc7'
            '2f446a01957e4eee8433622c2b248916f3e56b5debd2a3137f2e7fa01f67e52d'
            '1294dbc1f46848743743f979d0abe0a2226d92e812e7083f48916640735a74a6'
            '07400e97dcd3343629bd81962b589f18b7734934639df2602dc136f5d2d002a8'
            '6b91ad77bc4f21afe3213cbf2008538c240ec620631a75d549c97d5f9e0db370'
            '554b8c61d536067fa348f6310061277ab1da401cefc37aded5f777cdec9cb482'
            'f0b1350a2ea3e8cc8303b38debba55a36c49e77cae6cf69cf5e590e0b248041d'
            '28ca7cc981b2535150b4fe5f8b434935ec43a7766785832696a722c92d1adc14'
            '9fa21b1e19733a12919fbe3bfccc3b97b0bbb4d31d0e66b720ce59087d125482'
            '999222b4c6e291501b8691c614be86f1286916fc83a14e4916ddca6a68b20eb4'
            '5df334280bf6aab0edaf912a6a7854320fac4ac1def23ed257d72b3794521aae'
            'fde3899dc69817a84ccf3d324ce307e1159368cf4628af6548cfbc9246ba928b'
            'c5e58332237207d8f02263583630167f15225c1b3a207967d37544fd6365803f'
            'd67b84a060f6b02cd0c25f382f47f98de0e2efbd4da2954d35c7e29df9237edd'
            '6284d1073bbf2ea33888b0e0f8dcbeae6d6caa5aed671002ae216fe546c6f35d'
            '42681e3354d2255c03d7332e94099e04a6e05421969657c9285e2dbff311f1e7'
            '16dd79ba9d3a5c5840e8bcd5a02f4705d46e193003f84e5b0c294b957263af9b'
            '8d051810a4db1fa97ed302a5847cea9f1a1b5d69e5c265a23a5ff81c8a2d6a0f'
            'ccf69ef3b271675f93e9cd1ecfcfac49fef335015b91627f4900fca37dd7fb54'
            'b346d54d187037339052c8751517966e5472ce2025e8df92347d1a4e9a3c6225'
            'e8358a99bd714c1fd2dc68a7a998823007216e761881362713a81faaba2209b4'
            '9625a65e0ddf97ed9a9d665db75b90954a4b344b80de87cbe42f59f5939ae0a5'
            'f08b5e59e0a46eef56c6ef300724370185e78dca4853361d303097932ec395eb'
            'd305b8b5f145769eec5b04fab2150658ac10b63d284915eefb22a4fb1f7e79a5'
            'b83b3c0517812211d856468973537111f20326cc0ce75d1df1bcf86ded224847'
            '08f8f5fcc9244ad65f14192f0895572484458052ed35d077cb44f5f3c11a69aa'
            '8e937a46052b06dd68ebc74656230e8c8b605fcf6665e1ff0a0e4cc11879ac5c'
            '305d132e63092791d6ec458f4e41bd09ad33842fad02d43ef2475293a532c0cf'
            '5dfb21bd8c16bf3c5ce82f14808d6e59f5e4b5ec121634d5b53ef60bbbbb4fe7'
            '2ea276b88beac4b87c26b16c924587b5d5280e35ea49cd6a4251e63c75480038'
            '3e3465624d21f3441833e6021a9899e4a2c6dfe00268335b8078f9715dbe0867'
            '2a1f2cdcd4bd3b067983406666f8293d3646a5a77d48d08ed20f003d05b1f32c'
            'dc747c16cf4df0bc64c8fb60a07e7cb7d9e2646ef5fee38a688390d0deafdafd'
            '65a06987b3f9cc41d563183ffa10932101c9ab8622bdf783cb173641d76cec2f'
            'eab19821664c0ae395f9101d3e8504a740f7bdc6cda73043c183ed216c548dae'
            'a6c51f37bb51aec1f842dcc948c5042301566c043af504ff70dd60634e16e240'
            '7d02dcf0b8929031df701e7475bf5a6de209f32ec08e139e2c40d61254c07e71'
            '0683d03f023490ecc8fcf16b0fd0b96ceee9bafadc8d233b2578dab8855eaab2'
            '24b003800b412d7ec6d4be4a8cee141817164e31949363ce528be16c135b8bd9'
            '56bf0621c31b3209c9eebd1258efd1b1ff575dcd028d5af6aa9247465eb65f24'
            '5e470690c61e5650f0b4b5c76045445e71e5cd9c6870b5f1f5da6b34c8b4bc9d'
            '96692222e77763d6a0ed290c21d4c41d614d342cadf51cd762e71ac000acf04a'
            '364a45c54531cf67162185c81ffb12caf32375d407855723d46dfec994b69411'
            '49dcce48adcb73eeaf8c4e4ef6af4e7fa3c43cd4f0b396a49c4945013fb211b0'
            'ac22d43e3a95ece6183e85211713a5b8e5ffbafb918bef68b34c50126114174c'
            '5a0f5c447246b81fe4042331c0874cc11108cc04003f204097ee2bee8c526350'
            'a342b1c0874867c25168175dea30c11a869fb39ea7727f90b992fd5fa2239a49'
            'b8163643f8d670affc3a430c179dc502c55a4371d40ebfbbdbbd314e3a9ebb56'
            'b3fa4510edd888c4b3d0df0ef9ebae82f23e3fe1192d07a1d70980ef2c183918'
            '0d16ecc160a927395e00074cb1836f2c55638d8d9fe23352073ae08ce109d7a3'
            'f42619c06fd5d5bbd27083b5596a368c01841eceb4e8858422e4c115fd0ef022'
            'a58c093b50a01c863a1e86e10d8bb2054a4a08dad24fd6aaec30a1b63db8c5e9'
            'efc51892ce2c4fd0e5bf1121281d45d82441048aec2051b101f9f17dd6e73726'
            '42a7b0ce959a9342081b30a444f8864d73a35796b0b003d07ef13ee8acf04091'
            '2e7ae48c7542314c743055dac9dd8fbdce9ec8a58abedb33fc33b5b542b31d8f'
            'a719be950a53295fd22fae92bcef2d73e2f6909ae37b4c8680441c5321798bec')
