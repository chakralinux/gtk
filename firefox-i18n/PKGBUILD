pkgname=firefox-i18n
pkgver=43.0.2
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
)

pkgname=('firefox-i18n')
source=()
_url=https://download-installer.cdn.mozilla.net/pub/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('630a391c55ca24442be92e92e38f5dfbb831ae50ccbd4fc5784f9583ad47fd43'
            '2e081e51f9bbe28bc4f1141a7a927c72c1f6ab8aff1d1b1fb703a837c1b4a681'
            'ebede43e06b1a0b4c87182f7d87f4535d21d8032781016a50f9240a482b40089'
            '9b3ac850ed73133d0f45a8514d4c5072f1bf9d7e9027e6a8c65d28178e3ec323'
            '38cdbc4722c9c00f9901571a8ebf0c3e1c7d38cb983ea23ba487ae82dfb0a91a'
            '787029dcf8b68acd8b6eee2877591d922cd6441ef5a5c651c0a44f602ce4157c'
            '97b13b17e3e0989ff83a7268b2fee5884cc05f988359b5c20aea8a3fb0aacf5b'
            'e014016e324d38239d3fb5b00a4754850279c487228926c86c87d476b3052451'
            '8f75ed0f9ff3392e4a9560182d1111982aa7d0179eef77875335033846a6eda1'
            '42c3fba45e49534a7bad4e7ca4c71f8e9a846d70f7ff191bc4b797e11d937afa'
            'e31a08555aa9bc811e3cc0490a63dda7fede7a3dea8e4bbfa8a40dc247180643'
            'ca2e7658f205c5613370fd44180d2db97ecbe856bbd9e0910c2449c17714dc21'
            '47c41b2aa21748d435acf73d779a695f6cec3232d5d7c3a7df409d7371df5eec'
            'a543e30e521f82c3f7e3a518a3be3246efe29d2de85ac6f78607b60e865ffa9f'
            '2435eb380e1e06c2e234f6abfc2e17e6de125ca7de18654edfb9f8ee8266e4bd'
            'b4d7d82df9d47f4149521535a109740349419032a5fc6a62a63a9dd2706c1885'
            '101ed8386639e96cbf8e673abd74fb77e24323d6a87e773c70a5cfabb9d586a3'
            '0abc3e25682f17957dd70cdc7175eeeae0013af15306fa5d85a1d219815358b1'
            'b815e9ff8b18bac9484c9974a0b8d68d42b42f269dbca1c10a8bf75bf129894b'
            '309cd798e7973e72d07bd74bb6ac01ba32e5c1c3cd43fba8145fb0c607530ccc'
            '875dbe32aa45a0f190a9ef8544001ac65678bf2d0de04a4769bab78c79dee6b6'
            '1742904e722975b70765e76f34331b292e0c472fd16f1dbdbd458d549d0dffef'
            'e22d23cd1643d424b06d53b5611abbb67154ff895ea2e8aec29f4bb3420aad28'
            '006ac4f02a05ce822da5f33f466d26134a65b0a12ef3b4e47a38b7b0d2af5df4'
            'f6171d08dbe54992f1a09ad9b7cf23f467011dbeebde35206687a9c5d46ddea5'
            '6e5fbdce1447e58c1bd1312b99c7a2a49514bb4f0bbb755e99d935aff2888b54'
            '1030dfec922bc0226bd781654f99e07c574e654b454eab4be1408ebe4d82c95a'
            'd0b164a8cd2886083b3cde3bfc3285967be3fb0e31317a03c4bfe53c66fad5fb'
            '36b50f844a6bc96c1ce10c092cab2a70ee3e39eebaf171a6fa562d54a803c91c'
            '4657a4d24a3859695c49e779230496018a6a4fac9931030515be01fb95fccd9d'
            '8cb6d00a2bd456cdfd7332f48e42c2381cfb7db331e310eb87ad45beb797cda2'
            '1ec93dcafa1ee2144bb6093c7d71be3f84c49fdb24db86f1a9ae90b7a9857b54'
            '102d179ddf8085428b315d8f6a0bca71eb02234ee3f64d0b866ca0b88e9a3e9e'
            '6845749dabf2db2e2ba60961c60834884548e1fd219ac8730eb44577a1724751'
            '8ab2a584b7d58bb73c0faaae3d350769e9036f1dc2ba386142505d60adcdc129'
            'c899f216cec2b6eef9dc5cdb7e414f30b734b71cbbbfe8c6af113d6f9f6fe4d1'
            'c2ed3732e3ddd6d0eee7ce3b7f713ad04dcd8ff2190f190db35b752050fc4f81'
            '0360d82c9fb867b1a70823323fec568644d66f5cb68ea46552a5ff7b63d84406'
            'f4e903bfed34c67845ad9bb567c42fbeaeb3166231d043e0e55f8043dd1e2e9f'
            '03d3fd2372cad2cfbccc0f480e96ca713711e77b7cbc947c4ddf0ec66e350131'
            '9aed9eefc312b94fa40b60a3c03bfa2f363fdeb566434deda26bedc7b0e183b7'
            '5a22928efd4176eab904567fd8205a65c6a9db83221bf2725b5e060e3a7352bb'
            'c7a44c391e72fb86c1ec0d2b8f6157dc115f468289d3745943e145628324644f'
            '880d6844a839b538e1e4e6ba64aeec0b9184dbe9e10f71d6c199ee43800eacb1'
            'c7a9cdc8e53964f76b1ece20c37cbd8a3d1709806b5df986a2e5c820f8bae403'
            '00380732f26f278a02af639d957bb3679340937a0e1b8381cf5559e6de349570'
            '69a9028fc7f853c192f901a4ffd4655d874122ae7cb5ec24de372eab84e043a3'
            '0c35a99628a16ad0379f26510e30aa97f5bea7ad62115207c8faec9c9997cce8'
            'a04b7735e117b0cbb2e00d08cf5a98ac79e2c238c59091be41c42a64a4620b4c'
            '032e1f34a11ee973f8df4c4c970dd124dee00d59f4e93de226f762cbd0078a9e'
            '04518709e3a97d8fa3f2eee2d8c64e74af4f6eeb8c77651e5da88bafb7319114'
            '3cd930f7b4adffd394af0b244ca29ede691c6ba436326aa92dc9e83a3e58cf7c'
            '969bc83c47db1e269b0e182f70c8323584a4545efbf3608fc15aca0c17682fca'
            '68ed234c5c120ce5a120ad5e4da422c3682f458da97e058935c10d518de5d4a7'
            '23f9f5953851d2c65808737b9a0aee94880ad3fdbca158895d78d9437914d9c6'
            '80ebc8b450c00f2090381d22bb260e4f3d8c7afdbb298d21af0c2e923308282e'
            '3ca1709e89659652a0f06632b1a4f78eab27964949b3a48339ca5af2a9a2523d'
            '9d0ae3d04daf3a17202abc6b5d796a47dd51a41a90c119e159ff277b0cc8fa39'
            '1436e1cad54aeec8d2b50ea99de3623a940c0559afad7f6ab75e88d264674b93'
            '9483727ed89599548899a0d5b513a7cba142ab23266f20d67e4c5c85d9ff4621'
            '18217d3116f81138ba66c3366506bbb043079812b650d7be18a13e4e6b3ecbbf'
            '21074160ddbc7ab92b8de1eed451dca29dd9651b29732c8ea0a69ba27510eedd'
            'bb674720228bf27f1a713554919853b2f3c156f941d51a676a97d35d1de8dc00'
            '4ebadd12a3aec217608fdaac3a70226c9163f7aea70b7e6c195c9a946522a38f'
            '261167619cfe7f2c538efe70fcb7d11531d29cfe58c8475336425e85d1621f28'
            '52efa21a6aff0aec226f0cf6cd8d42c48980ddc688889b7a64231e3289e93b0a'
            'd98b69dde31ebe358d03300d8e0c428f1de80e17f16e1326371dd70b9852b55c'
            '70f6e6d5204187c868c966fa170f2da1ce6f5f11b715bc7840bc0b2ccf3bf2fc'
            'ae9eb094a8a6e075b07af495e14113fb656439c456a81d18d2431e42a26b13b4'
            'd2a711539a21720d41b57b95a1d77c49b8b1b5ef0b3d3ebf4abfe3abbe8a3ffa'
            'd1604a2a7b65818d66361e9c9820b61be7a76659f7bf65899fedcef569ceb399'
            'c95ab7f3536e8a05c637da4674e65165cba7d55e5957d20e392030c0d9893ff4'
            'c878f0420f07897d954e1b8ab4d433eb5c7e86f6f13e0832549461e03a52518e'
            '4fdf802597c3151ac7431ac36e96881f06e41898f7bd86b693b2dfc410251b1b'
            '1b89b3e2e4f278f2ef63dc33a3121af9ebbe564ddc195c55db10e029331ca3bf'
            '9660e02c1d1366ef00c066d4d12cf77f2458fb6e4b6c0ecf80df4bd38234ffa6'
            'af2fd4ff18a3d067a857a9b51b21ebd9abaebb2e1d759cabdfd033c07ccfc154'
            'f8f9bea794da84da16b71a9e6438d7b9df4e2d59b2f75756b40f6b037c6e9d7d'
            '918d729066b2afa9b997eaf80962922237e540fc9046e53fa09e260ce276cc5d'
            '4847fd0ab57a4598b5f7aa1b0b9f36ba98ca4a3535456ed0389c92d9bc0efd12'
            '5700b1c0815c061faca2c28682717f5581470c803d93aebfe15759c6f0b8ff13'
            '4bbef73126155abea34db6c4c595029a0e47db7e7207f870d9e827cefdc22c1d'
            '9a0fbf0d0af8ce2b385dc01d7a797e829296b32b8fe0a73f1abad2982190c5a9'
            '74b7a362154bb90211113553472b5bf8f50c14a7aeb58e4c0beb0740b6542e7b'
            '2a7d461811df7884ff054048345c95d150fd16b10afce73fe56b6201765d8e80'
            '209a753d39d17affb97c10c7f05b132b12b5db1dc7418f4b15af9867378a6092'
            'bb216b6738e56754fb544bf8d69f282084f1c7496ce842479fa1615ab54525db')

