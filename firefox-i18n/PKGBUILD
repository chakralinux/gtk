pkgname=firefox-i18n
pkgver=43.0.1
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
)

pkgname=('firefox-i18n')
source=()
_url=https://download-installer.cdn.mozilla.net/pub/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('c7482590481bff8bcba4f99dcee4db44191dca7ff293f8b707745de5d3bd0194'
            '069daec06523466a5bbe07ca2f4bda65a487c4c68a4036edc53a2a5ff644be17'
            '02fc07f24233fc0e788ddd5f8d5dd91dd72ad4ac9107e87f63d1a817229ede5a'
            '4ffef875458bb919eb9087f108db2fe2d85ac818d225f38d8622613b8191cdbe'
            'd6f3b41bdc7745a845dab37e0184f340e6fbed5846b5b048a92547ccc1eb78d3'
            '900c6c090f19509a9a72c788c41f373c1da34382b0388baf67848c6dbcd6e033'
            'ad509f6f5ae600655295a4de43290fd82d3cc9493e21dc63ac56b85bdcf22412'
            '98d7cf99bf52d08e6f54baf2034603cd5a301790dd88032f110db22ecf880a65'
            '26561023a35eef7d4da834998c3a511aef978ae678b7bd408dbbdca03b947e57'
            '72e55d93e4aecba669f950875c8759754b3d8a7e3584f11a939fe6e4201bffb3'
            '14844ebfb0a8e670c2f2cafa369ef7c247aa0bd3265e9b12823c57549f62d4ba'
            '6958c0e2e9a79628adb3dcc6e5e9d717715fe6d016b265a578bb9f64182a995c'
            '2c9c1fd2c644d170d59090e1d5c99aab22f9d047e4a844a2ccdb4b14279cf9d3'
            'a12cb14280892e222be4b2fd9c0a7e1b908e3773e116e1a5338c0c2e0e761b79'
            '607ed076cc18a31fb80612da2b6f811b17b8f57f97ac3a87c2e53c7cb6b21001'
            '854ef7ca599dd4de3d7c21b822a44ab93dc0a08f58dd4a4e3d8120281c1bae75'
            'e7718792fec1cda9169137822b2127b6efab3d8da13248251757bee93bb43365'
            'bac7164d89d12c01311e1169f82b2b93aed78b33ba66066842ee605f0cf35364'
            '4fe8ee0cc5d4c4004a31b44717cbc287ab2dd3e06836ed843f6920d8baff3877'
            '4fd3613577fc67240d963b1bffabd3c7507b75c7563f815d76238a4f910203b2'
            'c48313e3a236aa16e9cac4ef721e31f30d1ea285939a24b8c8b6eda5cb39ace7'
            '8586dd112c934a4c0005387c79abefa83ac5fdf08c8da60dbef792e16aeb0635'
            'bca1b253cde0a8270b4a129796fbe5ef8667ac710d64695ab8213df27778f407'
            'b2005c98d03e6103bd1e22db9b02c7a8b01d76f4059ef9df1b147b5fba2da6bb'
            'aae3f2683abfc6c5e6f9da9bcd5caf7a7548130620bdd81ed55be3e0de3fb05c'
            '89a05d885e3caffe8af484385354a3978788dda3d557ae1e369bb7c3a5c941d4'
            'e500ce294c5503555b3ef20828136820781e933f6de0d26b0afd728bb109391a'
            '9a3195d13d01523382a34be7bec95f370e1b7a645fff36e64a769c1338c0ba96'
            '492ef6b874f4419cbd8e32dcb22bf77e89c0ef55e8f7bd061fcff645cafbf5f8'
            '18c6d2e5f83f7679791dce843f24c8dafe462b8486b3528b8970db2b6ed60e88'
            '6387119792dff581389318bb8a5d3cedae002b35e1685142c091eeecb8a43a3e'
            'ccb66edd94f203b0fc6c3f39b84167d39ca88a247a7018ac5b30ca97b28a7412'
            '73006f7de94255d086a0722dc72a8d41055ae9c58a33a18bf1b7c99187892e8c'
            '8ac7ea7cf450082a55b097fe8f1e74f875cfe5b478d2fc5b2e55759b96e562dd'
            '434bec142b1e252384d6a4e8e0e7b8f4a49a372c00d87b11de33ab74e95c5c58'
            'a2f9f98ece6d9ef160ae8770c691f625a1930f67be56f5c83c81ad1be2e88c8d'
            '39b2d8ceacb2a336e93279c0e1d2d5ec8af117dbb2676d845d737060dda45a2a'
            '4a8fd03392a9344a9c6fc4160bfd1e0a85a8b3d8ba57086dc87e9fc8d90bfd03'
            '24674513497ba9df6b087cad60216bdd602893906554eddd98643015202d9327'
            '3b1899a93a8ef44ad86e66476f67892757d6ad8a7f9755b56f6dd7620cad5d33'
            '1eb9331815d87fe7c33a8f48ec2766ecb84ec89bcb87b0d38e96c55e2afeb621'
            '9dde72f78c86511416ec86571d913158bdc3d2d878b873b2af978b794d8884f1'
            '67e87fe2c02c2c605641afa154fd6414db71dd33decdae395afbb7df0a46455f'
            'ad85faf9971be390570aa162521d403260521bda8ae29492b75d914db6c42f05'
            '6818d012587da21b5829e89433211a6e7072f65b07483162ccdf3510a7a8dfd0'
            '464ee601a784a03d13a44029888bf3257923fb4c9c0eca1b0662e25cad0f84a2'
            'fdd3794da3466244dfcf407f8f6355ce7cc68def1afcba588fcc6b8f3a61c29c'
            '2fb699d5ea820792a5d68fccc33ab834f15888e38ec2fc2e1f098ffdd261e619'
            '92b6952cc4927124096a5e18c7308ce0019576309424354c4bbb7de95131c134'
            '9c381e0470c836c63fe86637a03751d7ccab81e55b187d21f049283483baf2e8'
            '2def36f6266f6650d429a410bf6053e5ff984a3f0e2b3932338bea87e504e777'
            '1238bd0722c26c925ab53d0fb595df37f2faa6aeaaa86c3ae1d9c3612512d469'
            '1723cf9722e53321fc79496fd55bbc2726d32c033e8e15c7a908c44e9b5d3178'
            'e87ab9c34a4ac25efa65800c05aafd84d8d966a6d0843f342427b79c0c80fa23'
            'cd667b381b232463c3a0ee92405c7218f27f1d4a0d30db126954cea9873fe72d'
            'b9c1633f92c11e7a9fc6ff15371057c7092a9859fd8f7b0a1f58a3ad8f1ec017'
            'd950bb5222fbdbe9fd207c006ba3408e81bfbf5fe2adab0afca435f35a9dcf90'
            'bf9f13589238d59009c699f9a119e8524b0f7d0a236fe28ffd9a2829d966fcdd'
            '60e3ce95ae3584a6c0b8992a6866212d442be955fc26d5f3d6106a0554d62934'
            '4bb3a1520382694fdf0b7fa9021d5e909428dbb0f0765a3f253179f9440343a7'
            'ace68f3f59150c903b566831d7f907af216fb91b0274b79283294860c9d39216'
            '84f6f36401c0a759c7e368ba8a7fd853f0eb3fbbd5f40b970069d9808db39f16'
            'd9613f14065045e8ffe6c487b16605402d82f5a2573b65ba79028d671cb67e08'
            '384f781eae91de64e1a93bf359e1f2b9117338af3fa243bab108434516a6ddd3'
            '778f8abf6c7d609e6d95a29e5a7d94e49dec2d96962f7c36d699e11f1fa886fd'
            'a28ff66a0351dbfb30b8c1a29a798ddeaed7941958c3bdf049788e599a5fa76b'
            '28411a81dd329a574adcb69460213b9f31b2b3ee3a7206ba87b375ae32da158c'
            '8333a7df8f3ed2af7ce62c6bedd7ccc04ca4b9677cf081841d6df499fc7ffb8d'
            '6accba4f4f52d2d5c03a90300e4fbc60de79dd0ba09b5a214b8425a16d5dc608'
            'a59418ab5234b61dd9df5fdf170f4d888515b123707e491da6593b2c69b0c32f'
            '417a36a22467cbb201fefcb9d0af1c9dce727c85fdde8a40358c264cb2b4c090'
            'd8f2658c5f6247924efbe04bb074ac3dc64bd8cf090ce2e7cddda48031fb60e6'
            'ec40d282b73214e31cf5065b25968b5a672127b20967064fb3fd69b6420cffab'
            '7e29a192342a04dfe59c3212ffa418e200784268381efacf180e1b9941aec87c'
            'f1749a774615d8ab8eecd137e285826f9d7445b1e232be15e3eaf7e1e60afbf8'
            '29e9bf6a627d4690598be3c4ddb4ce5bbee0d906392daa5d885be046f449a4fe'
            '866c3c050e8c32175fc93c186584f1a020db008f58fdbf8f557b6788ce772fdf'
            '83192cf87ff9c6b543e30a302c6adc4babb201b7d18e65d378abf80866bd9776'
            '46c79acbda550fb5b03d79a86d6e77cb61d4c694a98f6c5d5fa364b05321bd53'
            '21c96bcb9477d2f4feec80fa15c54209db63c856727f86522affa45a4bc3932b'
            '848298799f568f6ce08387b8fc04e507d8bb42f9bcb1c53fff19cf11c5b4efe7'
            '1cc576f39596e9272401bafc4c852cdf336ddae2d45adf42c29a0f9b7fb381dd'
            '88c5e7b20d940a3d3cbe73c3d339117db1359dbcaf28a61754cff30682fdf974'
            '05f5c395ba898832b88e2918609f591dee5163903bca1af15f840afbd0e5184d'
            '8dc6802b2f4f45bc86f674a671d1edb5b4515e43f3c078e204f139ce4c654492'
            'd6d8e785d76f0d218d0a30cfaaacaece2b7bd7cfbc8758c1200b690341268764'
            'f6f822581bd75b91fc7fbcbeb3ebe488f806edf28df13e1f76183c7c223abb60')

