pkgname=firefox-i18n
pkgver=31.0
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('any')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'csb    "Kashubian"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'ku     "Kurdish"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokm√•l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
  'zu     "isiZulu"'
)

pkgname=('firefox-i18n')
source=()
_url=ftp://ftp.mozilla.org/pub/mozilla.org/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br csb; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

md5sums=('e2718ded082cd15d9b15b8e281d0a17e'
         'a9ffe499245027a2d1cb5f80e8e66f99'
         '66830ae7f4166db8e9775bd71be7922d'
         'b77e7bd6bc9729fca08965aa7bf6be80'
         '5d1a82ea2711a50e0d40392c1b6dd200'
         'a09ff9e835985f25347b9183998c1355'
         '4024ab01766c76e729fab83ce5846ff9'
         '5f0021b896e18b64cc743572cb5e97ba'
         '243d6ccacdcf2b8c694f47c590e8078c'
         'c6d39f729b6cc436b54b83b20ad2e689'
         '6a17599f43144f573aeb61bc8e5cf855'
         'e1931fbf9b7d40601c04f64b73037cdf'
         'c8a4fb43f6d4c364af886ce628ba078d'
         '7105d689b9e398902f570fbaa4cfeb4d'
         '7cca3d57502826bc92dc0e899ffd7d62'
         'ed1e104d61bb99ec7b238f43deb48c8f'
         '3c5b0dd90a991a2676345b17740cc7f3'
         'c87ec769317b7fce06914170cccf327d'
         '362ce94943f03eaf87218db1fef01e1e'
         '93bbdda759407866a2a3f879713ebc4a'
         '660806aa23f8e784c7a5091ce91628c4'
         '0bcdbc3b305165899bc8ffd3bc6d3e84'
         '6992a4ab03e281dc495628fed0528ecf'
         '12785f54f0acf27dc67f8ecd92f28f56'
         '40d42dddeaaa5f1f6d4edeb24d2df660'
         'd197bdd4d982ff62b7a6a0133d2d817c'
         'b062180f86346b7d8160cd948bc253d2'
         '27a2b19897a9d812b890eddc6cb14f69'
         '8fb589caf5f0a39c4786b1ea3966e1fb'
         'c8513ac2733fcaef2aa4afbe6fb87d20'
         '657af0fa3f0618f0afd3c889ff82153e'
         '59c9ccdbf7bf93dd3ad135c9a225afca'
         'ad153baa32844829de3f6824360aea0d'
         '1fc8f29afb5bfd56381a0cc6188cd658'
         'fbc803ae4bd7ab10da735827de4ce795'
         'b70f48984d837d72c9094fdeec72c2ea'
         '409316195127cf18a7e5415a2c257d81'
         '98732ab4db16189e8113af9440f6f50b'
         'd091264ce24929a537a3f96960066fb4'
         'b37fdbc51bdd558f52001c8822342099'
         '448160bd6996a7f5b66738a88f824860'
         'f85cf3bc26b9a7ccb111361db8d80d40'
         '65e15dd7dd6a8f1ef35c14b7c90e3c4a'
         '07742e16a889961397a3d0a24f5fa310'
         'c16edec207e0b4bd54804bc473a89d3e'
         '002a357780275ff25b9fd2ae8f24e4b1'
         '8267d7cc0d35c9252974e7dc4fa8a1b8'
         'a90e872b92a2c30e0253a7c19024425f'
         '7a2a7cb33c6ea4a0d42afacdcf78ccfb'
         '01581aed654bbb3f7c45a190d1d0e903'
         '4203db5b4ceebea78dfd324c28924dc4'
         'd58410166595179bed22b84bcd0d5416'
         '3abb6127359789f8a8c55390511f93e4'
         '03b4bd13ce8cd2006af0518cbfd00d95'
         '6d9d578c7b04ea0b5db0748e85b2c7d3'
         'fa6a7b4bfa67c1ffd44e732f205e4d50'
         '94d72ba9d5bc5d83a52a0293295cb3c3'
         '36f1fb8c6950b65d7b309d2930d00806'
         'f24833168da365df768a1c817a788460'
         '64a634d1aadbade6f097b2107deda439'
         'c581d4e4ee415ff9e52c360a34d1625e'
         '7d13ac4c679f595326f03c62e7955d84'
         '925a0cbfe321ed25d96d648f8d381588'
         '34e5276c8c7deb8a582766df51798601'
         '2510f2941b91f41bb205584781325785'
         '40d05e711514a3aa3acdc8adcf2880e3'
         'f5b52d4d6e3dd9aa9dcd461c5e651dfb'
         '5dea637a1c65e02ead40f215b633860d'
         '0f30ff96d08f820d71c4ae75cd788403'
         'afd1796c8f22d76549b9c326995bef45'
         'd8352668a3a99688960340f53eb470cf'
         '8d203e2d3fc9d31a70cd5c73a6c2286f'
         'da4a54839bf14b5140efefdbbcdca403'
         '68375369f5a4be7f0e637aea21d2dd5c'
         '85049cfedd4f99809ca5ab0733f62d2f'
         'd9001726e01826619f8c9ca58f406f15'
         '7494bd35268a3e4f39c67df78c8a3ad9'
         '026f932deffd9113f1c4ab294ac97a83'
         'aa8035ddc5938159c466fa0dad5145ea'
         '73f3ceb92caa4b11de910dcf570423fe'
         'a69bffcf2019f15b6f47526e81028d82'
         'ec94e171ed779ced99ff7daba1c9f173'
         '6c40afa8baedcc816ce2fb97f0d5cec3'
         'cbb0b66e0e9084f0fe40fdfa870e44c9'
         '6236941181c894adc423c43d8423863c'
         '0dd049e8422737260551f614dd1b69eb'
         '631fc264dfe55f6d677b86c72cb41aa6'
         '52c7c71c8a4f534a76aec3f9075138f1')
