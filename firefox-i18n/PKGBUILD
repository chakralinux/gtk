pkgname=firefox-i18n
pkgver=39.0.3
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
)

pkgname=('firefox-i18n')
source=()
_url=https://ftp.mozilla.org/pub/mozilla.org/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('e267f6c81193e40c41fa9c941a81b51eb0a4bae3aababeb0967762f794f2dc55'
            '2d16fbb6e1c9bbe2438e4fa21c198935cccefd60632dde2207c5008f2b416f81'
            '4535529d5438b3e5ad167c213bc808b586e3f149d979ed91d287a8e03abdecf7'
            'f62347709d2015241e70cc217b680f371c752364206e4a9752b95436a968d0a8'
            'e87f7667e3d70865c40b0650580efeeb8c758b4d6ec2af1b8201caa6073c2ec2'
            'cee21f4e2be31eee1e853a991e43ab43af8a9c165bd8d69d32a083b10ccb821b'
            'b64d18074fcfe0315f6e4d5277df15c515061635c3c675c1a566af4f300f79e5'
            'f4a6c48fce79828da1e31d2fc4e97ba33bab96d1b07a3ed5261f8cb0f751d151'
            '478f913c58a5c577122ca6b42a2f303e47cd3b4479b83343feca3312c858ec01'
            '5ae1ec365b51f59dc6ba852d5030cb4a7489aa28df66491a849ad9dfbebf0e55'
            'c05dbb4d7f544943f552b182dae0b034bca0994e20be510190825ef115adb774'
            '21874a8ac8111b062237e340ed98aac4757db11a2b647e7a6d267c382abcd15b'
            'ba374ee4b40fd2aeb04f094da384964b7699f5c639b294c3747aa5b15e81ca4b'
            'd86ccd6985835c5508833000d30e9be88213941dfe190b586741c34bf963b5da'
            '4d85c2d3f52b5484a325bc64d815fc573f953181f9b941f8c2e8af6d38d0b4d7'
            'ba084a3fc418f6d85122c8dc4abf89f091b81cc9dd98d6fb0e0c8d1631f82c34'
            'b141463063755d5c861bafa119678fa054fb7eaabe991d9b79fd612b468516b4'
            '62f4659e983ff26437eb93486ad662f7658198c34778cb527c1198c3a5e6dade'
            'd081044c3a855ed84468cf9f08f988946f7548e89a799cabc910c9fff5442d9a'
            '43552aa7e215b3fb24cfc736dcc63dc628486e0b978857039265884446b026c0'
            'c44a005d16d1e7a416a41526cb2b5fe27fd51f91bd91690c76e73cfefe8aba68'
            '04dabec994f3ad50496e4e75e99e0e0bbd8b6dc0b9a0ebfc5f229c6fc3044c44'
            '0e2b5796173a86891cb53cc81924b072c1276049298f76571e3a8f89ce5db29f'
            'efb046796e57841cb764ed8db3350529b9fd75d1cfa108d13697d151b1343f52'
            '34a61a3968706643de510002e5118587b08881c58eaa64135009a3aa517f0ac7'
            '8d4775ae58f76078502d6211af9d81257eca288f5cb19fba4bedd856f7bb6ad3'
            '5ee4a4e63a99422765d9fba277df2822a8adf31f2f26cbf00524c1ec9591e0a7'
            '8af89269b8d8698f7ea78721042410cf6f4dcb75b88f5e23911e525d048b45ea'
            '7d0610e415c20c2634af2230e77ddad894c526df8129d524f9bf413b5c810d07'
            'af96a85399612305af4ba31e38dbec9ee062e02c0491a00996ad1e22d1cc390e'
            '956ae72526bd07ce47d2ed44779925d68abf7f17752f8d6b020833f44a96b88b'
            '5bc3c03df03f2a3f8eda0372ac3be935379994324a6bccec69dee5a329a1ccce'
            '51729c43e9b84f40f751e80c6c815c1fb9e5a0e6b35ac3278bf036a730e703ca'
            '582a83dfe8acdd9af225425e194759ce38541052780541bb52e2f9e5bfe4b13f'
            '3860f804afed1c834e5d744f6eab894e1dce61933d3552c89564f754a1244df0'
            '89b0b9af7cabf4bad97ad014f37e3dc7dc40c5bba064365b85f665877396fef7'
            'ecf81f5795f813aa4c432ff5ac80bdb91a2b84cb0a8480303fdabfa3ed098896'
            'ca2f3adbc2c48a377efbc21441148de828274b29a3e71a258b0ba0f0234c645f'
            'c18618df9625adb97c6d057b745109e23fab32fb043cf6e017234591cd1934a7'
            '4e7073230e4ec30272577e460870580aa1f8439403140c16da1f66ce187de2f1'
            'd3b4294a8a322bc8c2d8f04a18468a899c5315e1654702b8697dbc9071e7d963'
            'ee41b2a4ceee81a0e98a13ac6b36c474303de2a2f48398a6a3578e3df48adbac'
            'c25dfd7da199af47b22b85a8077b4cecfba2d535f07bdf232b03b2082a936812'
            'ff68180a3f1aafab2429027942442456036742fda5d786eee7a8f7873b3e9e4c'
            '7a1c74e08b1d3119159f74cbd735239b5d49bf26ab22f0e90a5eb43d3394dc1e'
            'fb4548dd3b974442b1c70eef595035eda26febc5047a77c54e098c41d5279c6d'
            '78b923a778a88e02e960c5b8c0fea3a2013653cbc80af2873d53d6e3d6701f02'
            '5a48acd26db30e614e9a07b0d740ae532e4ae1e59835621b7b1b8530d220f930'
            '1d86ee2fc0a09b4d17247be65b48d7e57d5ebcf934a832a3e55679e58b58fb34'
            'b7a4ab2e1169dddeddaf9444c30dab6b2f46b3977779f103ac97b553d03980b8'
            '5bec9607acec56d5279d6b7d047dc6aef7cf2e6f362e813b221acaa84d44712a'
            '7032d967ffd099f4cc16dc066c7250a11ab927e7e76c85da71bd38fe369c3042'
            '79116329bb81e23c8375c7e42a3231e6d90c6c09d5e502d8c31dfaa73982d6b1'
            '450e3dcb520508f91a70d8e9b70c09d976080ea3f30a1ada4e2a54726d08276b'
            '2072d22e2c5c41a966ed7e5e9a6d7eb5b8a6482a5d76cec40c4faa90714c71e3'
            '218aae046901172ce77b4aff87759bb378c84959c71ba3570a03b46e6d7fe4bd'
            'efe07b48fc3d9fcdd379a52efd44a92aea21dd30ec9dee26bef8d00c474bac5d'
            '6f29158bc18a3f57796faecc240c89530dcd6aa9db427f34d581aa2727c1bb87'
            '2f42d2c7bdeeb589c937009cb08684d649ad9082bc55f29b763b11cbf7ff22ce'
            '4f4f7c21a16f0a6352591fd226a7983512242dbaca05dcc16308b20d4e1284d5'
            '7222975b208389342eed52e04b442977633f615f2691790878d0b96b3a235b2f'
            '11f39537f67430f4fd923e04e2bf2ccc9f7be6775faa30eaa908f2ad57545f93'
            'c23908125e47c9e37cabe70d044b17e67dc4992298bf254c75c049af894d0ae4'
            '1ec870c332e770f9443d2401834dd8dba357bec3b774089418acfe8f78bffc51'
            '23566114d56205f1a5893f661ae8b82cc493bfae8e27912f974b225f06ac10a3'
            '6b4d0bc95155427907b3dcdefe2fb20ec91734d6942b5c2493d485f2aeb4704c'
            '705239728fd78a98430a86e97ab89a2cb0a26c59944815f4343d6334313f835e'
            'c15e40185b286c3ebf42cd9705547e66be279a417c99a683446906c73d355296'
            'd35c67b2aecdde97d37072b2d0a02542d14fe85f6d1f8f660d34bf4ccdfb399f'
            'd7dd4ff485dbae4ed85eec56593aef9454a44d93f727b40d98f54f81b7309711'
            '60bb2b6e4e86f334092469a740c0b0cd0ed8ed8c7c2194bc84594abc01dd14f3'
            'a60d4b8ac9a5036cc1942c454ac2342335a23ca79e2e8c6ba381d40ad195865e'
            'b183e689864fde894e6264735e937871cd6c7fcc7610f0dd1b5e4c8bb1892f3b'
            'c8556775f6b6459ef21d59e6f393c10d1e0d42049a90321ad28c149f7ea98f05'
            '6bd33d78c61b23ca2b01bb91ca14ad4290ef97189f577b98370e6a2f68d3e133'
            '635a5f4a7ae21cb5aa9be4df90f91b41e18b2cf9787784a8957ac960a032d842'
            'ca24c9533080266169213fa3198fd646cb70c8c83bb3dbe34dbf81facbafdb71'
            '22698b376ef3d7c899af5c73f1d10ab9add1d112e2cec4b63f973b95aef65897'
            'ab83f3fac07830e6184f7aa625855efb5dd83095052fcd658fa364c5e1bf642f'
            '8adde57399f33f687636c065c63afe53ec0fbd7822b8e4d2da74a6f7ea320c2c'
            '3ce8c6050f7b45e76487d354abb9c23e0920bea547bace7d2ceffd5092bf91a6'
            'd8b70172f72495dc6302471af741a3a89f0a232f24a27f9dbcd99f73d23af773'
            '24612cafa5f169443db426e35fa27d09e8906ca43094af4b10bc972446f04944'
            'd982c46aa8b38391ee3ffead924e1d5835c91a314f0fb486f81beb6251b7519e'
            'f40177d68a81ee22e77896347e381611d34bfb74f6c2dcb41b1d4f9f42866a28'
            'ab03f2c9e2b1d866de15f196c168c7838693c458ed801d800844c8e121a94a70'
            'bab80012363f2d97284b8b075a3f45b27db283e55ac79358fe4e1ae8227ffa2d')
