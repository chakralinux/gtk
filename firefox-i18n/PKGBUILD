pkgname=firefox-i18n
pkgver=46.0
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'az     "Azerbaijani"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  #'csb'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  #'ku'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
  #'zu'
)

pkgname=('firefox-i18n')
source=()
_url=https://download-installer.cdn.mozilla.net/pub/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('b7410a06e195e990dfb82ea0056f296826ad1e0688caea4e82193f142ee8d9e7'
            'e546164f2d46b30d90939a8ddfcb435fdf1b516825f063875a429b23c9662b68'
            '7bafb75b42eff5b13fa88ce8349d22356a1b6733a2d7ae409fa9f5859a6dd738'
            '9cab946759b4c870e12350745a07ff9f2b2f2899650d527c4e4b5a9ac285ecfb'
            'd37fcb9c209fb05f92d4e6fbfdd40f8ab7a87f3494da80aff18de324bb7c2f18'
            'f3392addf77c1a8d7b7c3263e780af588c232a9518f85d92acc1d7d47a0c8767'
            'b78be5fad08b153d33a2255a14c2b5319b04b814cc94f62faa7d0453d4f2e9d0'
            '38c167c5bc98679357cad89c67e903b7d3b8e6a12650a0eeedfc34c181a2b9e6'
            '9a0d0dbc3b4f3fe69e1f0b41aa9beb7b67cd8b814baefd521a0e6670a3961986'
            '7a1450d92c7a7fd88924942ac19e3db25a198b75c505b094204d44afe06752ed'
            '13addc6ffc3eac9b712e3f6a153608a76f84d8d41d65a117c75c92470f7de9bd'
            '7ca187281809f004d271e9f684d00e13c9ac9dab9553dba437be0746ac74c129'
            '141463551e1a861612c52fab33046b80609b3f8c954084852d37dd5357729283'
            'c85736fec0b3ba17cdcd823c639e524ce7e3e1981c6d962e1442562fb9df593d'
            'a2be9bcbd744f4cc084461045df5de194ed7af78eefae240049fb0e32a1f0439'
            'bb3a474fbd084aac0a11215d71a4681afcc424b59977a0fb1e8990fb3b84eacc'
            '25c99eb3bd264d22d4e810b70fe24588763fffc0c1ab8740ea2efa7e9d01f202'
            'fcf1cbf47cf286a50b6ad1b55a04cc74d2cdd7b8a3c2e657f8910b182024eabc'
            'c1d5192d937d8d2c3b4d813068f384f97e76184e7929f510121b426880176b08'
            'ff095e053b9cf01146cf8ebab22e93ebd024668df8351cc35f0b6cbc7b3dee64'
            'a493fb708d1e490730187af012d3bbce7ea3064a8fdb8330271429df4bcaf70c'
            '93418927b4b80455b8a61e33b08928ff01a330ccddf0bc8c7f7f1365dd35377b'
            '33a84f21651cccc44d8a45d19690c766626b442775d1c74bc9e02d85fafd0d4c'
            'af5175da6e4725bfccaad001b667a698628582c9b17f90aaeab1a06e2dd348ee'
            'ddf61a3ab6615104e0af3d340144a8545fac63ccfd1e00ddd3975f51b0c2cb6b'
            '9c63a1bf7e681201afe6da355a9fc44230b6a3752a1e6d54dad3fd0554bd3497'
            'c022c3fe2f42d48c4aa8f8b9c923811536495f9a9a681e0e422327c837215902'
            '9b69478532a154d8d9ea4af09b5e591135f821c50bee6658f47b6d75a226c8e8'
            'e71586fabe8a8e8f8164be3bdb28b46211c88cdeb0c2100fb83548364d686701'
            '7e54a9bb1e2719d6103a6b7cd30501297a11f04c5c4ac3573b74885f3ef5b3c3'
            '38d250f033df104c20217a1ebb85294f0b2d5b4adfdc08c6f923012415b3f32e'
            '061ec340b07e9ed818fdcdf1f24ca12fe42c5d910e6963b6e7070a0f32092821'
            '586bf928042cdaa99a952b15bef88306db61e847ce176441b80e1ffae3432235'
            'bfcaf058828a1f14cc879fb4c7f84ee648307c5cca77c4ad5401fdfb95d8e725'
            '6fbec9226188f3e5a9332f6e465100c8d2a1bf23212369e305f2513fbe9691bb'
            '3bb0444817dbc1c7eacebe7b865b772a507bf1bae4fd83d9adea7ec2fd442ce8'
            '81a04c1c1344f962d53714fd42b149d723245d979180e942ec9e600066cf37b9'
            '1621db08a449562bea42102cf3c445902fd29a4ea8e2ca1510a21c0b5c2486fa'
            '66ce572cf6454fe56758ad7c084fc9bf4a150898d0bcb9162cd542c76d0cd49a'
            '63ed58f1089b78dd132c382504ef2083dc82b3ee2831278b690f3dbae5723156'
            '214391367a69ebc496387e608168c435a1be366c185bc6a7ceb1abab971bf3cb'
            '27fc4fd380a0b9db5da410faa62e18f7d38b128f89a9f34729227f67b1f770df'
            '735f33d1843486e3835132f6c80beff63faa33fc483ac62d51b3f04f2c3f8e17'
            'bb59045bb7e305cfe5d9695e22e313e4bb15511883a1ca04ed557845f398630e'
            'cb32e022ecb086c34bc3d7bfc7fca39dc0fda9019189f711656f94508af6f983'
            'd4edb236042898559d5e45ff3fc65c9e80de8aa35a30137ffc3bf1ecdb66195e'
            '2f1cb49176de20938887444b0d86a5503ce8619b622422e44dafb07f98da3156'
            'a2c979f3b08c701ab5b45f311779bb6e0723dc43ee46f944de86b8b74bf39895'
            '144d3546b67a610e17e9e2d09608a0b70c47d3ef3df37b657999730816c19325'
            '9eafdec13fb7140713884dde2c4a2040e3c23edf652d26ef08502b2f285049fa'
            '4bd357c3247f142385c85413e738fabfc77b3d088d177bcce821975929c7d5be'
            'ae8e172d61352ef15f9540e77ca450bbf6754871633ba0683937f3fbb2587fe9'
            '311ad73151e80113bb64fd818afcb9cccc7d7ab5b2abb543d7de6d7dd5642488'
            '9d5537d78b61be25a314c19128f7870e4223ab27abb0bb94ea80ecd3b71375a3'
            'f9db6db14ff83f7a9f17aef57db73765ca20410ac9a862174f9fb0aa1ed89d97'
            '893ef5ef89564b6c89d4b59d36d3c9e6aff43adc6ed00d21af4de6bbfc84f6d8'
            '4b72f4e41864ccb1cdfcca905dcd94b226c1b34e8c158c41c6541381ecee0522'
            'a0e4e8821ec7fd15e3a381b188ed185d0af1e8c0a13980109e02eec720a12063'
            '4a9cf37455f8c19f2e34102c5902cf6935bf34cc45ed25a95113f849a9b460d8'
            '150081330d5281e98223c3b555b558a3b16fedf403bd41796e898f66066e583d'
            '9e7dba2e474ab59e33ea5c0303181963ed3d4ef01eaaae1a8d54c7c566113800'
            '4638fe2eae7ccdebeeeabb55eb7c200cf20b014462cb5bfbdff228346f22be77'
            'b310a0df5ac248520ff23896c038d0611773d31496104fa16acc906c98f19f36'
            '4903268769fcb1836ec100eb1ddf2fa8b9056850b6812a9ec194704e166803ed'
            '8baf78d3ec39a88251e2645abe3b088932e1152a600be91586731622e7e87fb8'
            '17673c127e2b89077e2ae587d7636b7e7c6dedf4921fd1cfb75bdcfd43ce0f50'
            '5968dbd99c1aee96c838a3cd40e9267216738eacf43bcff7219de0a18cf56352'
            'feb5a3fb97b0cfab3531a18b10cc1cac9e792c7927d162e31471770b94e058f6'
            '121048bfb02f189e7a898ef9acbdf74eeb2583da0c2abc4980865be29b7e0ce5'
            'e244afd5e9335924908da99f786ae2dec13b5fd8a0907bc1d39490c80694cc9a'
            '4657c193b219083bb2bf8abe57bdbb583ee2e697d1e6d9dd90099783dca5b6af'
            '6888e3bc3fb215112703dbfd351fd38b0d0ef239986593922cf2469e2f63970d'
            '6ba27542bc73f601e6a37dd250720e146d7462b3ee9d0711659c8b03587e2c1c'
            'f4a72cce9da6b186f74e182ea6917a553244bfce62cec19baac203020c89d0ce'
            'ac2885c05e86c9dcbfe3295ee5c4e51826e3c1c873b7d6b4dbbe7b0549c4defe'
            'e02031d6e3f654b5e97b0a7550edce1c26166332eac1fa06d27757383eecab3b'
            '78d99aab738dcdab812cf2547f011ea1f2c76869f43d4be2d545b93f07d11e34'
            'cd7664968496e888bdb92c6c08c6aa53707f01326235292555000619315556ec'
            '7cdcd6584d11f0b6653908751b928303e82c954a452e6e2248b94d3fd6318783'
            '3b551df4c61c36ec18b4a38d3ad934e8df90bfd67f1622fbfef8804428feb69f'
            'eb7ac9a4a851a3d77acd68bc37378e0ed4c561883281240d697d4fe842431754'
            'c8c24b6be6e212867bc8418cd2e641a9b339659eaa0326fbce75fbd7d5ea4984'
            'b964032bb89390782a89c0a90a42b927266a998fc5e0f561324ad557b8ae2e3a'
            '1caef90fa6bf0ffef04c890b86d4840b09d2f1a3c1a48117f1dba6f211df06b6'
            '5a6a49861d6b7452dbfd835b7174f06119baf83051ad39ac6b38372fbafb7954'
            '77282bb86f29420120e1d4de3585763a7e8f5a2b463f21601ee43caeee76308b'
            '90b2f6133009aa87acdb55c4c1ad27fd7c064d21c4ab81b6977d5083803804e8'
            '8918f54154446fb3c5fc4acbe8f3af8ccc8fe559faa7b30bb301b8b8a701ee2f')
