pkgname=firefox-i18n
pkgver=33.0.1
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('any')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'csb    "Kashubian"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'ku     "Kurdish"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokm√•l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
  'zu     "isiZulu"'
)

pkgname=('firefox-i18n')
source=()
_url=ftp://ftp.mozilla.org/pub/mozilla.org/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br csb; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}
sha256sums=('8e0db8e7d3bdd33c371b6d5993a380f6b933b99420604897164a51f3411f117c'
            'dd455f4939909b7759f44299222e55c1348becb80cef9d3fbdce922656a54a57'
            '7a8e64a0076dad6df4dca864023df44b2a72aec48c274caf8a115dcaffa89f2f'
            'ca0d7f08123e3a000047e47656bab8aa401c130becd6d2a3b9122313b61d2403'
            '6750ec6126d9e426ee9c80fb1592618fe097b67a52f1ee7506b6d4cc0f71f4b1'
            'b9535cb93a93fc3c14fd6fe38e74d0b0dab4d3dd79df2f3ae303d2d76a2ded89'
            'c0ddd02f7ec060806cc5727adf15e8198c30b05fbb4754845c24c43f83a75c1a'
            '27878c679c43bc95a9f0a9af3ed4e93755fe25eb4bbeac691f0d9e5f9bca1a28'
            'f22a6e278f2ea06b652cc9176f3b51f098a4046032eaa41b4e73b58a68dcea42'
            '0cd09fb549284b0fec849a9fbf82160a81e194d71baab4b8de00cc4eacbb0672'
            'e51a9deb873a4f4764d1bd70dd409a757752aa5f127a8680ac505908345f120b'
            'aff9b405405a46e4a8a58f023b9ac82ffae0149d34b7c352bb203d3637c7d5c6'
            'b6d0c603af3122f72ce7ce7ef72d916f1d704247e752f513274b77db46a6cb7b'
            '74a29e327b61562bc282b8fe52af313438e239fda225d0175c335de1844aaa38'
            'fa9c86d1156379f2d7c97b92f535ec19b4ec10b7bc0ec1f6d8f4d24169e3cde1'
            '7db67e3c9a714df7f7e4a8dac8ad019654dcf50dc6152f2e66503993c5c27daf'
            'b4b800293e2190eee477022035f47b681853a670ef3154077b2f714ce622a634'
            '79f9a88908b5d34dfc6dd1c7d5d470b8d14f5e190df00a85c95cdf5c1efd4870'
            '4e23ee2e52b6c3e9af47a32fccc593d03a7ab341c393e57c58fc9d5255ad5b21'
            '91de68a6f565a5568559a92ed17c4e4179429b2e85a8f8403a2877e17807a504'
            '4f934892403d0e05123fe5497640bc624ead35da2b9ffa99d280b0cb8afccb93'
            '0230cc1fa48426d58b7c0b8159e82f68360c8eed967798782f0381cac25854be'
            '36570a40bf439445725ebe3d5afb68bd74b6112e148242fcc72dadc53d6ec32c'
            '74ce6a55d08fd8e716361c3bfdce53b0a0e15c966f8d8ded7e7186477d60da51'
            '10af4a19c86d7d16c8786d6ac1c310a5b5f999bb03f5bc90489a9cd9e730cb6d'
            '409bf0c3323bbe77957ecafe7715382b7f05577d4b21f93d0087c75489b25d88'
            '26262fe5c1ea5a9d92b1763f7b78271ff53c4a7f56253f7248a48187a39b7b15'
            'b04bf0082ea1d1adfe24a9e40bcebd57ff26fd79cc333874b40d96a342187302'
            '6ac8ed57c6cd54ad262dee9f8a1da0acc172c9f993073d74bb3b160076be1e82'
            'b9eda03e9b1e2851daad3957f8bf42e630d5d257784b923ddc60bdbd28ba0d11'
            '1bfd38fdc242e6de3176778614cf33a6cbecb994c04f4786778c493558e10df7'
            '332345597ed30bf587cb17bd6336b8adaab747b3196f305fd23599c830daf046'
            '0d8f4ab33defbf517e8879ffd50f5989a1ae21b96c85eb0681bcc937a2cdabe0'
            'cb1ad968a24566345d2c6f9a2fdbeffc10e8d97e35d5f2cda5c38724df4dc177'
            '03ad830e813646ecca15e61e15655ddf9b8efe85c77f0920f2ec98f561528cad'
            'efc454d0f9fb99b1c87d34b63831e2c4764181382ff0714a74637fd2b175a27b'
            'f6b93cefee92badbe9ce630ebd4daffdd18586d6dcb10acb301026260830b09f'
            '203f53d00156e5f962c5286f115994584d04e5df01026c7f956b32c9a7d1b34f'
            '74421af203c0b3468e79a3aee05f0916918896ef9a978d1ae159fcfa0a4bb84c'
            '3d7da427ce518a467ad21bca1cbfe9607f869e2019354636eb4688b748c375bd'
            '4df5ac83cd88bf3f1ef0acd505057f2389e9d5d4a0a64b12cfe73d10553c0055'
            'c6bf639d994070f35e325b8a45dd9408fd8d14a7fa7688d34d419864edbee292'
            '303cf1ab045c587a3949694d0109ae099c10829eee7860d0e41229fd75cfbdc5'
            '7ec153bde224d1643ff5a6a117bac5a756749485da202eb4b2227d0b161320c8'
            '6e6ed9e2c18022337850a43755afc2846bed6c487d423f5cfb54e5461dff73e6'
            '87c2c42bc1d842266ce88a8144286d36f1183c0ceae8ae317b38446f26691d70'
            'b609cdf3b64d74754f215c4c62b4aafbd7c13b4f72cb2d10e543e4d7acc4c88b'
            '380723fa1e2cdc702420d57cbf55e7794d69a1801a69defcd58a442bb617238f'
            '9b8746c76f8a3c79262c88e29cd705f8244e7752126d4b48f54bfa51feae4812'
            'b518dc9b167716bd930be505cb68d6e3e1a152291c10bfa375ebae7bbab5124a'
            '7542256c45b6a9f570ed57f737bbaf623899cad7d87b3cff2fde401e952760bb'
            '95051686bdeb940838ccc1e048d14c63a84ba98b34da2d08f1c499ab7ac792cf'
            'e42206b8aa92846a65ecc969c8ffcdc4baa76b5cccccb4dab61cdb4e8a85bc56'
            'b2e806fe051535715d48d6337bcfbbf03eb246c195a15dfa1d1c82ed31e4eb54'
            'cafb1a797e2506d85a1a11d5d6f3efcc92240f06861d4a118608255cce999757'
            '81fcb1f443dfd604ecc1c873c100638a2208b90b7ec6395a9cb58b407f5d9a3f'
            '44ab074d90a02a1284afc7224855e53d9e429930692db7c16eb13c2ddaaf8833'
            'f69823a28ea736d6aaecf95b336e99f4a2084cf80817c0c4840e5e87688ddb69'
            'eeafd0fa626be84e7230880380bb8898036e0645bbf7299d1d13d43e9b35b2d7'
            '3f6ff53746cdde50181ac5d46ff2e5cf0c1dcb4bf3ab90e99b9a288f89fa056f'
            '66e97d24ad0c5d0dce0dea6b791a4847d60ffef6f6f6dbde4b1f1f4d30164b8c'
            'd83991ab1a3644bae82d9ef0536d171157973290504ed6683650e1f3ea7f2f6b'
            '89e318d9a632285f66b0a06917dec96102a0cee82bfa66c6e0e948d9ce96f98c'
            'bd243167d05f413bb389041c4defed8a391ffd438ce11963d6f2c382f470e252'
            '7de499c99d68f44f621ca726cff19bdad66d858999b7f159901fc92f880916f2'
            '3931e80ee6cf8b4b4f6d34d98ff3fe77e344ff44cc41f883ba5050510a0872ee'
            'adfe44102c24d192830a9bd80bb9983c432ea269ea6f468b5bb10be7e236bb15'
            '4555e4bdb0bafb5cda01910de79a0fd53aef33c4c8020c45c636e0e3dea408ab'
            '1309bfc1f0f17d5c539649b0130b30c8a4000d0cefe299b3c9a89b516eb5a80e'
            '1c48873ac0056d31105371c336779b863b414586ffd38212143e5de4fc96f662'
            '532149883f0b07fbfaf8484448def29ac76df5220fe84df6c7f900231bb4ed4c'
            '78a40ae727f3397b704835f6224befb501c7ebb6b5396b90d553ffe844012846'
            '7fc7539ea9ab016dd7f04de4e5fa1494f6fae712c134e482a6ffc652340ba588'
            '74b32e596b3b058e4aa10a273484708326ed53049ed4f5217ab266d3f8e2a50b'
            'ac7511b21540187dfafd7a9a5b22ed4bb069bbdf8f5dd3d28ba6d1ec2dcccd58'
            'bf4ec99b84c0f13623c81717a8c6e612560581ee4a04e600301c7af82535f10a'
            '93aaa2d497287603bedb331d2c645523c0999ed25a7dd69e22fe109884278567'
            '35831652cb39e9ac14030ac79fed07a5d54962864c8f27cf9883b5fbfcad0fd8'
            '2c8845ee5a38c1b37ae4f77623e6c24bbd560b6c676a2a0aa4f01542f86c06d8'
            '6bd70c0dde8b37f6c07b216a70167307eed5d2bcdc045d7c6d4e41d1399dde03'
            '8a169586096a95270eed8a2304c6342d3c035dcafd5d78afa78b487b18aa7ad0'
            'e49bd4609e5df676d4efc551e82215fb77d3c48f048be8e801a357defa5cbd65'
            '59e4ac86a991ea009fb218c9120b91421d6cffef0035102941385df3136955d7'
            '92e81ed0a0d697e6b90d3756d59d18675bc1cadb2e4ec31d5d9d07585c0b84ce'
            '8ed1ae30b5864c381abe91e61b4086b05f210f41811219e706918f5b21642190'
            '39b0cc8cf2c19eb21008cb6b069053d23ba223129ad55d2f0582f209617f5d8d'
            '13fb128ad0e2c741e68385afa6238b9b6cf03a34f088164434b1c3fd6cca0427'
            '6d05dec0635cfc11ce4e1e44d9d4a2c371b91c1273aa9ccb64c9f3171717af1d'
            'a48a50124db9fdabd8ebde92b9fbf775b20442c5ca8e46123660ff256586ec26'
            '77e1d57902a8ec746fad7ce863be613342d509a50810e72c15a7a7346e714ec3')
