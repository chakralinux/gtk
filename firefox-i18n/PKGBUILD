pkgname=firefox-i18n
pkgver=39.0
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
)

pkgname=('firefox-i18n')
source=()
_url=https://ftp.mozilla.org/pub/mozilla.org/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('876c07637bf4ac6f2de50e9fa0793a5dfb24b1ca634e89dcfa4c8687f52906eb'
            '5c9abd1f4d1f3f9a2ea6f7d1aa242932b3b60131bf56a7c44b8a87bfae7b9499'
            '8f226086083168053b85d47b61e54199549acc519cede012e513df91d418460d'
            '3b8d8d79118d65380a0fba632def666bbfc98c19f759f2b462d7fc760c38c8f3'
            '21abb952275b596f95a77fb0877d622b7c3eed165263ac31efc410e2f8f86bae'
            '09482c97505810443b7cc8b4c38568e3161a2aa1752cb969eca485c7e2afdcc6'
            'e753af56c8140c81b2c7e29c0340f653bf988deeb5f2601f62e8709f827fa1d8'
            '17f78642312b3beb7f14c1d6dc497a06d62e0066f57986e6b802b06645c0175e'
            'eb750aa9609f78c00b519fff851a482a459c588604277f67d90b580a000552ea'
            '22cf82d3aac5151bbe374413facaf20b52a34fcd390b160d9caa80dd0bb1b43a'
            '7a9ad55e82238c63403d255344bda63f316ff667e9c131dc207f56241d8e0fd2'
            '6f1cd05c5358b3ecf282209148608dfe2f9167cfde548856cd557b77930728f7'
            '18da37119f8199a8ca28d2e3c398c391704011fc2bec26917f0ea5d2802b254a'
            'd075bd666b66df98a89bb5a0403093987753a7c1b7e747a3ff39a97d71d1b713'
            '15c54defb86dd587833cb6be310cd2fe3d6a20774ef8d144f55e956e7d083c12'
            'c8a095313a614801d245b729fde89015ec0e173d352fa850e49e37013c3d38f2'
            '24fca4f5e491d01dece0d9edba64eef68dedc056c9d9167ef0515169b5546706'
            '7c29f3d56eb604e5d392ba940038686a2dd1bb6d2d17e6ff35a0891c1f3aa5bf'
            'ad51da5150ec348b2a3bf673c71709d148fc5850420443d29b0e8e8cd621714e'
            '25d872753e1eba22369d41ed0449f1c47a85cfec504a624944555d0391b1ca36'
            '93e9e92cc87e846aabf52c6be43beb57d70429803e1b4ceecdf617647cb7f353'
            'fb4c53165d3be6c6670b3e94707a01764bb15346b7b1d9bc2691a3ce48b94c3f'
            'af48e577ea996115140992b00ac8a8cb2170c63d0a649302893ee7cff34faec7'
            '6ee8414d98a81cefa577de85c81ae68191b778e0c2d960bee6b38f6a9c6edd65'
            '28c1767c623382c33d9f7160fe8ec7fa675343c88af1171d4ff05814ca8d6c1c'
            '9af8438467c0bd068a581b494e320228a4ee09d316ddde8b708b4dbdaf4f7ddd'
            '3c891624d52d0d4aa9d18ff82709e24a4d5cab18010276d0c4bfa000d03ecf3b'
            '3f1a6cf60c7986f141cf59871e6db5e1f059e9f303e62cb35f7e3c0243ac2c6c'
            '3a7ac11e25706e717a9baabe180fa4f313eda36eb80236ae8ea2a4c739cc9f07'
            'f69a6cd69b177102b77428022d3624d119379ec45f60b06f690e604ee6eb8f49'
            '9642331736e056743554b4b29a8d2f6cf94f24efb61fa81d4dabd9349d9552ad'
            '31b02701545f874141374d8bb42d321c0720fdbcdc47ad1312076e614349e93c'
            'a3d7a5a920fbf152b30aa2907b44b0a72b7fc6d960ab93bb78727f1e44f2776d'
            'f4dcb8c57d5ab9af41415b0b11f6d8ee95ee68ad70b0b0e014cb736050611100'
            '427615fc7a107a406aa8e2bae8cdada3b37786002512d704dadb5bcd7ccf5d36'
            'eafb179bc08841b71b8bd92b1f2ddb4853025ecd7ec53c85463db7951cddabf2'
            'f104e840adf48e2f400348586bd9c9c0926cc655b7c79e1f05020f5c2e975bed'
            '18cfd12d52cc876732f3b7745476df715df7ff9ef844d47b8661adb8f0ee92d4'
            'eaac99023dd74235fac603a7bf3327e7f4a75fd601eeacebc5fd8665f07b0337'
            'fdfd4b25507658f1e6e256d1634dab59ff64d1550034b92eb0239e432b804688'
            '31910736505c789dfbfd5cf8b1836920f8108199f2caa55f2aec75a1a6f560ce'
            '42f796bde1af974e9db09a6262b3359b38838b620886893e4e727880ee7cb310'
            '1a4319f473a90ee43d44d0f9c9e81205b97b648943250a18f93555e68a951bae'
            '39df0d0da88cb37129e94666d5615e007ee3c5383e2436d79079546a51e6b575'
            'bd568a91b3e0f9d4853c73cee5d4a38065571d09b6d4558a12c093f4801147d5'
            '68e7ed7a02194f95c378d1020a6b526bda6ea581af738a17247587349857f644'
            '5cb8780746d40b4dddbae7a1dcef58e6646f14b88670beba6ee2058faa7562a2'
            '4b0ceb4f05fdb7775bb8591380da49d192aa519a1e9663cac92bc2f8dd22c566'
            '847a5feecdb609b6ecea1e5ee85bcd1f39fedaf212faff470526cc4f6b6f2189'
            '6f9b8ec054e4a70c2d4dbcbb0eeda28706061f522a57438b2618aa73fb3236d8'
            'ab3407320f25890653415eb25aa700160baa62e5b2fb50675956b4e78a911c23'
            '1ef3584e715b6a5791d0f250efacdc7f2e3ec257a0d2db1bb728f7e275239407'
            '03c183aa736bda69d3241ec4a50d895054cc542c957d749416d18845bd5833db'
            'a1e5d2df434ac2d952e416cc3a1a4cbe610d56b8503404cdd800a1ca68e865e3'
            '360e0cce124106aa19885f81935453a7fb1d88a4d26617986efede753c143cd3'
            '51320d73bd71200d377314d73d1f476eeff7fce307570ade4cac35c2ba8966e0'
            '88aa412204372f789cd9d10711a980c6a38300fc3b151a04d360c7fdd7bce882'
            '40235f67ff7ce408e2ddb08b13689425269831cc37917226f230576911d0f9a4'
            'c08f8b84e3202b85464d3a388bf606dade428b58ac1b7e032953f0b7068ae82e'
            '51a7adc3f496e6d9d595a0d5d5ef37806ed473283b9fc306f7d65dabe45b0ce2'
            'c795259b45f6e1350fe26f8bd46cb55673bf665c2cf69ce98a54ad25d05a1423'
            '6029134f4c75c05fa09518005255daa0243472c36c18276bfd38d6fe3ac66f0a'
            '7593f0abe2f5194543d4361f21360d7458b0bb2c527e9885a285f1de0f5125f6'
            'bb2d78d5a52c5e314ac56a38ee1591a09266ad9c7ddf424e36c6e19231f176f7'
            '5915e7f530cebddedb101bbf5021848e2d99eca0c9fb2e8ac6ecb3d1819fa38c'
            '2243da17baa6fff2ea17e96428b4215f3253fbf13cf432dcfac43ddfadb53d01'
            'ae84a88a7e9a02724fa61fe37790db5cbe6e6b3d42ef7ed2335778df427a835a'
            'bce3a428bd409fcfa59dccbfdc3859530d44fa9c8d4975e71ee629b02c87e481'
            'a4e0b091f14bd0eaa3049ad596e226430e7436f323f5a7e38b899be55a783e95'
            'f5cc7cb56494ccbdab18257a72e3ad846260ef821c7192fffb9d24930cb2fc03'
            'de3cb38714d0d39543b81173d91fe6b0abf3049ad884135472d191aa7b469683'
            '69d41cdaaf0c0d81e03d89760df8a2c9071aac7c32114d00f8e02d540d3d577d'
            '564f161feb784bb4d23f33fd20f492dbcd68bcb85372553b7a79731c8feee012'
            '74a147051685208e6b76e7b0696f62848848ab1734960041fdea7444062e32dd'
            '5cbfc53873844e9f080c4914fbc3f4d594180fa20617e18ba724a9996660cc94'
            '1aab0b80743af2eb60571340f133a046e09b9314e7a76f32b32a08b37fdea3fe'
            'bccff9cec873b21c0956cc249419bef1f2770f96586992f8e04a9a422321df29'
            '91c0e9d474e9f4abaecca67c36aa746009a347a81c7de91124e04fa9c125c33e'
            '57abff2f4b5adc35a66602bd4e8b397760e88e9e0d5d8c8e544fba6a8b0ece41'
            '5810110f231d3f07dd87c45704f5e8c64015a8970f28c5492cee1970693b03bb'
            'a3728714420657bda67f4b404351e39587314d68c270af4bf5fb3febc36ed1ab'
            '6dd7bcf2193c7f59e8d78b3927193a37fdfbf16be9ccc48f65b617cc42410222'
            '169e8a9ade67f124af22812fe11e2bc8234ae6df3115170fe9f2f9130e1ac2df'
            'ffc87ccaa6c74cd24a3ab2d035af8167d7ec0a24ff0ec8608b1266e4f7e58274'
            'b85a649417abd852eb752a7683d20d97d7745a544133ddfbe620cca6e93b06b4'
            '3f70843026efbd554ec8c6c59c10d7f015195f61ec50b6f2315ba8d0268157e3'
            '609892ce216b7e38ee47169911f8d245597741d27a0cd604c73d2581448ae558')
