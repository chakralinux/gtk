pkgname=firefox-i18n
pkgver=42.0
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
)

pkgname=('firefox-i18n')
source=()
_url=https://download-installer.cdn.mozilla.net/pub/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('c40d53e6984bf4798d651a4197df418b5592ff5c8bc08efbb09854b312453219'
            '89e90850aa16f8f01f7e26b6fbff1bc3ba557f74cc2aacea58a99e86d6866138'
            'f3fa4c376199da6dd8e367bb714c7fe72f5e8ac0f2eb1d7c03c1881f609f2af0'
            '6422b59552c7b72e4f7a4ec7ba417c72da9670182443b98c0f7ca3088606c87d'
            '9f6490f9f9d0edbfddbc150f9b002060738663776f6a456db9da18f95ecff5d4'
            '8feb7bf932fae0a7a1227c4f2e570093f1db066d33f5ee0d2d46265149fad2a9'
            'b0288894b372c85f7e792c2b57925042723d7a5bac9e62e7467e61b45a51ba68'
            '06b83ed7c043e6153b8120f31ed09c04e2ada9389b5aabb8eeeb93c3dd7184e5'
            'b2f6c0521bc51935b54fdafc20a1e142a39b0afa7499acd2b545a21bbe3dcb86'
            '8321cdba1cbe98cabe4e3db23fea74ad72b7ab31ee3b1da50409611686e045cd'
            '1bd0ec2c294f0c1fe135c5197001ca80f3d80e6c8ebf7e14238ff2fc03335699'
            '44798eb3cdcea81aed3604843b5807af58193e125819a3806042c82c9716af38'
            '8a75330590ed0c5caf5828276281e91e3e7f7f58d53d9d5c3c10d70afc323dc3'
            'ea61e0b00c3179c2ac6bc78eb51250b65679407c44a52317c07b30fb9888d328'
            '9540c6e472947361863b635e0176d02c19b90f83a0c0c9ccd8f8f6f6466d68ea'
            '63e70563eb48d5280a5027ecf265726841832d81e03e123edc6dbeb842a953f3'
            'c716b176393a7713f3601672ec988fd0a40dc1215a60f6e37df9f3921ae49372'
            '7e871ee62f40074790c04bef792ef4bc68a2f955ad2022ea8ef24a86b62762d9'
            'a455fe4af209a92057c173012138e7920b766c6a0f786206a8638465c49783f5'
            '15f016244a4c0a0643d111d47a59a63ef2b46e85543951b130f480497734ed42'
            'f75bd7243f85771e85b84019305f20e4a3ab522a20d3064808e8f1ac5f1c8d47'
            '95fb42a46de0ce1867b2aa101d7efbaecde506679bab007c56a890c21e28ee13'
            'c03117c80fccd7016307572b780a085ff6951c3af9dfdba3527937e5c2cfd69e'
            '01a630f4ff0932a68185356873b06cdfac8f9253909bcd6bbbabb71685b2f2c4'
            'd7a9b911c64d7bc64f4ba210432b19cfe7a872ca6e281c2cb3a7eaa2d8f48406'
            '59faf9775b88c2172ae7c67deed9e2e97404e53b92f467987f3dee2de0646990'
            '76440affc4e946a84a2a74d1b1a729a4649bc8aca6bf40e73ff0aeef713c42c5'
            '1b1300af2f1ea530d6fa42a27dfa3f5a221822503231f8da47cb463e768147e8'
            'eb846ac336a7acae7586da7ff7c8f384d28ca0ffd2a624d12702983ae9e85bb1'
            'c30bbd010b3c550c8c29ce34d2037bb5307e92ee0478a47ef7dc8b9beb47a6c3'
            '3a3715dde0568a89fe1030fc8c809084f24745be796e00e2ca810c52281ff75d'
            '5b83272c3e511f60315ab59ffea858bef3bd480d5dc7b96460eeb2cd19d3305f'
            'f28e77dad1a182eb2a47cdf8d95cde554f7d40f1e340ad9cd4989329881f3134'
            'df00863e5ac550c1ef1a4ae4e31c24deaae333e2768743eeb47bc3cb125a3feb'
            '8854f1b11ca09102b58fd09760bb556c689bbf39e73894b8c06654cb7635ccae'
            'f7bdf7fb196d98b0ca41a93ce55f47da2344bd3fec82ed377c7c5a8c163e0082'
            'b9509ccd7a8b65a0cf6af109574bb1cc8a5c57a6d1ab6e767693bb7e6743ba29'
            '541150b08e4622bd4c1ce22c44a99f2f9139f6e522cb3e70a70684ebe4fdaecb'
            'af74807a2cfc344fee5ae66d958dcbe1f2c0306484ea982329efa4e1b3efc530'
            'c32ea352e76837d921012d216c6c0c92d3227c32946e87a8ca0561ac8cc9c51e'
            'c82441a31b091269f3b931156b77727fbb157382d64840994e5b564d067cfb3a'
            '00ea18c130d4e285f040dcb7e734a075f41a2d2d9638c3a68a398cc70eb89ed9'
            '74c306451dba3110e5d22ae34460a36dcd26625ffd260312b46361797d46f669'
            '3f8c309342d88018ba18df16f7d49ddf160a4f4c66bab3314115e63f99a1373f'
            '5c0f8f25c3dbde3584a585df984627ff76e97ad2e409e644ab173a5625cfd9b2'
            '99d220bf091c89078c8db62cc3ed34ec5ce3040badf1fcdf95b8595fdfb34975'
            'e58fc19dea604505b4daa5840d99b03f20b33a31ceb8d819e66a359687c484d0'
            '6be10f66d9370d321fbb5e647f0acdd809a77bf2299607b2df926917a9da6241'
            '12acd9f06e5f6207c9b044dc401d1d3248621873f3e8c4fcf4d4fe64203b62f4'
            'b39062407a3fc623f3c8de2a1458035544bd3789482c6f78cad9768a180eb6ee'
            'f656deb50991a4d2e2f451939f9832e5e6d0fca73f29ab73c2807469a8ad1ef1'
            'b6120f0a184c31d5b02a18f36670649ca9b97ae50fa0c2b947dc5de021ce8002'
            '5c1ca7360e81112a7e9310c4645ff517b57c171aebbe14bb03b2d2a5e3c47d49'
            'cf1b1a23632b54210bbb54f570cd65606b718da9a130a0e73ba1f9b4228ea77a'
            '74d40e7e488a9ea33250bf81ff2ab55f28d6144b5d74eeb622b1b6556422e330'
            '150dec62af469671711497129feb3e3a77d1171aae5bb63127daa77c4e7650ca'
            '1813c34690dc3683df7e11fa0cab0a8d7d1e86def87eca87a037702e94e9d531'
            'bb3dd5e5d75bfedbf9818db10dc495b78ca541b3272b406bbd972d53db387b69'
            'd5f35f20b4c6815c35d58c24fff70f9689501b4532acf395a2906f1d933ad5e8'
            '57490457a7b684ee003625426ca5ba1872a2c536353cf07aff23c139725f09eb'
            'abcda4ec1bc6512479aa2ce778e35f782ffab8f799f96e591770420b818c3350'
            '6e7c85bb6400118eecdd9d166996ba83a7d351cffed301112004c4bb41356cbc'
            'f5845dd3533d04b4da1c83efb60e88e4a2c89c5d3368fdb444b345b32227d83f'
            'bb80c32b042430a3fc1e63b22f6522367a2efdb9126566c2d6f4cbd1b61bba7a'
            '996562bef6f29aebde7896186b7abe5d6ae576ee7a8880cff5a6ba5a679404a8'
            '2a6870be339cb8b086d2481fc79481fce0450af653f499853e51c72634187683'
            'a184858157ce13a707961ca8f3f00b0353592ae8600018b0f3e6517ac2fa2961'
            'dd8fd57d098ab07f7be688bfb058f18d22fe4a2792dd5732bc1bb0f365597bd3'
            '3029fa68343ea9348bc529308b9547b9d2519a652e1cca8db3843306f2b955f7'
            'e2f4d9d864e096ee6828a137fbe34e6c4c262c54197e750718f4d101b3417a48'
            '151b1e66e92825186edc6b39e5dfd47de13e4d4a8b8b4e32fcabccabc323c68e'
            '531f130bd011aa91e6bf321d038ff875e34f3aa0f8b16fdb040a61cd09374dc0'
            '5294834f92881746739683a53fe865eea858eebb080275cf5252dc57b868f4bd'
            '44e0fb2d0ada860530e46eda7080422d679d3790bfe70b5b6ba7cb078ff10cf9'
            'dd6bad8c6afd0db567f1a4a832721105f4d0cfdf3e3c1a232c90289079ddcb9f'
            '5d8209bc781fdbc59c6453eb0b05b66a555063c5bbffe22213b3d8f20075ceb4'
            'c59471137ca927f58ed87d174ad35ae4d5e4f8a7114abe256a1b269490f8a41a'
            '6deef24878b85fd53edcdc0b008d0c39a20c4e2d33915da2af265a4d9b1b1f28'
            'ee9b102c643d51297681d2a857de71229fabf1df6585e9b2c62e189d2ece2f6a'
            '98108e6adb86ad9a23e1cca75228e4f2507b755560d2b6837c521ba8f9e13766'
            '661760c3a3d0d350725bf3f0d26f5c23e0628442c6b7a60bb678ff1c8de9db20'
            'b7a6d4ff25ea7dd430f367f5d79ee03eb3cce403a261ca4f2cada2bf33dfab1d'
            'ef4fa121e73c6b667388749bad3eadef3920b1658deb2d5a40ab8a9088161c89'
            '5b1bc30fb698ef0a84d274320fa067f3e33ad0381f5c16165e509040c9fd715d'
            '96bc40fba9349a4b1772fcf7e341015283a54cbbacf166a9c826dfb0d73b5ebb'
            'c71c25ba25fbdfe7c44b39041b44c07780aa11381d290233585992eefce0052b'
            '8c974b4ace5c9659f2792fbd6d155c43f4fb78642ab6e8413eef01e9b7e9e2c5')

