pkgname=firefox-i18n
pkgver=44.0.1
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
)

pkgname=('firefox-i18n')
source=()
_url=https://download-installer.cdn.mozilla.net/pub/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('46b98ca77adae0e5708fac58c779b4c03c21c1fcee54756951739c3a5bea9b63'
            '33fd21155128dc879671ea72647b2b07fa1b58987ef2c91be5db60e4f74bca06'
            '76a8fb2bcfc5ab95a81d696dd2b0643bd77fc4a19fb60823f3194a69bed88760'
            '03fa9896c836ce08e2c9bbe8d408a22544a2cc27bc7c00ddd0ef725d84ab26b7'
            'b1750d131826804525b10951b17085a51e8e27af9e517c14288b50eb40fd123b'
            '73ba015d1d5f9ac082392058e84c7e649186a3c76d8f520bccd0b462faf2c5a9'
            'f3c23a41a997b569e644c418d57b556bd98d8095dac7e223ff81d2f4bfdda487'
            '7b83d31369d5423d45fb4f1ff3e687086a01cb80808458c04babfc59608ecd50'
            'b3b1298e49cc7a58b083dd98d9eaa5331266804cac2bfd0e11255f3d2f757e94'
            '0c6811ee4350271a83bf8c1e26f4924d750c4b80a4decf0561f4be8d5761c774'
            '38032632d30db7aba2f435766a9be68c6bb00d904a7bde6f953966cd7f3fa5b0'
            '8927219b14de8f835b978ae541e5f0ba879b94f106f24e93eded46e91dd3d1f4'
            'fad1e4d7c63bcd25a29d1a279b67d4df12212dca32e2e9de47ef666af4007e12'
            '0c7b28a7fce4a62c99060a07b6016996c9583309508ea29c6d789b7d3da48cdc'
            '5ab7a572812da86019fd3362ff61be535e1c0f123ea830b7d58aa57a05063f59'
            'ad7351151ae3a5616cb40daa12d211745bb2975a3d9123b46c930428ca6deee3'
            'c579f4c7df7f7c864676ec1db14996c8d5985861a405d82b5bc5c80a12ce2b76'
            'cffa9c27ff7a7be06345c9b28f2f9ff4895c70f0bfcc70561a5c18841712ddda'
            '5bc972d17875f9da29c5097e82bd62401ac5e8cee0c759ec9961129feeebf79e'
            'c8ecd1d7365295dd353e1fe20068f6d14b82fad68cd1f74eda1bd0a32cb611c2'
            '1560897417dfa8e60e8a90b13b0e75c7d050e01aaa3b64655c443b9cc1b12955'
            '2415009a5078ae050c54e5db2beb2b49bcc70f5e14c978214f8454baee6d1c8b'
            'b364aacc84ed9b18c7ecf55bbaf443614c3afe45906719703c42337612c730f0'
            'deceb32fed99bda36dd54753bd8865c663b712c8f8c7f61d6c37aaee1ecfe9e9'
            'f8b6913f39825cced779cd7f3398e70722b9f89a93c70f1aeff232b81fa5a89d'
            '35de79d330612f82a66f361c85283af9e30572743204747f56d89886f800ec7a'
            '97fda98a38d5b31b1af3cfc5063dac65ec2db38038bb4bee970da2a11549081b'
            '011fb49de5afbc529745c05b7bafb1d89a7d8b8dd742b13d90ed3afff45a3c2c'
            '064ff163f20e3a27c28dfe551f22efb9f73478c20ad65de7dcd04c7f28cd367c'
            '2ddef626f4b549c02f5bfffa64f4b3ea1b6518a9d6f7d94ed7520c9be8b06328'
            '181358de74529707470ba9366323e94d7de37a9f90259a2432bed84dde988819'
            'd6d67db6182383cea64efbb06ce0306bc4c5dff8eaa63ded11f2d915f7f22e99'
            '7fa039c1eec180c6549cbd440cbeebb7dc7e36ec8c0af58cf5b28519dc8e9d9d'
            '58fd2c4ab3e243da5a7742d30c555a22baa28b75d74a91daf17ff274e28cd513'
            '6670cc2ae6549412054599dcb867e337212137fb6dd9e56faed1ff2bd1ecf10b'
            '4015256b4e5b8b33a8e6c791081d81c9682c42575341678a5ee2675954f12487'
            '7ceaecfb220e8272480d37d866b89f464a9f8ca9f0ff2a90b3506fe7e507f6f8'
            'aa734fc87f3979f2c59f46374fe4e93f1c3e1fb30ba4930e9f4c1c27e153584f'
            '258b1b7776e2f23d7397a2002556daa5fc175bb4ad2cc7dfe0105a6b9b4d0feb'
            '5172469c038e31dd2de51e4e047c2f0f74651f5cb1ca4aecb49f40d77dd6b67a'
            'c8b061baf6df5ebc127e99af13ad29e15d1e4e5e99148d233aa99bf3419d221a'
            '12b6d0e12a73d6a24ff7a6b72c895bab5a0a7ae3deb84a0fbde9975930af0ded'
            '900739ba8aedf1a7d6c97496ca3071da48d2e83e7f3ab609cd29080784944596'
            '28eb92282cf982f0e5343e027f90edc836447025f08ac3334dbd4d5740fb80c0'
            'b33e9f0fc8c3187ec844ec31454be9655831a842d96055a2270b4c4d7fef8992'
            '65ca0fb81011f0f2f55d59a2a926fa02f48fccdbbb94d5c4193ccc9a10227358'
            '7450a7841ea601b41890be6115d4ff33170a1435ee4f11009ecdd581202e92eb'
            'b786a360eb430829f0e7dcb85bd7baa177633d6dd1333f63a91eb0a16fb41703'
            'a41a70a85d0afb09a5cd3604a67eb28acc060d36e25028dd9bf3656bc0022598'
            '69b7357c881d638ae0bae0535da21c9fdc0b6ba48ed9696c22d860fe4e9c09ac'
            '91d71b73bf827f607815f73c9aa0db939e4e786d901606ab090b25ea9de7865e'
            '5f18d124ef5d7a12cdc5d68d8ae2fd2a927a024998d28ff4d2ff760a2fefc975'
            'bb94a1d7c10a45df49f0a5cecff89103a7669aba10dfcbec3403b65cce5d34b9'
            '4aefd274f4d0c33af5bc6ac0e115c4cf368aa924c6b7dd1e6daf2d630c3949da'
            'b3a8062fbeaa4cd1a96211e7ddb02316c957d4f9d9331c370d839214d305cfa6'
            '0ef35555f9a2eb6392a3a71d5d8f4d676bf4c6b4d1ef420b69bd0791ce13f9fa'
            'eec3177e93af79576c30a847b2d0292e81c2a774f6fb979a2ee4671cf1313d53'
            'f5cd2ea64af67ab7f4d0deb7af31614c814b909918af92d22ea0ada52fb2f9aa'
            '0055cd5f27e4d7643d70f7355d310def73cab216ef6d9aca2af6d9cc15d6fc94'
            'f5313c9ae473212f7e7f0d4b5f40a5c3bbf000210289d42d308c5a4b8cf00064'
            '41589b85ed22685ac3bfe230a8865a9cf2c1fe7827882af9bdf92d1c6e36a476'
            '4b36c10008c97c985d9bfb46709b6718d07579d26f7ae6166ea4cb763779854f'
            '79cf5587b61333bd9b455104dfdddb10ecdc5a5d3762f14f6fded4a503f40776'
            'a331205d159910591bb74a04b57704c95f0a5d1b86034fb12f4e1b62ffdd8a18'
            'ee2fde796d20f56404df4026ca83bbfe2b2ecfb4d2fa5f281a40162c39533418'
            'a00286b608b81003ccdb7b2ea7fc2b4a243005d1eac32fa821cf4e98c204251f'
            '1ad2bb75b9e186299b3699aae833817b414ccfc612023871ff34169711f82136'
            '671df3c7b6b7c67559f7892b6c8e7265663b649cc0216d5f16ca4b6cc5984d13'
            'ad5335837486acb6cd343eeefd8969d06e52b2f7547274a0d393694abf4783da'
            '27ec518f3df927710209332c0f05afc80ae5c5620c290f9c661bd21945ba57aa'
            '0acb3d271ffb88f300355e7f7da01c499c58d1b5f7406d7b801d6950d9224c51'
            '5e6e0e92ca30ef2727560bbb7287f6d4244bd9ce5a7e82d99656e853f321f38f'
            '2b32c19dc3326d8d6f1defb50f204554bbcacadb56d8db3f27e9106a2c8b8aac'
            'b0bb5d6ab5eb644ddcd32fb716cd5d33ad2db6c6252464dd8808b41ee9000f52'
            'ef97b82337f492c45373831d71c33bdcf2f72fe59a09e26ad5e6e58c5b9201c2'
            '0b566e72247b5ef0de15edfbe9657cc35d9234a013858035dc3f0e4b4005b895'
            '44e56b7babffca823df35c46a1c4dd9f79ee2836d3c1fa53c3ada3c6a09bed98'
            '9f992fc43107ce83423520cca0ec6df48a91a469e858223ed8c0c97394909980'
            '1268128c0838dcc1b9d3faf1616e216c21565e542f31887181bd26cca4ca77dd'
            '875a96012a0aa08945c4ef7603e90bf75773fbb7a7a115df4b884419e8e0bc78'
            '894934554881796d65cd1c306c6392837a2945c98bfbc07989a5dc3785a14501'
            '8ea30847ca1463938ea061d857bee97318e5e8af2dc9e5b0b5946d72ba324c82'
            '1956707bb2becc0d4ba7fd11adebd6ffa08822d92d07fee53e49bd70ff6b6d5c'
            '401ff3cc89ef8625b772832611fd9284fcd74386569bcc54692cc4d78c012f59'
            'e20251e4d3e4a8d2835c2f975aa2907bcd7a81539e1f3dd2abe63583cfae6f28'
            'cdda71d61982f23b4ad66cda904476597ddcb72c69c5a83db8569d72cf8de542'
            '833c7676873b60af915c64306563eacd958a7ee67f50c3457cbd27057bcb5b45')
