pkgname=firefox-i18n
pkgver=38.0.1
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
)

pkgname=('firefox-i18n')
source=()
_url=https://ftp.mozilla.org/pub/mozilla.org/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}
sha256sums=('b05dbb1a57b4cd509650358f383fc942a0dbd155b4e33ce9df195e139e6f1bdd'
            'e71c6d4de0a02dd612169aee097e51ffe0effcec24d3675ee62e2ab568a6ae57'
            'edf7e0f8f4c8f56e5fc85cf94dfb19a6a9b606d93e270e1fb5af151eea1f88dc'
            'a3d1c6e67fa0be52c3e1e7be9ec50d0fae7138160fae08634e6705f016d8a64e'
            '093fb5d5609c64c02effc78106a8cebac0685d33d4fce7b250f5832f0dc6795e'
            'b1ee5c76124396759684d2980f2b032e194749bfbdc08206645ae82450a8bdd9'
            'bf09c4187f33278ae32d53d75d00f9455fdb5392c29bd82f3c9c411784439880'
            '83db450dcaa9dd222c50e7bc6cd12e5dbf6f472f134b128118331353f0e16908'
            '90254e4148f294962b7e4c43f5b67e2c60b1ee17409bd116a7652e5ba291ee5a'
            '332e493af5d8a723513d96a5a335afdd90bc9e082b97e3fc0c6c84265b91125b'
            '8624f3c68e3d18e52e8171eb94a6274f8733c80e10cd868236602795018c11f8'
            '5dc3630767094a7f10eddec62ab60cc571363eef8bae650c1ee7115d179355ef'
            '6d0d5c666a8814fcc4a31c200ad9b7db96b30f1fb69dd6f603994fee3293ddfc'
            'da8d1e93bef99a2dba20a8df331c6fcc78ab462502513cedcd06a5f80ea93f1d'
            '31dbab500a05646d076619e4fd7e22051dd5632febf3cc8440e32200e1b5995f'
            '86677ab9761ea564874a5f1a1d0754921da9f47c63fd770d55bcca5aa6f160ea'
            '0fbb54d063e56da0c74909aafc5af977ea0a19ca0e3ff744b183a588ca4c33c9'
            '4c6af826585bb404ac05ea47f4796a4996ae51a9a1dfbc1803163f3e1124874c'
            '8fe2338594d3fb22eaebc2841dc5a87c51a18fed1185d77d840b45c5fe42fa8d'
            'ac6dd5aa95032aaa1f7c5481e4ef5fcdddd2d2333b66d7892b8dc07f7c5c1f4f'
            'ae3bf5f755cb373f692f14c55ffccfbad1dcc08e530490ae8bb7a3e189e81272'
            'b91d563d4cacfb30f54f828fdb5adb38984a3e95cc9cfa217563ef66794f90df'
            'b6f8e8a0887931353b10bd835285e7f51f7a4739c9c32d394ebfff97cffb5a5b'
            'e9064b31c8314ee3c40b12ef553546402dcdaecafc97eaa3aae5cc7e61bee17a'
            'b8dbf039b98e7eb4d3e2d775dfb856031766b387a6f6cf71b3f7871a70dcb262'
            '8e08eaf373c567b0db559fbbcd2ffb6c2a7a296685609e07bb5df5ceba7687c7'
            'c3b0af3f4568fb66d15d36533133ed0bdefd6918b0e381ab0459bed8e4b8dc47'
            'f5502814b4bdd1d5acabc3beccc7290988ededae03428647151b01ab320fa085'
            'd4d6e9fad25bdeaa09d376dfb1ccb858c6a8cd8d140cc742c00b94fc03f05d92'
            'fb4225dcfb11d677827c67efccccf21620c3bda19b003c71ae2d09bb4136ffe8'
            'da7f1fc68f8957404e1cc408ee6110ffd164f60c749f3385767e7d61a2d93530'
            'e8707702028d4e85debe0816664baab1ef71ba05d7176ea70ba3b85f51709b3e'
            '7cca3f73109df2cdcd3738fe30816023657734ec707740523f3a0479f78ebf60'
            'e37ab82d81626b8a1610ae62d3e622488e885df9b30c76696733e6d0d74285bf'
            '43914a345710b76a4073f831a26e6aa5ce718e820a4839e4ce2a29abe51a8691'
            'a3b84fcaf1302cf4265f8f2c3b2e5c69740d3257a84fb135fc5616984c5646d8'
            '11d2ce8be5651b48358f69edd5988a66518cc3e53ca84428755612c4d94f1b16'
            '917aeb38b06bf37e792605891faf39bbcf5f94a5b64b2a5744fb04f4278d4894'
            'd4237c1bd8987967c464da6c2775fa9036205a8a23dffecce94d12f7720e2cd3'
            '6c93abcf3ee8f8490f12106cec85e0b20ca0a1a93d63c6355784065023f5f1e4'
            'ea60143ea027e42415be12ed7afa86d1c80be2beae20a5d00f4424b781000845'
            '3cdb566164a70035fb414fbd7dbb34a5af9356548dcd61165eca91e91abd3693'
            '08593f5ca94255f1cc43acdc50e29c25757fe4baa884e41eebf970dc10e3e4c8'
            '355c4cd6681e01a757373c54beb4c6ebbf405c0c6b2cd16c909250d173ef64db'
            '521b4419d41dc1bb3fda8c17c80c086b205b4e42521c6937cd6062698dfcafe1'
            '52582db59b6d358f187bd5acaaf976d59736b5b0b0cd73cf96a96587cdb35de3'
            'c81c3731287229f63c900a14608c1d84b4139a45a98bd6cce127383211f87ee3'
            'f60e74536db7148b14341cce4d05b8549248d415a976dcc76a4409942f2d4574'
            'cc0e3c4759cad74b4587864590d873c9d9eac1e948391b3aa6cb75bc0916fabf'
            '2d3751d1c87bc3b34c77e07efd72d88a8212a082ae4a0a6d71c8e9d1b01303ea'
            'd367e4948a6a365d4305f742e501f4de7725765af8effcff95dc8b46b52836a6'
            '74b3b25baf761b58ff105817b4c8af133d6d9ca833b4701e944fd1bb33e83d15'
            'bf72ad5e462f0a3b46725e402a98d44ebf45169bb053ba77831dfdd599fad9d7'
            '69307ee0bc9e4469d49561180cbf5919e387802d33a9328b9d7313445b133b0e'
            '527e92468c2275a36de31d7497a0a1c52b1e55e9abf6f883d1f2042b98378d96'
            '36e272562d5bf2348ee310d050db6900c552e51b22641e2e60ff679feaceffea'
            '5a88492d3a920a404b0b9040a2da7eb566cfe4a91c304dd1aa04bfac04650567'
            'b086aea1bd52b7662b4d84950eb5b4fa5a7a86723d392cbda001fee820481867'
            '95c912dbd90d48fa5766a90a5b1adda36d6ef7a371ba69f46eb88336951ee834'
            '1b18d61b0009b7d531bb6522747b9868cb707b74a13e2385ee8c7359d635547e'
            '073163d2bd13d9c23c0d0f53071ca4dcc087f1edebf14a754e1abbe6d7de20d5'
            '06aaaa123a2c92069cb03d534dc86fff4b5372a56b692a7363b44de7f91da4a3'
            '2f7e9b78984c33a03e258deca14d219d0eda2e56218611f58ca129f507600401'
            'd9038d501743b08aabe977919cf241b768186c9703bf26733462d7dbeb6bba42'
            '7839b13a341b02f33fa00c95d77e0f4fe8cebb5eed5da59199f03b2918ff49fc'
            '9ba64004d02aef00a37400212072fe2f5740b2246a9cae291967eceeb5964bbd'
            '2800876b56e31a92bc6e3386f6d3b3a9b0960c08c09c0b1e59cdbee5d9a526e2'
            '9dc4bbe1e60e38f47879a888236fd0a78a2f3088054ecc0333475e2d9a04db14'
            '741fd62b80b49cb3dcd43ce654362357c4cc4437745164ac6e40507a8373ad28'
            '266602ef24b4bcff0fa2f4893fcec8a979517c1144010225cb054ba4822a4c47'
            'baba7a8de4613d453504d95baddf77f1bc34cc37783b78b1a52a37a6d8260dcb'
            '96b73eca1179d576d686ee08a7ff86cf8d235b20da158703816d7d27f1937c43'
            '1a3ec0fb63f1f6a994529788bfea0603a7b610118fdb0515f2dd6e7ade32cec0'
            '7aec865f30e173eb3f80659d65fcfc618ef8974ad51b6c8ec2a21efaf48adffd'
            '3e23b1d2688e916acc97320c180e42a90a59177920a30baae219f03ac540f1ad'
            'ec207b84574ebe64bc982abd3b66dd0df600684cb65918a857beedd85eeeb1c6'
            '09378c502e25420d6ec7918eb026bd8a44d8d44e8828486a524d7b72445d2a20'
            '9665a4bd387638722e56032d7aed23e6003cf3cf55c50befe5818ce6547309f0'
            '10ab0804ad40e99781440eed1d5befbeae1f3153a9fecfe8f3e35aa1a05e1c09'
            '2539e713be601ff255aaa34d063cc5acbc482fed8d4a8c8bc9116bddeea9c2d2'
            'cd0998af7ade25205f2d41e30860a861692eaf44a2959212f94c5d7c98ebb5fa'
            '8d3538ec19bc37b056b5cc0574bee51ee93869c096a48bf6f82f89e6ea2efd8b'
            'b4f5844322cc28372e98b0e19665310021b4a9df19e7b68c2096999ed3121675'
            'f0d3f22372b14b594bd964a15bbe0d9fb1160eba66c53b4429d43a42086a979a'
            '76f8381d1b3a8432f64d0a3e92d33de784d4257f0dfb40d2c49201a7ed927a47'
            '8f32731d35949a85a66a29692cbeb5be11a8c3591a2d0e4ffe4bba3afef31f99'
            '26b6a74e0a9096b8bbca9fc60c380ff1b11b93d1287c5a18f3c8b9a582e89bca')

