pkgname=firefox-i18n
pkgver=33.0.3
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('any')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'csb    "Kashubian"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'ku     "Kurdish"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokm√•l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
  'zu     "isiZulu"'
)

pkgname=('firefox-i18n')
source=()
_url=ftp://ftp.mozilla.org/pub/mozilla.org/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br csb; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}
sha256sums=('04ccd07d51ae20f6cbb19b11570e5b6d012ecd3ecb196e67923680de436ab206'
            '7053039017d9fff9270593c683feb1ef19b89fa119446742b7f8e1ef72bcf46e'
            '22450ce8390aa5e1448227a48a70602bc5fdeb16d43e6cbf584164673da446f4'
            'd89a82c05ba0d6e1194e944f5385cf65583d663cbf7cab92dd141c9ff9e0d759'
            '059d90f21a93959444bf5bb65f62fe7a4a715e4c895289b1c79e6957bf7c0f9f'
            '5e96e7b4249d105d5aa35f89e816d1baa313557cb6988e388841965d112c0b1b'
            'e7329dea083ee7b9e73d277b2b1d5143277d6e7d32d5dbc57e5c33a43ee166f2'
            '3e8d1cee144d16e691c4e359b3a2c0e3362f749ea51ab537624d282d8d975822'
            '275bf1970468eaf75e9bdbcfd44f1c9297a5a611a638960e31e84a0758e55c03'
            'c82a661c8b9056b34d4ab915994101403b533063b0e38c6c760f355a6f26f721'
            'baa58624e7d7fc6963e78b1da60464c7355b242f2aa56889eeaabeb07afd6e7b'
            '540bf27bcc3c6c03a470fafa949a2c44ff4276cf3f424b7609506e708de74439'
            'df919de7f0572c89c22528b69169e9874b1ac78fad02e8d2cf9347ad53ee9481'
            '38428b182a4996553005d3d5f3210177968006144d2bd3f05378be7ea7b989f2'
            'f45c65d35d62a77ffc082d22d4ed88d4e9da8939df089f00935fed525fb240ed'
            '7342457010856f576df15ba39554c109bdb886a0363f826d056f661c3cab4074'
            '9b841e7e0c3b593bbaf755ff1e17815f27f81aeb91eea56a4327659bf9c9583b'
            '8b2a6754015f9a755ef5fe226c7fbdfeb6b956b7bc9b58c6225e0ee82a5117cb'
            'c94bc726d7970202dfb0c8345821778c769dd44e6d26613a711208cf0e498111'
            'd764b0fa496080ad9270c6ee92638da8675d7f311607e8feae0310b17e88143c'
            '6c1e8e588d3a2fb1ff6faafedb4736cf16698881fa856bced91912ba9c1be565'
            'f2731265dd90352ba9be6e2aaa9044c3ad77f004b8cf4e5a5f3dae3c8ea06379'
            'b3463d47c20e017897d535a0a1a623aa142727f78cfd9686b792ad5b6d7fb7e6'
            '4650fd92e4afc5732c0c0e1e81b08f788e601e9000829628670ed83d367b62a6'
            '96d7323190c3212df6fca8af635d329166dbc03ce1ac12a40d58b288edfc99fa'
            'ce295a65daef7b93f753e5758a9f9fb589eee239d97672d70167c1c6d1a34566'
            'c89ad6a9f5d1087370b0ec27c7d3e324fb3f0c03bbc22ea360f4e74c273a2383'
            '25ac9f739792bedfc7d38bdcd9776f4c9822cfd3e351691be5e80c1e85fe664c'
            '5eae5bde2ed83e2895b7cc1b6b596c01d6b6730f114ef6a6d95353dc37b48734'
            'e2847b7f8ded043554ae9dc3e3dc772973ea19e85dc3679ecd7aab41c40ca2d5'
            '8becadc735276d7d10226a7c6676494e871c1ad266a3ac8c9c2a235d9b1986ef'
            '9d3f855640f82fe43eb17698e346d32f1b2bbdba43c2b2c2cf1f4ff6113222ff'
            '81c58197d8db962de118b2d49a364f30d8cf7c48048f1454c1904cad46cfc68b'
            '1b8bcf6e652c0d94d697e5c423e41bdd4d986c4dfb8f5e5d10f09e8edea33128'
            '56958de89913fe9fac9d0d613c87ef2b9748a50e28e5dc873421f3039a89b568'
            'bfe5d5e919debcbf64b5e34456941637b61b2f03b82dec8937458ece20c642bd'
            'bce32b417c8d3e2f48d7e10a7892b5f0980ff8293c3fff139af7d7b09381772c'
            '7ab288a46fe0e36150e5ad7bf21f5727001ea20a756320284feb0aee38d507e3'
            '873ba01d59341659ab70993455ae7c8383ffebdd8d64a45896e5842573c7a9e6'
            'b88d7b3f28657d8c574a1f6b0d76b7e9e65d90940bf24e077ba2d737d9ad1ea3'
            '08799011836926336c94126bd3b7162b9c917ffae9ab5b88db8c97b816cee977'
            'f8a95726131ee2a59a6a9ed5242a573c6f3cc7eb5c189a8e3972ea298734a65c'
            '5c0a2ee921b00d401c311b7536180084b703f4a38052efe3b1abd2949d39e3a4'
            '6b3b9fb674d9a02237d3e30400e6781d57402579bb4728515f3335050f06d7b1'
            'fa011b518475903fd7838b74bc5254066c4da804bb39345b661d4ba90b6084f2'
            '993a6a1c7e6961ce145bb886947a88f11c9597658ea2e4baf1e2d75f6ee7277e'
            '3c62b5c53b8ae065da7b7066c370e25b88b7c020f169ee404733890e57b0dc37'
            'ae2ace189b858b4d15a91e29eeab37be203571394bd2021838930f32ec63756d'
            'd9e01bbecf1b26f56ddb7442fc973479855d445f1b9561f31720ee16d68c2c99'
            '062cf56a36253dbc9521c785ff277ec37cea475058374fb266384b75a994ba2d'
            '262bef08dffd27ddb59d9e45941216038b4c472bd37bd4a46ffb229367bdee3c'
            '4730eed501bf39ae50a50f37a429856e16fc1ddbbcdf4b6f4b6a59a889d0ba26'
            'fb52474d50a52e2e69b69eeda89dff0f0448fd8053ddb6ff99e61fb28a5cb0ef'
            '492b15bc01a70bcaa48a4356872fd2999ab6883fe8994542d29e6b0ac82b83f7'
            'b8a744513bc2e5158683c709c543d4882ae3cb9a2f27ce1738a8c314bfbaad94'
            '6f5c4104e379510f57f74fa0db363e2c7c1132cfb399064a665e1a44e092649c'
            '38dc1a97b714a2931ba7e6a361e533323fb56e8877bf3392a5c5968b09d9a61f'
            'a7e3f55e24ecae7e239b9d26a16b98c13a3e8d5bc06028146b26e303094287ac'
            '7ed4f471e19d964c1e85c6c9bf01b372f78ada409089fb01d4d36f314534f8c3'
            'b1ab7d19d7c46438b2b39d9996e445248640c55ee2be7acc498b93a5f89095f8'
            'd559a7cf5a616f9363f5c42ea63c2a38639b912343ab08e0389c38819777fb09'
            '58278d958ebfcc692c3d53be3f66922ae5e024dcd99e0a92cdb378c3b8e03b29'
            'd31502195c5149bf357361a651b136184bef47d17e78dead6a60d3f4a0b00004'
            '480685402e011aaf804cdda35ff5a8e916e205826db8e541c4d455ae6b74a6e5'
            '138941f6fc2d7d38bf5df0a7323e91ce1c11e1b181297e549b429d90516e2e90'
            '9aaa6bd72b52e6a3a8612e8f4d09c6f9e67c7aa617a0bd1c7f64dd464d91ab34'
            'f70c445e05de76c7e8da36c622524e44798d1d597ef55d1233faf3d21bd2212f'
            '47c5e6bda92c6e2aeb1dec2e25514f50096d4fb0d5af3854254b02db45a4bb9e'
            '76c552a089dc81903f0741ef82a61a81c1a721bc2a4170aa8942c5c97a6d5c22'
            'e78ed4911c946fcc800843ab0e18a00b62fc9c9a697d88e1b911b7138153b403'
            '6056fe4d714e198892fc28de715b6fd8ac152f95ebe478feda5c4fbefc20e0ea'
            '5c00b88ef35eff24df069741a8b223be26c734cc57f3fb43f9755f54e7a05c2e'
            'c76e61dbf82b57ab3831520b5a4b496a871923824ef8bf695ed2106921afade7'
            '3f321d2add535bf600f3ec18a1f739452d42f455f91dc0876d2a4385145eea5d'
            '85870ef12b641e4f4a51c5bedc52147cd128ea217dccc3ef5d3122d093679a63'
            'cfdec965a885ca92dae93ba8da6943ebbfdda3a557424174ae4cf6b251f698af'
            '677a540395b75bc0cc18a3feb5b27a10c26c5c9746cc20be76c21118561a1f92'
            'd01987cd190823ddbe942f5ce909fce6a3dfff55d458a3d8e1e4f4f157921def'
            '0f34231aba9a5cf6473ad58c874fa54b5f9666f3eda16c8d6604d0d89fc6fb40'
            '68693ceb06e90cb367bf4aadf4b7bbdd1248d245d44f54faa13d8e333b3ec9e0'
            '49a4ccd6f80f9bd6220281b16cc1db0468f88b3b5d5df36b930c273a6517223a'
            '540bb74a6136726b1d1cf26a7ec789d4f09c4c35e1de60b45031b106e64ed7fd'
            'ae7d8ec89251cb7f01212aad1299424913f312425d118d9b7e162b72fa88940d'
            '73e06c4146cf99422382411be8bf2795d6f1c915fc539f5954971cc81f818a93'
            '60dc96e4d433c12c641f5ea9a6d2dbc37568c79621ec79b569899a538238654f'
            '731c422af8ddbf227192a92de750421e244a97016a4d24c291e02b302410b66c'
            'dc3f1165ba670835a81f3963e8be54514c587575546aaae9226777ae3b6a2202'
            '5261685f79f8817a08ccd66615d740a1f205acfc900ad034707c8a5fb78f2732'
            '4ac0096cbf997530d2bea73d56d7d8ac8cca797b3fc4b8d4e61cc349b97dd724'
            'ea6a142e5446edce534975e4a6dffc7617606687f73eea666e74b2d70d59ecdb')
