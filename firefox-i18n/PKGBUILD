pkgname=firefox-i18n
pkgver=44.0.2
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
)

pkgname=('firefox-i18n')
source=()
_url=https://download-installer.cdn.mozilla.net/pub/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('44436f201917e5a5a7302af368ef6c9f13056f9f9c110bd20771d20d2565ce74'
            'bb0371d9281c52dfc7df531f1244fb4bd5a3d00a44206f9dae75acc5afd65d02'
            '9aee626c7c42648212829f2e0995676f992cdd890a014c6e3c6e226dffdb0a25'
            '50f7024e099890903c89f60d318d6b72caefa1b112feaa4832236fc79d902bd9'
            '20bb0d7c73d3037776352888e5cfc5d29aa8afaeb36352a16b1ab68c2ce504d3'
            '44db36daacf5485f1ebf264b0f02412b5c06840012140a566301c7d3054801d5'
            '3d7af7f65796a746d519d754dc2c832c25cfd58328d391df26495fa62ba37bf9'
            '21c129bfa3b78c3ee17a352a46e5c873bccba0ed6eb6e316538e5b819de60fb4'
            '8935d30e8dd1420ac20888e601695e3231b834bb0dd9c1144cab32926a272484'
            'd205a69044d6e68effad5b032f8fe52a47bbaa2128be6142486981a03defba29'
            'bb0547a0cdba54edf863d9740209acbc8c807ae7d3bdfdf0e84f8e0475be5e17'
            '12d8a04daf289d8186460110912299aadff9043ebc3288ccd0ea92fae1cc77c8'
            'fcf4b0b03c8d1c75e46ee059e0573a98d402a30deb469e0655b0a6d86beac325'
            '46fc37dc790739498382ee14a630dc1650e361d7a280ca9610bb87c0c91e6b42'
            'e4bde7964dad64953dc81e17d76f42643decf1b7e251e9f4c6ec97d761d9c3e4'
            'd440f2ed0258a7dde2ebc4f942763de5797724a466a1ead41af4a2217dd2d73f'
            '346955aa0d8b8549fb40359a0c0495ed00a6b02aaef8af8d983a83832b9fc365'
            '9c89878fd7fa2ab27d1c77e0c694c8df210a420c5206fd7648dda1f2209bc05d'
            'ea957490fe54663f9f348359367a539f54a8101730501cca25c514573bc109be'
            'c36a5d3bcf863c2fb5a6d5d698007fde4340f9e9f7fe792261cd8b20c986360d'
            '78f0071628d1dc1a8fa7947aaf46dc4ab3eb593063c9a95d4e2b49847802a712'
            '7fec8f666a07627032627156bc6edfa3d2dc465955d1f86ce824e6c06dbb8cc3'
            '29f683e5a52666a03849a5204e2ffa311efbde9ce215a6e9675d28673e19883a'
            'c1e9e18fa6096a053fa3c967a5f1a0c0c154871e66cedce5960e20bb72815b2d'
            'a2ce66f9fc59600111d0b1807bcb165712a77db71486191b6d1c6b2deac0a58e'
            '0066201695e2eb4a4d9d7da7deb7b609c7daafd8fd2de122b6116196fcec9838'
            '619888e2f8ea9677141a778daccd30d8a8fdf06722035a89689a0878d68edaa7'
            '899439852eba482077e8f36d18b3c52f547cb36f8f9317c60dd224c557dc0105'
            '96a9bde21678811082c4413d09ebdbc68dfe50dc2250ee0f1817d625ec1c6a5e'
            '6b32dd3ec698a695a8c5e2ca91fe8d95326c0bfadd644e1cbe12735875ac61db'
            '8dee14e792e75492b4a5f3c71ae097dfb2116ceb6590c25da015472b13774f62'
            'ff0db3743ca0eb355f8c6e6dc444c5d6d66c9a1b325b38dc9f54d6603368d35d'
            '1e93086aa0f57f562532f08f5734cc9430cc417dfdb33a4b47b43c77ef02f079'
            'cc4005eb36d0df3b8fe7b11740a7472925432a45dfb7f549963cba2a1d5d24a5'
            '71e775cb93a2465e2c8c363f9a69da82d54108cce0ba9cb72b1f2c95dcfb2a95'
            'c0a698a2caf3925c8c3a5f3c75eb6b6c95949b1f309ba5a76ac366a16db144e9'
            '29946b732187c0725856f22fe6b5d0c11940f6f53a1cd4957cc7e06789f922da'
            'f562bf361416a3e8a552ac742b9af0818ccbcd18f3789550592fe0f68b36e20a'
            '63123df7aa4b2d44520587359b2692ab09e103108c1cf6260fcf2d87da1a2fb1'
            'eac52c3676370956f443a4c628f1010f0d0bb7942dd9a2ee4f67a7047ce1b6ba'
            'fb4f79241667f031771ef674f95c64ed8654b5134991787f045c2d47c9701971'
            '4b0cf75cde004145f888d57f4e0cffc5c9487e25793c6c90c33026955ea76364'
            'ad15d09c8364e92883e1ae917bdf42b4ad9e5906f45b36be7eb3139a0ee4ae8a'
            '3f01e0569e7694c65ec0ae309c20f6fb482f6831c3804896f276065b37572239'
            '9491aaf3d5cae1a24ec63cef2baa411649e1f2d0855d05c5284d3d73a5b06da9'
            '69118fb4beb9228b055d1fbdb150dfcc77e9dcf101ab0c7e04e3e94ab1dc8569'
            '770d270d7e6a6b7c322b2d9fe56f7e95640a69c4d62974bbfe657ccb5243eb32'
            '65b1096cde2b83eb4c48de9262bdce2c89959ffbd29484242e31714fab282fd8'
            'e4313c696ff66eb8e4de23bed9375417018e71391c838a58d83b5358fe6faa95'
            'e5ebb8629ca2e2f7931085f6e03feb58150f7c771717ea59da85c64349295c55'
            '370b4e16778934f532e62d52223d1293d6494b658065f9f16da2aafa9c3ac70a'
            'b07f529a47b6de81a8975ef67605f522dd6d72a367a2667adc458ecc3ae53d5c'
            'aa52f0bebb1170a13646e74d5ace6e1299cbd1c68cec97549a4ab03be338b8e0'
            '6c13b3cbedfbecfa2f0c2ad4882eade83b2b8f2913f2bcd9164f43e624287616'
            '743d183ad71effdbe90823fe39188a95f6ae09f8eb6029783aba0ec5473be100'
            'f4597ae7254e88f1fed23fe3bd38a7cafbc2b1b28a8eb340aa769b1ce1e7adcc'
            'f490576dc129b6ffc09c1b03d22064c5adb4dbd58051a313689dc4bb1148c9c0'
            '93f432049762c3e6c0e104a2cd1ba9277549e4ad46b8507a8c52039bb90a837f'
            '4564e0f5415359c2290056c7d3d8dcddbf73dac9ff58ec1a65cd78ee9cd62c38'
            '1d7af90d0124014e2e725cc6aad5ccf221e661a71247ecc4a71ccb2f86aa2319'
            '639cb7815e212ec91b4ccce571acdb9d45533135d7e3a14cfe5006d98d56e3a9'
            '45143e49a6d4dc0a23251925794eb5b71b33e4342f49f712ab82cf2138395ff4'
            '61c5604510f9de515eae8c46f458f1e8cfcf851cc676936a4ae6f80296106e38'
            '4507c58f335f5670d62aaceab8e39a0295f1c4a166a67a7ea2aceb75d53d1110'
            'b5a1105c76bcf01d7a6dece2044750bd9e934393f1c56d785f4c03622fc71db8'
            '322f99397b803523a06fa7a3d3c9d23746883100ef90065503de2b89242dc647'
            '16d4d403fbec834338825cef6106b03d272b76a0c7353d32816ec47960405d08'
            'bde35b7899f8656a9f83388dc25e794d769a07726770d8e1737e3fb2d60df07c'
            '8a2c4a2f4192f82eb02c0016ddaf3e74f8d8b69ee9ea42252bc75b099ae470e3'
            'd14a02275cbe3fe8f75391292fe73a18fb605f4a43e9f4e635e7e1ab2c0c73c5'
            'ed19f46639a237cb46d726e7bea81cc56c80a1a9f415a222be191e31a7cd043a'
            '57cecbf32edca8448058e76136010d17ca9aa81bc2155ae773431eed63c61003'
            '0070a9fa77340fbeda9880fbe37a9d32237b5916640c286465009871772f6eee'
            '152955c94f87aa1a34390c012a1e9013feee388e112cd7623899d5e94f7e739d'
            '6fd83f737b08a396879b8e49052d00377c822e525f5621675d9ec511de638a95'
            '28d18b41b085d281c6a3a2f88025e4d4de812ad52668c3bb4fb9c53b3888f4d6'
            '842f7bd8193b42a5c5389bff8c904b46ea4be62173a913563b2d5e3d24af4ac0'
            '95a1abc28e1adc5b876770ac76ee32212811f1fa2de61d95429da9c706c48bbc'
            'bb4521a25ba705c6b8bf760f272819da2ad504386d50b70747a1c8051d0c548c'
            '72856ec2ef088004b0e00e7eacf9f691734bc23ee9369cfa40028f2fc9c014cd'
            '05d6eb66af7af4ac4a246810afa25fc22f48381111b2b026d245c1ef4f6479e0'
            '7e970f8c96ce7f031cde4b499d89c6ff7bf6e1f6dbf287118cdd363f3baf13af'
            '6da6a33f62c416367496934d204f75bacb264612834ad41d62dccbdd4666ca87'
            '6be071e033212df1ee24527fb9f4c2606a7c218cbed82ac891d55ce4e4f46342'
            '8379d718a24fae1a98cbcb573c7d1385728211188a683975ba76dcef77a101f3'
            '12116f1faf3f5ba32064144486ee9240d54d4a41beabc1f6ff93f1743e304a0a'
            'f6dcc0f66d6de1944a6234f72499ada95f6c68735fe2b11371d337130fa1410e')
