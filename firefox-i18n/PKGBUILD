pkgname=firefox-i18n
pkgver=45.0.1
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
)

pkgname=('firefox-i18n')
source=()
_url=https://download-installer.cdn.mozilla.net/pub/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('c92f06122b45aa5ae2c78eaafa6af47ec991c160aab033a96f6e26123caddffc'
            '3ebf775edfa57cdf4c0d0698bd2e4294a34ce9d8222fabef18937fb7f9244cdb'
            '082a07a14df206a7cb3fc73d36af1d549e4e04bd4365573d9181851b4433e97a'
            'fdcfa0382285eed384684d2b87d9df5d2f41de953bd6042c6041fd4e8240b9f3'
            '1306842e3d36e7ab18fca39a58e36bfa07c7a6b403c1ab7f80293d49d3fc7e85'
            '9f81f29a1528eacad00244b9e71e33a3b7d0210e560a289152e07657883eb186'
            '0e7d02a5579d85b84f78ee0d86a33e47f2162432b0fd7e892d8efd4d43256f95'
            '4dd6fc092f783d6425f6e98aec617a665539675a72a6d9e77dc0550121c49c7f'
            '99f799937b7d4c1f3847185e675aa7af2cc8202e085f06b509f24deda0e0cda3'
            '14e436f1d081f765e498a91d80e1ecf9166d12e364a1df7e23cf146cfeff8172'
            'fb818b3a2e2d9b26c0b39e56038a257d96c4222351eccd38e7b7cecb5423b084'
            '429822a1d0ba4d05af0ae0ca5056e11af3c1eacdc1ca93e092a31f71311b2c73'
            'b0819df02b40fc92cf88e8c7f92f523486a8fd5a59141c44c917e694fb49463c'
            'befcef7813d193a4859f5c9ed5b9e475109be8a34ecbda62bcfebefbed72aa72'
            'baee2a83720d225b2997902f9d9dad88231ac5863c215e4700ec802328a7324f'
            '290af5ebf3d2523b2db67f3cbef46fda273f1f0379849fbf54dddb4a58fd23b8'
            '6ba6b140dd9f0829c616b42916ffae31e868deccfd26d650cc21c5ecfe2c142b'
            '8aaf9e2750d0838301d86daf750e793573d4e59585a7c7502d1bc1eaeb1750e0'
            '48c4efc0cf757c2579c5a95006fe7a147ac255fa0bab566c1cb4ba1f8c42f2f9'
            'ed2aa7340e1d5a1ba4ce98dd05ea9cb5198c3a3d3f1a04d174ed1343a56fef29'
            '987f98bc17139b44aacc0c75fd8df830dfdb697fdfdc8f58e3c8c495e1a4ac2f'
            'c793b6553592f44d32fe5ed841f9d1b2787d3dd9f197f144a55ee40812e090d8'
            '38292164f0050fbb2a7a07fdba749207d3a690b182da14f29fb3794b4672a232'
            'baf5b3161c048dccaa9cfcf2c5b8fa3efb917e385109267fd43eb6f7d3f1129f'
            '711311d2e2c21c7fcddfad51fe4544eed53c1cb8050877a45eb09baf5e134fac'
            '1aefcc911a48d72b6ca9cdb2731c89355fa780c27654faa9d4547b51dcd334ed'
            '0c451a6e7ee1115256634f09386828540fbb120cddadd6628e2ef140ae8c0079'
            'c139daba2b99932d5407b7eb1a22fa19afcaddcc2597fb3460edd42125405806'
            '0d3462b111a0f45bbf9a7c151a6ada6a140d9aa78ee1af8ee05ea43008d7d305'
            'd26ce614d36c9c85d441e90b1c77983f43776c1042513bc2ba725c6d9def406b'
            '5d1f72f60b9bbd340bb30df2169638d597a898c4eae619c7b936f9937ad94705'
            '79f74e3b930b05d5a7482df3d4ea83f7c5fc23a83b03e871a9421c0b3f9aaf3d'
            '1ab66d84a71bb4e322f05caecc1432f01d6c8e624b6677867cf59fa193e7709f'
            '8da9d9b67ad0bae94ffb14f728595e0fcd897aca43a855bad42d6e2d7b7087b1'
            '024fdadb70cb76087fe5d50fad0b7ce0ab7fa9155aa6887b5f30e3a64ba3d2c4'
            '1dea07ef026c36fdd95664de5da897d2b05c5db816b4ee5abce750a47e9be813'
            '73282edd3eab46e771291c4abe82054e6883f094a51b97936f1ab0b87d7de8a7'
            '91eb21f9ce29ec66d363548469a3dc8e02512e84017eb6cc6ab7526f83923a5b'
            '82da7ef84e054a5f46f0f6cff13db2afc7dcb9972b39c52e21a08d6bb41f98d1'
            '1bd9e72c8242ef1a783356c41a02667e18862784450d0403a5263b50ca5c375d'
            'd9ee255b1eca3e684219ad0bce5f92b9a06bf1de56cafd2208bdc2916adf5ae0'
            '2c3de10f055a6c7e55ae33edd295202ea6d940d11422d09c363ee7e8eeaa018a'
            '9f5a03dfab8702c472e0bc651fba28093758ceb4307bd9d534a136b499a65ab6'
            'aeb92b26387f980eea5850710eccaa2c44ef214e63fbd73d7af7ad736fae39aa'
            'f1eb3621574bf14f815b1c225696a047208d7cc1bf1e051a53757e0de4725257'
            '87ab77710d3ba3dcd293cde42a37d9d8ec699140ea126fc9bc84acb0ae3efb69'
            'c3ebab847ba97173ebac6e58e0bdf854d59de1fdfcbe59133408d375e85b55b1'
            '1abd47de578fcbc05dd532e611f56c3f0eecbe48189a8444cdcabfe109b8319f'
            '6f2a5392e7d1760927fe1c3886765183d81db9e8211dd9579e0a45cf2323d2b5'
            'eea18246334f01fe6f1ca0a1db392af9fc624b8113fead05eb28e02f54bc5a45'
            '65c8ccdc98002557ee487741a4a34fec811ff5fe83773b44fead3dd5f04a2044'
            '7d12c969ea37e2577b188b5807582fa878a5155303912cd54b6cacbc7c60b727'
            '9a038dccb249821c3e754314c3b032fe8c4ca00a7c537fd8f583900c502cee59'
            'b59fde7fafa267ffb1f039aef8b9d39980729e98241b5f4a6a7a10cac16a9dc5'
            '53e5d674388135f7a3b28bc7e18ac7d2f0de361b743179156595c053d50aef0a'
            '24e68909d422312ef50a01ee17e06996b6af8a580f3d2a1e4d866284f70234f7'
            'fec2e3aa9635eb0bcf2cc70c05fe9c66f8533e6c5e74d726f65a5f4b57c6367d'
            '1dbc212cdb9abf7b18aea2bc3425f4624753335afb73e9463212b6f0b9f221fc'
            '2e009cd522548ff989af54775cb1873b4b11e5ef8d09e16ee83df3eb1727cc34'
            'ec9f1a9109c836a58502e7e02eb5c3f3523ec8e8b12a19374f9dbbc72280c268'
            'dadc878ea2d245f9e8fcf7fd71e59fb1b885b68eab0ff96d148d5e4d3ca333b3'
            '64769ee7d5d11face8baf92b0e0e227982e12296f9964cc627d37661b6f2d820'
            '94ff02d44ba604b3c05883b852c0bdea80a500a3f0bbe9fee352158ffdcf329c'
            '9bda925a767785d6edd8af6a6f1a9c5efa837962a57a5805221420ead5386745'
            'd81345e76e950fa2ce57e5bfeff25853cd655d789fcbd99fbe4eb830513370e7'
            '9cc7d3d424300625a84ad6256780da421b9229aa707b20ed52c4979ab3b23968'
            '18f0c98b746a72844b9479169e1074cb06164e89cc7f61593539e798e9dccaf2'
            '274f82fe10ef8548bc73d0179712c91835957c7a726ffe19ef5b84b883ed5d18'
            'b6b08b8a530d5cd9d02d8291f274c4722555f75533ab8225e07ea526c6232fa2'
            '100f7639a16a3b427bcf0300daefd35b3c6032ba48f1ee5113d68751b9ddaa82'
            'eca338e79cbc422030828ed7a0414d56db21e5fbf57c28d66712363c5b12c19c'
            'ca5aaa81aa69c8db3a72b6d0446cc6518b0630d784568d640b3604b33a0b9d29'
            '25dd1aec16ea6fe76f7c026caae97872902d0064db7c867cc2ef4ee990a31ebb'
            'dba381741b4cb4cbcca7e9c9e046cece3a7a825de6e380e41c701df50ce5667f'
            '0438210a656e7e4ebe193ff7d2704aed6dd5eb15578ef6e7c9b8ac81f6d3ea98'
            '66941f22bf91a8fa4f27a2cf468704c7b157eed0294907910c0f8b9881a82075'
            '7692910ee9e232d5b9aa4eddb709273690e3540bae09fcb9ba842f655cb6cf19'
            'd90c5fab08eb6e6d04032d832d48cac3a5ae2917372971dd08a50652c8f0a98e'
            '410075944881795fc5d18103746f5f4b27834db4546f876e74fa54151f1ff9ac'
            '77d1d8570834c48488e3151cc6d7cb097e73221d3999e4c790f1cb065de4ba1a'
            'ca221a8f7cc58e6eae372318a36527a260c7c457070bdd39298e73aae9b773a4'
            '41bae31239b5b8d4e83e16458e6d865ee3870d077119779614ea994d92f9ca31'
            '16bf61686e4d9acb44b774910fd9d45f9cf6fcd9e36594a1f0f1d2fc976e44b9'
            '6adf364459607ae0616ed98ac003b19af88890ff77a729658bccb27f097dd084'
            '7c258b47effab51180ba60c4c48ef145d6a3467a97ee5fae8c3e6d6e18dd64b3'
            '9fdb675c2b42b130eb3dd9aa67adcb671c3eef2951e4699ed0d5e7bbd403b9b1'
            '987e1cd064074ffe5a25912ba4714760bc6ad823265e85cc0e419d3da8e7d460')
