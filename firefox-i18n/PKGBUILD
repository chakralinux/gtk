pkgname=firefox-i18n
pkgver=32.0.2
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('any')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'csb    "Kashubian"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'ku     "Kurdish"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokm√•l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
  'zu     "isiZulu"'
)

pkgname=('firefox-i18n')
source=()
_url=ftp://ftp.mozilla.org/pub/mozilla.org/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br csb; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('e90afd2e428532c8f783bf875eb08263f2e05c8f4f271a4e5c0b69465369ee58'
            '70f38305ae806c19b2f4265a3a99fc9112fd6c656732d1300ac21ed7c35d680e'
            'db091e035fcf5c7ca38bed7516dfc447ee9ca4518f04ac17312a5c319ab056ed'
            '4c1d3329dfd91cdc16fdeea5a404fd15b37ecc4ac3178e226309c052a20aa47e'
            '603b679ffa6ce3b7e6eed4230b66bba9060e926da28e1e14ea62a3c82adc1715'
            'ee5483ce774aa44f30bdd62eb12ab071ba319829899743eb9e3b550b2289291c'
            'dc8f58a4357889b4c6a1132202311635f843642c266a605d8d5aa2d88b0d1831'
            '51dc7837570f885475cd9e848c65c57ad7d7c421d0dc42159e2848cf6d6e1ba7'
            '6e20775262a6349df5b5119406c186964e3bf1a0e661785915afa0beab2cc53a'
            '8d0cea06541dd70769ef0b0e3597bf85d8fdc09cbabbc53213a2500c569e213d'
            'a4e129f24306a307e3e8a7138904020eda044a33269420826e47b44ccd6ead37'
            'fbf5253a90fb517f387d690c294302958b7df6b905960e3420f33ceffa3c72d8'
            'd99cf6424872c4d217cb388824540d8934d68b1e8553c45b4c2f606df5657065'
            'e1f0cfa07804dc0e5a897d84b326c09c23b214683b4caf2c7a1f72d59eb7c63f'
            'e5e9eeb991cb572e5555500e9ff395c13c8a5168867e3570248963c3e24fc33a'
            'df68558069f41744d5b7896ef63ea094c4dbaf3b3925eaadf68e6539bc254826'
            'e3ca44b2a440d8c26b24990ca7c09ff5dbd9fedb2f224e4c7f5d943dc9cd6500'
            'c1824c1fa54c30fc9fbaa02fbe07ed9c253eeff201db8dfc96935d44eea3a6d6'
            '8ea583775904d8debb0ed7956a7cb38c5f80518a954f25476d44d9238d526b57'
            '4f21a879842b89ff8d48002eb84141116af084a2a8b88e21867e8df935ee1018'
            '96b3884a2e6836890ff80513358183811810de61c0546e3ea1c8bdce40a5a253'
            'c661c2ca582df0221f737ba8c9ef8b87e0a60ef12ef27d8708600ed74fc21da3'
            '46b9d05885a802a2dfeb31caf67d9444d561715f209ec0dd47086442a47377b3'
            '8ae876473be93b36c5bb3076433502876e6f7baa6dd5723925f7f9247ece42d4'
            '32b9adbfc6ab31e4ede7e99e6b0377219e3ec4befd9ecb72a7d518fcff7914c7'
            '39ede77dc23f4458cb87325d61984ad1590af8f9e493a7b21569d0f5e89fbaaa'
            '6ef823e29d12a60ae33a05d72d42361443700a83646fd5ed563267d1f14b34cf'
            'a525813a2fa64a52e86169881ddbc1f183548f08bb2bb4f1b8348f1b39bd990a'
            'e55a7bb9dc3fecb49db1c060a939a478f55d0e88cde3de44ed7f807de5322aa6'
            '806ca9886d96d54741084ac91cfa6ff2d55d29f3d782a931051a3cae88ea96dc'
            '7a1f4d00fcfe1eec70e3a2d92beeba92dbdd0f55bd85251b108ce52eee5e0b96'
            '15981d5b00a565604add56afc70831b17b2c97425c0869adf0fd908c319924fa'
            '54f3b09a738e167c3d738d74517915ecb4de527bcc290996bbf74d6e479e6202'
            '73c8954de3d2266885da0903e9d60fafb5becd7a7fc31c5b58bb17d4dbfa4b9d'
            'd18077d8deac117bae051666641a87ce249e656a7e4cda1a2b1566f310f15a98'
            '8b3e044088c395b963d88848cb95f8ec0c5094b1942db9892ef2b5e357228901'
            '0ad59c1e2efae3a0e3187191b12e4e963890fddcb4474835091ba81a8542f8fc'
            'f73f0d5c64a5dff8e145a39268a622aa8a393bf0863658c2f98b265395d75f51'
            '18b0e2cfda9a0d67095bb73732e4f3ca53e317836f129151023bf9cecea1935a'
            '8d499dcf60354716e4e808ccdd540b5aec8b2076a49484b93497452182a16604'
            '579a402c7d28071dffaa4631c7350df575f6f42df248f40e558a010bab42a4f7'
            'cf0ed093aaf893c82aa7a4b0c0930a479343e863031bc485feffd82333afcfdb'
            '7540c272c9897aa6dbd5e5e8a7ddf54cc10369026e8d34f2b42e520cec0f7eac'
            '63a1d6d64de122f6ebd0654ab933b7260b38567450acfad82afdec4d027bdf21'
            'fe365690ad708e4b9549f16781e6bf0c3b2f8363011ff83175f5f06a7eba898c'
            'be84427722af9186afc727a6704aed07cce46b102ae536ef882940e75e002efb'
            'e5701f54b6a1d404193490cbe5a9a7b5effd3bc2f38aca90e312e8c4c9eb6668'
            'da4eea83f7189ed3286c7166e81165b4d0963d5b72ea04c470567b89e94ded8d'
            '83316005fe1019744b0a1953ac338a25aa6ff75dd8e085957545f4948ac65abf'
            '8bea38ac71b6bdabec3f2dd1acc508f9013d16fb4c3235fc33008585b9fc5214'
            '0a42a904992c25975334742244c8813b02eb11ac4971fc2eec50844fc562bb87'
            '76c884b507e3d82b585d722d10f056514e77c7f75854e1aaf1eedc1ca7d18384'
            'ba25d3ca16b8b2341341b8158e67666b67d4cb59d3da45108c81841783486ce1'
            'a67b688f0905c84fe0cbed8ebaf1f6d70b4c4f5467484afc05d4746f8555ffba'
            'b049c772600ee7958348a1ba3a02122d7fc1e0b0ba984d43bab3821c870eeab2'
            'cdf10c4c9a842df3635b5ef41acd8d1dc20f2068305a0577a44a1e82d89f80cf'
            'b0cea2ac2d0ada238f9979165507c97577ddd525d22d51b05adbba8863dfd24d'
            'd8de961b37c7d5cc28799820b9d3c5119bbb12e8d1a98e133adbbfa37a283156'
            '53b3ce16d301472680c9485b770099341f6f385c5676b238a00ef10e013cfb68'
            '390426f5cd34aa1c4aee599fbdcb3817b60e262fe81acd43b001abc113690dbf'
            'e6df43d12886575f111b1a1142afd4d557fa374181dc234aefae1b21be9949a3'
            '64d0f6669027404fb72a8c0555b6d8b72a3d2dc8d98c7c51bf2e4b7aa645ca72'
            'b57314cf15efbcbd2cf13a1b740640b030f5edc31f607aff9e8dc90589eda16f'
            '7aabdd26c8e38d67cbb0e3cd58274d5dae02585c68fbcf0225cea069e7b51eee'
            '51317ce538b4ac517032f1ddb68e1d0af9b4e1c423f6e6424508101e4e924750'
            'c982491d6fe31e0d9683b115abfbcc5d1443f355a6737d739f0516199e88e928'
            '2123a9e1498bc96bf80d15a2edcd05c377b33353b2ed9c3d43745f1eb9901bf2'
            'a4ca1c563dde2617adfd15786531304611e40367d69b09f6fffc1148cab46725'
            '85aa719e58bae6ec358e255a38d6db462e89fcbf33133293149f0203f00c4669'
            '2e5ae9b3d090c2d1fa57678e80099130ace4956a08eb53b7f1a4eb3786c70c39'
            '71ceb54e839d1733eb7e7923556d50081ed112190938806bcd61b38b860d05dc'
            '21774ae20a8ee1fabc198f2a33ccf15acb93e5d073f63e7a71baede2d53832dc'
            '93a1080701b893bbb4c6a00e4fee889b018be3b11b61b868c0dfa7e481967c07'
            '728dfcbd3d42d47fefd82a543c31049070c44966e4cab9a3c8829a4148a38399'
            '36afdbd948a522aa4b6276644400712019eefba4a9251a99e804db7710dfee6b'
            'b2dd31bae781cc43147f9cfa2ef71dc6d064aa1a5203284720586999a3358f15'
            'e5e18b887bc0f803170bb679f817a590f80a587ef246c2d8c3cc307a8a904b09'
            '9fbda848c6e47b870ae332c788fe2cc0499529fb97ca9e370b8a58b3043443a3'
            'e660c26d33453e44f7ab84c4da267da37b1afd57146fa0106d505fc9939c6edd'
            'f0cdc4d5c049d602849d135da06386770d9dcb09a142bbb1dfc0b96f26da61a1'
            'b1ca336a9c596b3896605fa556ce2e6d48c8c26dae21575d028ff1e71bb41b0d'
            '68a17d28ff9c67cbd403369d6fcf3f38b818f7d4ad6a2be6ab508964fe09ea87'
            'fa10d1b6e4cfe10feb8076bfc5bc193cb3cbe7aea7f3260e5aaad020027e1570'
            'bb487f9ed1f2955f85746fbde74efd5cceb719bbea14a122409cbac17a913075'
            '0d4a4c2fc40a55f0d9aa2bb9079d67ee9d850289e55abd4850b6520df57ae885'
            '5e87a5ce1bc591fa282f4e7aa91127a56f0d4928ec9295092ddab53d74831ee4'
            'a30f2d7ca7191a74c1dfe70cb4f1473cd9230a17eec84ec02a32348214cfea05'
            'bea05f53bea738366d7ecfd656db6fb328924e74fa2f9208475002b1f91827ba'
            '19dba85790c191d0ae84f511443ac95e29288816bfcb6a9892bf98b9021752a5'
            '7a6d83e588ab468905840270820b1e7fa41a56780fae050c30833e9b2391e90f')
