pkgname=firefox-i18n
pkgver=47.0
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'az     "Azerbaijani"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  #'csb'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  #'ku'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
#  'ltg    "Latgalu"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
  #'zu'
)

pkgname=('firefox-i18n')
source=()
_url=https://download-installer.cdn.mozilla.net/pub/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('935952e7c76002894c633d7a88b9bea9be3a2c0a9a09703800ecdeeb183053c5'
            '0a3e8bf4c889183d6a1c0fda969ca6520bac2be233cf99311445166378d0c480'
            '61f23d5cc768ef37864eb8aeee841d9faf90cad93bf62ff2f94d3e848a41b544'
            'b225247592407fa1a60cc86e5db259ac280a2cc54dcdc106db82bb9756e54b11'
            '1f258c8f4eff9fa4797dd1b1291bde43d403b2c674c6fc14e6d8fa6bec18e798'
            '72ef946eac0345705d61b376b5ad5a0e74c712d840c850a6d7beb7221a4a9d79'
            'a732763a4325eb0f7893691fc83cc13bdc63dd645a502452a1c75c7a33cb285c'
            '7ff14461345d848347293808ac476cfd8e29b409bef8898bb43865f5fa22c1c2'
            '25e86e2656eb2e53bfb4f948592a1830d82d18667cb9ab52a02d4f6663659264'
            '35fd654502ce18ed3da46c954b5819c3da5bd88ecc32ad792e5f473f0bae48c0'
            'ba236ac9e9e12681d440e81da14068970fc354f6d72a83188e6d6c803047923a'
            '76a01db50d4bdaeb84c0d0d1057587fa3309737fa52fe625777d513ba7595286'
            'b5a58a2f7824944da1ac2e8a5ec93b2e73e465c8a86baf781ac44e5b54af5f30'
            '057c2bdf86b534d439f30965264017c91be2660340ea7e8e64fa97ef25457155'
            '5b3d0887d970d78cac56005f68fef744879d5567dd4cd4e4f126fe344b003e2c'
            '39e0b6796cd853b84fe1d6ac1c7ea7664163bd8eefc0e1ab1f97922ae43625d1'
            '2de60d6268e0942c8706438b172035552fe5f45c4009ae29e2941160031e8774'
            'a403cc57f27e60e775cbecd1495ca1186c95a81a4ec1369593db5f4981eb95e5'
            '57372b313b4c422601d508ef85a924014cd012dd4a46ab7a3aa0f23b78912ebb'
            'ba25d9528e507b4ce41ab784330fc49b1f8b000cb51aca795643e8cbb40f86af'
            '8ab99c760fc39aca6bcb2c206943e329ad87e4324944e60d6a9d8003d572893a'
            '5cd343339aee942b6d98ce5e60008062d649108ff3f67c09d86ec4c1b80290ad'
            '57c9fcc28580d8d80d085d85b8c21a4829955e350fa09fbb24afd8cf2963b4ba'
            '0abc3b591edb099f65ded60f5d5364986b685d9ee67c3ac47d116ef1ece2cbbe'
            '93abc34f60bc7313d2beb39f680236e27edb0283335320b1acbfc0c5697d1995'
            '7c60f6c9eb42352b26d04976878cd37694c88c3eabae7fc9c4cbaeb7a53b4160'
            '78d9f61d45c333948d1eb230e12aeae37d2ff92ae7b3c76c760ff01ed11174fc'
            'f80a991435174e7a65ce7861ba629cd62bf3cb15ef0b10d9a1c93cb009ccb7c9'
            '54eb4aafe7a65b7987a17eaf48ba87c3ac317939c23a9fa5605e1ad55b513e0c'
            'd522cd46f15eb22daa4dba1f862eb0b2918262abf5eb55f7b206edb931935f5a'
            'c7ea9996c2892e6597a182d00e1fe483e83e0f6a8508cfb651c85c1784ec62c8'
            '8d18362028a9d932d68970f8c4e76db3cfeb1e0fbfe6ee735b55528ce3e064e3'
            'c4c6b2b8cfb45fae42edf98301856c8fe9738b9fdec2a28f72e7aa63c7946d7b'
            '6a652d78ed77eb449f0bd9d20cd9d261f01425a1e1dc4f70a2370b328615083b'
            '6ee4f40cff6c6174fa42e8f42cd2d3551fcebc789d4b172fba75bf799df95727'
            '51be91ca9749a2d035bd3f458ae0c2268bc1a406371bc6cb75eb52f321f647cd'
            '30d4c7abf418f12a32eb36a02aba4173b82e135befc7c0ad2dab30a392e5272d'
            '27ef65fd64f97701f843668692f316d06b54be090ba0e83b92456937898ed04d'
            'd0ca6923c0f57526bc297e1fc1404746e6ae43561a5967f2abd42365a4263c36'
            '755b7a649bfd99a3de2453b4f2b0fdb6d858e37c78ffffac4254d6cdac22f1a6'
            '79d2a4f4b95e7b2877264b4ca5135fdfa4c1e8be42fd03c57305e75ac3123f55'
            '30ea2c4c818e5461fc015286f8dd9b2378813a80fa45e8f4bde8bc44d6ee030b'
            '94695f8ddab26401891c78044fabd7d2f13987f58c0f57ff0664431b39e2a021'
            'd06642fd609b1353b2ddfc5a3d33791fd3b7381706385c7872eec31b1624901a'
            'ca919032488deb78cae90de84f65cc66a2ef97f9543f481c038176eba70f98dd'
            'ab3dc63b137ae0d8ae2f96b292663e36460d1548b323e406d8c37c0810c28c2e'
            '2caad6f539999b1fd013772da8f3995f41de9ef7f2637a32acf117900d8e1b81'
            '37c88a23c3b4a1531ada96897f6d075f5b29376cc15d789c87c4a6ef41383666'
            '0ed4a939337014ca95084489fbf49a9d9b018cc53e0af0f3504405561e47cad2'
            '5e87bb29a4e8a5780076a00500ccced9d8188f09294851e9fc4f93bbae1a12fa'
            '50bd7f531795c445cd8428a38960d4a9200dd6650c2433377dc4ea30da59c27d'
            '3d35b65c13866a5fb1d6bce1dfb2ee9bbcd19e218c24d4c32b6b14cfca89d17b'
            '019e8bb252631d7abdc52753afad92e03e57f99f5c01f65b9651a8091da64882'
            '60935db2e91d560ad2a3bd37091733c55b68c96635e0a9a84c05c7a37292c9cc'
            'a1f86e836f8e4926a861d894e48bddc5c9d47b902f44e73e7ffcb4f7ebbaf491'
            '51fb7633e9323040981fbb377e1c24e3cc60c485e0b0a496d082afae400d7bcc'
            '5a5c2237c3ba8529b9cd664601c5656ee90bd1568df537e5cecda24e5fc5eba5'
            '8e27739d360f82c8fdde883fbc7585541869ab5896390857f72e336503d847d7'
            'ef08e9f3fdfa3f4f0aa3f518d66d208b65ceefe358d714459ce64fd89e0bfb1d'
            '160ff0b21525be3f78630537f13afbb47b8956124129d78f2b7bc46166020de0'
            'bc0b4dbb2f252c167c720af6b06448490075234bfb0dd61b678bc38a7bba9bbe'
            '4ec54717f841da3ca316c89cbdf8871fb270d247113e06199486f01adbaeeb1d'
            '993c9ccca3203cc35320fadc3b7b06ce3b8cfb20b560c0449cfe00a5e4742363'
            '37a9507b6a578c89626da15322bb6739de3c13cb8339aaf7beca908f4936da5a'
            '3d40e0b7683e9ea7ccf04fa95d021c82f5659affbe35870e85050abaaa667e41'
            'f905006045f8ae7ccb97f77b50c17eae8cc04eed1902f33fabe5e6805517ef3e'
            '9e6532618edec37b4cc51925b895c62310eb32dfd2fcba1313f163cc1e6129e6'
            'a9f22cb97089c5e58e4559c679b5403bf347d0ea61a5a0e7f92b8a5a33e366bf'
            '674cc511d76ae1bf2b9aeb19e416eb783899bf143f6634e42b332ee012b921be'
            'a4b13c900d72f45413075690d3d9593ebfe1b71c67add0be695fade05d0bf1f8'
            'dbf5d9334804d104ecc64f8041f6e8bc739afe6b7270e56d7d1bc918f4018e83'
            '515e28a910546d6856529d1eb38aab4ab810f97f232b96ff2c40496aff512eff'
            '3d7aedcac13f621482ebb57f04794299964a802b8ce4f56fa72574c0b64eac2b'
            '5d79595c80ef9c391fd1401b945e0c58eaf7ac72f27e9a788ba9bceac1cdde1a'
            '846192f73a308e46e8dd6bad9572177fc41fd9ec2355a62ff237ef82daa301c1'
            'ec7465620030663912f3b3172edc152a2450782f7fdb4210d9c454050703364e'
            '457c16d92450f8883daaa12f901c99af83c3be84917c160f03c2a9207f962deb'
            '356737f233b91d09fbafb45090141df73c5d44b9f73934bb00834cbeeb33a572'
            '33b5df132e13a8dc289b052d1521e1d563060a18ec4d100926afe18108012522'
            '35840f5d6d6e97ca65167bb2e9669cca20b29b65552be992853cfee3d3c5b75c'
            'c9daa43f0d845d23ab6772bf537b0df7af2e63157a9faac66a7b5430a3105135'
            '802737b926b472866647590820fc26e2d6df004705af55439ff37da8aff12da7'
            'be5602bd7a234a8ea5d30acf2b4b56ac049e67b6b4880ae14029712123d57e61'
            '136d4656655a14edd4f2908d623f49e5cdb4f82b6fb9727489c32b134c445f74'
            '3da32acc1a959e09f47e79574f4343551ee5ba6cf489410bee70b033a0f67829'
            'bb42bd58d68f8b8db9a0356c615eac0e275ae08914f93f3e9648f9227f376746'
            'b6c9da47ad3e612087609185ce9936db152cb9a09a4a643ee43db47063ba9edf'
            'baf7ea2514af199637066978fd47dc6b646cabec974f61da72ad3c21360394d5')
