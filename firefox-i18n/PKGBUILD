pkgname=firefox-i18n
pkgver=44.0
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
)

pkgname=('firefox-i18n')
source=()
_url=https://download-installer.cdn.mozilla.net/pub/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('f4786d08cf6a8e8efd20e5e3286171e5604f4872a0942926fc1d9912b075c646'
            '1d13abe89ce965686e94ee71b0227de4eddb919e384fb7ea1d5dd791c90eff6e'
            '61163f36317ae11e5ea2d37d5a0a1dd90ebfd0a114be04ffad78f61cad996537'
            'cd388ef54eefac0db789a01c7881043b8a92b6a080f30ace0c2e8d458e05111d'
            'eec937cc2a067f5aa69005083f5221f0d75fb61b7918c9aaa9d36d9c03b3269b'
            '37676ca72aa3724bb62474cf50eb112b625d76081f5656cb378d267b88b3d54b'
            '8b243a999756fa96e695b412cb62c5dd95dca47ba063cac981a2e75302a6b4ee'
            '7d5202596015aa2381e9c0ecfab7f0039e1a47a8f70fba4d9737a8776c3faccb'
            'fb61de852f77ed0fd2acb21f41dc774942bd275e66a602fd087b9f9016d6b14b'
            '56a146749d7c21d69e88d8bd4c8cd66472dbe613291ed71cd0b8282bce8e9cd8'
            'fd436809a95ed0aacec39e38b8f7478edbf34c4d730ca456bee7cba22b3c8eba'
            '99bd279c9c532e5ef94a17a6310f0bc63819af35208d6a65ba2aa87d58c116cf'
            '527ba5bc54ac987747eb6daf8015b502de1b736b79ba1b12eef4dae19d3e5626'
            '24fe3b3d7769912885adcb8b34cddf608d8cb5961d342419a754ed3f60f012f5'
            '24751eea9f83c15cd8f56e8d40038b4a7006d5fcb00c86732257c4e15acc2c70'
            'fdab25e48341178e06b1d3c614e2e28d1771475b8eb0399b5769a307e686d68f'
            'e8e01e1f45e79f052f5ea5292c16c7a40a86552a3a3ad40e78b3d69aff6c2c9c'
            '3e39641a632007575455f7ba1b4b2e2f94288bed5f1f39e41bd477014f68cb7d'
            '01de14949e4b955820a5e7d77e3cc45c6e4a406caae22929d40b3f6911ea77cf'
            '6179157df34be099d92ffbc22f3613d8e8a03275f2a24298082bbecdc2cbfb23'
            'bf3cab27794b4fcbc47aed51c23196000ffc5fafd14b1894712e2cbf84832289'
            '91315f2541d5b92ba287767d6a333f646d29e5d133f6e110b119239854d477c3'
            'd11eba7f9bff967e1fd0b4f263025943c0b516c6fd3261855045c444bc975feb'
            '5ec64c3258601ec94c88fe5b741e0f0f61c8d3f8821db75ec2307685008fb9f4'
            '74971f005be57b0e8aff84c623ca484c3038fefae03096cb94b1ac0b9622bdd0'
            '597dc07279eff6b5512242d0866b4eea603f4529f17efa2f3e1d39882c315f6c'
            '1475891d685ccc69643317366ccd38d0fbfc06db0c8ac674ecffbf5b56e235df'
            '0a4eee3bb98bf24ddb121eb55f662d0f93ee9a8bdfe5307428552489eae70fef'
            '144bcded733accd5a6bea5d27aea70d92555cf5827f09939b46ac3744331b0c6'
            '24c356b66551cddf54064f8beb67846ab64a4f97209677197d84d604d89e7f95'
            '82d9f95218c4646f6b513ccbdb6b350d24a338b303f41c78d0fc012187a91452'
            'e518ab3426610a8efbf36fe5ad63b627d4a4506f1d827a845867010aa0db7e44'
            '62edf16fcb04ab34aae8f9d3818baa079f4e526b53c10d6f8aebf2e86490bdd3'
            'aa3faa6a9f03fb5136c5b5e5ec9f30e2c41af69c303b99b64ea0c6f7a714f298'
            '48ada863c757ad673e7696fd440dec8296f007ab5edc50e7d2eac499fc8fcd90'
            '47953b05afeebc71883f6949004dcddb74467c9a12abe7e2ea23aa7a61eb8e31'
            'd9b688cba2eb8bacbdaa5ab5cb7e686c3523b7a86620d7fb7f0c8255e0541599'
            '49507711563d3d3130e2527bc60033e75267c9d0828c26d14f35e6c2e226aaa5'
            '47a93ae612ffe376d110637a299670953085ece7ad0d7814dd7a4c47dab4538b'
            '96555352ccefc8b7280f0476477d5bd20718929ea5cca86cf170baecc6b4e760'
            '75fa4a520d6faa36fb828d84d521cc51611dc403b1d91d143ed4fcfcd0291989'
            'c2aa8b13bbd1a117c18af4bfa106b8f66016761192964f19e7155109372e85aa'
            '21b3cce38d404352b33c648b1473b0033779805119f76777eb45d0839daa90b4'
            '1962aa2be2d4dca8c4579b3bf1c632b15a719729bf531d3f7783404eb11c99d4'
            'afd59cfffde08f2ed40f52acd9a8db52a009c478a1edd9b1ff8bd30550bfe3da'
            '22379f959984a936e32613aa93d21b11338659ae6b38a88c424cd63f39ab8862'
            'fae8e54777eb8530d1fb7e513397d47c4376b70dfbd719e029cfe151090bbf4f'
            '0fccd728bd88baf0aadfdce3fd03c9731a52354b1595231690311c511fc6a282'
            '71c5f6cbd6626044a7821d2e3a753b005c07fc37c1fe4c0db5a8bbd0c8b9ccf7'
            '87aeb4e792616efb3bc6e151699be608d4efa53b52e99de3befd26b48d84a319'
            '5f68c5b499f91f8156669a11c523fcaf6fc41a4a841a5bf66fc891bfb5d26881'
            '181a832cea27f03dbdbe336a1df731a07f22f0cca60cf78351b1ee41c2708e42'
            'f283d69ae00870e7de38514854f57bf12d49aa34529c42cf98dc5f09fe428cce'
            '57772dc3b519c3e1e95d4c6ff6cb0b0ec97b8aa941764f6c07e2aaf6bb0ad315'
            '82f4116db42a20f3feeab2731a6cd335135b8028e7e94ce76a78336084036588'
            '4b4327cedca68ebbd6b4ad3411cad4b783bfc950e251b5d20678ce2bec1fb246'
            'f8e203c946c7d38404a48ddf8786358ac5ef92939464e14b985689c3ce1fa60d'
            '51baebc09792bf739bc2f3b7b278d9f8b97e3ff77cc2b498994ed47e8a387865'
            '7042ba57eeee762ad505514d0610f7b2176cf316cd9df8d8d5e0d25ac99c75b0'
            'a4169eda245d5350c8832df0e0a980d642323548ebaccf30c31d9b9107df65e7'
            '1c40df031e8b74389a9892460f42d94cee73e1eb1a65e4a4a17314cbf65df001'
            '8abcaa6c7bfec10080010be24bf517676a365354e1f313b53577d1b93ede86fd'
            '3c544aea80c8d3a368f44cb19634f4637ef8d72c3aad39df3a2cecc0ec4a0d3f'
            'fc92324094fdfed0e70d41cd665853dffab1eaf1fe1a90dfb5e63b2282107486'
            'dc99e17cba7c07e655d035cf47f908c48489096859b0ae0fca1a28f24240452e'
            'c95b7cee97b6defe4a6cae2d5a0540db374e8ada201411a883ef53ac30b26107'
            '4eeea4ba8c7872c74d4b2b282017896eee90d20fbfd79b8e91d5e5e140ad3eca'
            '07690a8d4ae993fdf2339addc1010ea84a0dbc99abf9bbdcf537462da7506aa6'
            '0373f6fb2d562d941bbf6359ccd35c0f50ec0adcc8bfba3f33bce2aadbfe86e9'
            '05060e632dee824d2cbc8529522cecc749e2df7e0cc55d64d14640045b734fc4'
            'f284e60fa07244939054818458055531a0dc7d3f089e4152561dc829c6b8b151'
            '9cbd25b686c2e2f998e41085883f6a9fdb4057b5462699c27710b834e7eaef1b'
            'c4565b4d4efc7360b9bd9280986563a2a442e5a500c3eb6d652ec73413c32e38'
            'c512c2cc07d79cec1d8713b44b819c2d970863d26da2ce9d6706f07215958098'
            'e7e0b32e0057908acde0ca3639695f5cf8e9cf22b5fe8f005f4631878025d1f6'
            'a36621b7860a3844398778e0fc2431ec769dcd7761d2598b077fd70169a35e08'
            '6d7b6d2d68861b81ffefed01eb4b218844b34a444d83de65d37e1fd94d34ba95'
            'fc1cf1df2bddba893056481cc7568179014d23762302072bd608c4909f77e259'
            'f40ce2506cb90ba1aeb2cc84a91511c021ca3f6d8ced52103136b055b728eb97'
            '2d3bd3256c7ca4db06ede1f18e590fa7e8dc14f5a6667d2a83c8b5a691f1dabc'
            '35457af3200faf1e537b5d5b979b23b972a052dd229ced2f8576df452daee59a'
            '0dbf2ce6e12d763eff5aa74654b23ba0bb24f6052d388da2452c27957a187f6c'
            'd0461ab10a0b1eda088240f510ea46b87cf9aa97c303d2c3a3c738f2eea67ea3'
            '1657e0a77ddea1e254086f88bd0f8dbdcbcd7a164b05a1bdd040a81a6d466e7b'
            'cdf4a4573523872e65d1f01ed10496ce2afcd1de3ed360c3e4a5ad54d2244d80'
            'c66dc0fb044bb4b7dfecd1521a44bd487ecd80434b7d56edf8ee2fc123bf3c58'
            'b6e890e142d4bd8e6696ee390d8c219452b5644555bc6b94121befaf1ec42363')
