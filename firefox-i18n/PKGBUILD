pkgname=firefox-i18n
pkgver=33.0.2
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('any')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'csb    "Kashubian"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'ku     "Kurdish"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokm√•l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
  'zu     "isiZulu"'
)

pkgname=('firefox-i18n')
source=()
_url=ftp://ftp.mozilla.org/pub/mozilla.org/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br csb; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}
sha256sums=('647a720765420b3753a03e02dbeea3d1f0a5ba0bc78c480a3271059434641d83'
            '01e5c5856dae4b78a10ec938d66ae73a0e196f861eadcca4277bdd1d249dff3b'
            'ad97cb96135e076a99b7200aac49958ec68f72bf30c841865c231393faa15d71'
            'eb3662ecb603c2b2e46a4c2428ad1d1b7a9c7d73da7d3725947f17e5bdc6e7bc'
            'afa4f31241696d6e718a58c5fc772a685781c6134aadc0f7b38ffed8bcb2b074'
            '43c2fe176534f1dc84b9c77c25f9d2ba8e920e9c82fd8ba7d1eb828ff6359436'
            '5835c3fbaffe8e63ae70406761110664695a9892a7c495ceed9473184d922f64'
            'af69bdd1d1b177a88c81a1aa00a71fc7702de5f4c54e672a292f4f550880caa3'
            '4c073f5a2e3e08013016ed18ec0818df6227d0c32c303fe252da67128f82165e'
            'f190f85f5ce1bfc31659650d7dc72d7d3e1296256a06258993521fa3ac83dfd4'
            'd9bd27fc83f7fd77bd0781cbf2306fd5ec315aa0b3ea308cae4c781476cd7844'
            '95122509aacffbb3bd532d61840bf89b9063e1ca34b2241fabc4f4f5f7e2eb88'
            '0080f31f98c82caa59259bf275d8523e23026383337bee16d731dfdbc274cf06'
            'd065591454a9aecf12a616acd2422e9b784122ae90a0e1691cfa4adfd0c33c5e'
            'ce2e336e841344eb9213e6cda5417461a477a858023e15046663a3e835a17656'
            '83279bbcf0d650b03ef5103f156d4b17593a3bd8406745198edcd180120482d6'
            'f88821bfcc2cb5ffc6758a52ab091cccd5b4a7b0558b2248e9eaa06c45a5aeac'
            'a126d7690fce5f97182ddf42689c1149a28387ec8f8332703cfac5f3180cb301'
            '6e65c7984f34fe6dece7558f4a3906a1dc1b852c5b168baadc68b672bda35f14'
            'e18a8521768d2470a14a96cf8729c81307fa2bf31b540c816e9f030595e5981e'
            '6037c09343db69a2264a971f65e0435a6c6e52d734c6f2a535395f296519a0eb'
            'be98f39b2ca953d47c33ce16ef13d5f77357ad135e20514ee75198731073b40e'
            '1c6b84d74461d2943e26c07fd0738263280af221657f8fad2e9609477265372a'
            '9a409f1b605bc144227edb0a1ccdc5acfe7a9c88f42717d7d4d1f8140994e0a8'
            '4aa6555ffd06318d375242238b48b587dd9ae3f92a0ac92b0f9502473e4e46e0'
            '7a3ddf61539088ee8dd7d7da45acaa30edecd49b06a68ce8054922864cbba709'
            '42beaa3ff8d582b5f375899c2f45cb0babf29fa42b8bf8463320199913047f4c'
            'bdf74ea35bca3655ea9e0908975cb2666de8c48ca8f35ffa2a93adb14dbbb456'
            '8eadcdc711da0ac710aa10d1006b355151963ddb28ec60d78e8d06c25ce1c4d6'
            '706a04d1d8cb7f9a53fc0ad3ff917bc9f2743323ba867c4fd5b365c56de60eed'
            '6cf9ed7413ebac7959f6cb453117f6c99bd3a65f760ce1475aafc190f726a269'
            '6b80ca8b58b0e85aa9ba39e3b32c20fb282ded3e3b4d37f605fc8e7f8d153038'
            'cbf248a92e0acd7150c047be6e516a0f6b45a3769c9d610b0595bfc9d4aca644'
            '9ed9de8ed1cbf84a725456087aab895d02b951e8c653767fa11dd5756a8cfe49'
            '987b8943a788d73b9e02253eb48ef9cf2fa73f87f7d2c0ce452c133cd4f60516'
            'dccce927f1a33b9f944913ec1d564753a9bf3e311a8736151fccd74a17b9fa09'
            'bf4f49e9bcbe34fff9c974e93ad090f820670d6cafb7ca50d38f7b914e093ac0'
            '494061f50c9ba6b0241c9c1bc2632ba18ab55133a0c0d3630384996f83d63ee7'
            '25daa53c2c980e9ad4a9baddd7fb0810f5c8af05543ca53e559c9bf2d9793db8'
            'c5181ea67942b30c315aa662416987a73a443a9333fbc1abd25eebc89c44c143'
            'f0e9c59a3ddbf772c6a09e76a9c7396303fd6771e2b0d7694448d62c7f8b3fa1'
            '144bb135db16ce29055a3198b782123f7dffbf9b7cb8dd497e0df64a42242fc0'
            '5050ecab5b6b9ba63b286b9dfe2a5a25aa655c76b30a1681192dd67f6f008708'
            '253ba8519f333fa4c0ce120f1a0bf66c6b2c4308946f6b6417ba72a4b7a29313'
            '9d422943481bbc51ab85a1c59dfe8796e8107e03218b1390bb6b559cf696f3ae'
            '933b34fa82f9b50f11b9e65e8c60486a06766d25c73383ac8ef896053aec24e1'
            'a1b2c73662164b7dd84b87c9749e21fb116f60fa293da0240f8356a421672bb1'
            '3c75fef6296afc42a54cae221e3996f9491f6364045284e4e4024bf143e291b9'
            '6b4371fd19f699f4caea0d0f753e1fd52074604252aa9fc949a593db4f8b0d97'
            '4f9018cb1a36fd351a13c0b8925d651ec71d711240c70f26545f70d3c6037913'
            'ff2d800148a68094d1496131baeb6ff3e1f192965d850544e8074364c8e42e84'
            'deace899c26f0d56a9770337b5e2e8c8bd60b756274a18d0b476dac747e5606b'
            'dbcbbc25f11face5a47634c6beb1bc591d955d434361c107bd1790a90be2df3f'
            '32d3efe51e038725408277bbfc161719110009ac51b74d5e519919c43ec9bc58'
            '88e954f8265e402ac4182b9e3c29d800eb203fd59eea347c3bba86bebdb38621'
            '6761077b7e24019112f954cd062093f5e101d1f2a592681d39fefae8d8869de9'
            '66133c85bc84dd5e9a4027e007cd50e826cca806b6784cffd7f51632be4699e2'
            '4f353b6813e8ea597ccffc504c2ebbe51cac78403dd7706dc266715a4ac129ff'
            '42c39e457e09446abb5b86f8f25eb8e50720de9ea1cbaac31c3aeb1e2559b0b0'
            '1d208aa07b89af9078f2ef56b1de8ca16f872cc9e19480a1daf631bf0ed16df5'
            '6ebdda7dfeee45e01f729b2e504ea192683fc7d7580fb2e5b81152bcb3672e77'
            'e607bae6da96032cada1bcd1a69ba228aa7b3be58e59d921ddd4b4b4200f6366'
            '91dbb6baeed00191687a97ed03f85d5332db9c44fbeaaf8bbdc1f2bf291688a6'
            'cdfd521588cc02546a2e3119b03e0e1be58d626e278fb871246d3245581d176d'
            'd9b0410582db585830ad2499b1b5a61a486b4dca471e7a2e584112f90429dbda'
            '12f0f05c9d0178922d425b957d3cf2c4b848cc54235c072cf78fb7d85b2e2ee4'
            '7849527a35526d7707f291f5fb1cae91f7466686120bf0900e26a4b4d340ce0e'
            'e527baf437febf18ecdb888d9b604334859486a9e1d7bf14644804fc5cbe7008'
            '8e2ab574089dc9f8e11f576b71b610dc6acc8b283c6b341cb843229a560830ac'
            '2aaf51abb9c3ee76ee2e4b4ebc6a1d3eab36912f9ebd7dccb6193f9e062840c6'
            '63d78ba681fad3134b36a62cba5d4626771d5563e42889fcb0d25cf2afa22708'
            '9b01dfdfb68d19cdf836ce57b438f635ba0ebe1176751aab553092d7978010a5'
            'ae8d4a5675d44aaf45322780bb0184d80eaccdec54cfa3771c1c749e22cd0257'
            'bbc5760581ff6a223794c2304e295212726a7ac1f915786c5a8c7a24edee7611'
            '35834a0ac42e4582dc2033d63fc955f5953eee2f3945ba6f1e67422a4c4a86b9'
            '1808c4d063f6b6a29994b99b42302ccccf91f25d3954102d709e53a902b5a81d'
            '08dcccf9f010b29c5c0cf3ac593dc873bc24d77ad437df0205a81634e481ddbb'
            'b2d630ef75eaef6724df31709246e4071a92a209eb43b046e41d318bafa58f95'
            '0588d6c5babe4fee8d48e40a5d9768aeb70bd3a6a5e6474cb2edbdcd35a086e7'
            '174054b2c0ce2d2c4d1edb7ebf132c39b0c06487e97e61aeadeb139255e8e493'
            '15c9172b75498d9c7339b99537fd17b3ecc1b4aa1fd88dce20212b5336213433'
            '4bd4fba4fb3f1418541ca6a4ebfd23e96de8ba260bf369cc481622f304ac97d5'
            'fd5b631b443fa98ab1118416ea3414ea5c929f8df979413d4f1f07c85ca26502'
            'a15ba00d417dcbf91556dd10f54cd58f403e6d5f74d7980a0c2c2e65a938a8d9'
            '9664081db267453665cc70f2bd697ba71718e4dcacfc2da663481074db924472'
            'c33882c77e7f07baffda80a724afa648c7dec716189062df80b3ffa409a1e723'
            'f5f719270940110637405002083f2adcd9078f3c4a2dc2ff7db41a7c8f29a66c'
            'b023d27df3f1f85ef79bf11c1b8c09f66de56f5c60cd3c6d17c0002dcd378edc'
            '36191f2e4e4f52a847971a943d42278d90c82b4b8ec43c3d7d3650bff87f92cd'
            'a2d14d0a39cd83d10783a725508771a3e7f8f0f38170bc30b540f24bcb4dd745')
