pkgname=firefox-i18n
pkgver=40.0.3
pkgrel=1
pkgdesc="Language pack for Firefox"
arch=('x86_64')
url="http://www.mozilla.com/"
license=('MPL' 'GPL')
depends=("firefox-kde=$pkgver")
makedepends=('zip' 'unzip')

_languages=(
  'ach    "Acholi"'
  'af     "Afrikaans"'
  'an     "Aragonese"'
  'ar     "Arabic"'
  'as     "Assamese"'
  'ast    "Asturian"'
  'be     "Belarusian"'
  'bg     "Bulgarian"'
  'bn-BD  "Bengali (Bangladesh)"'
  'bn-IN  "Bengali (India)"'
  'br     "Breton"'
  'bs     "Bosnian"'
  'ca     "Catalan"'
  'cs     "Czech"'
  'cy     "Welsh"'
  'da     "Danish"'
  'de     "German"'
  'dsb    "Dolnoserbski"'
  'el     "Greek"'
  'en-GB  "English (British)"'
  'en-US  "English (US)"'
  'en-ZA  "English (South African)"'
  'eo     "Esperanto"'
  'es-AR  "Spanish (Argentina)"'
  'es-CL  "Spanish (Chile)"'
  'es-ES  "Spanish (Spain)"'
  'es-MX  "Spanish (Mexico)"'
  'et     "Estonian"'
  'eu     "Basque"'
  'fa     "Persian"'
  'ff     "Fulah"'
  'fi     "Finnish"'
  'fr     "French"'
  'fy-NL  "Frisian"'
  'ga-IE  "Irish"'
  'gd     "Gaelic (Scotland)"'
  'gl     "Galician"'
  'gu-IN  "Gujarati"'
  'he     "Hebrew"'
  'hi-IN  "Hindi (India)"'
  'hr     "Croatian"'
  'hsb    "Upper Sorbian"'
  'hu     "Hungarian"'
  'hy-AM  "Armenian"'
  'id     "Indonesian"'
  'is     "Icelandic"'
  'it     "Italian"'
  'ja     "Japanese"'
  'kk     "Kazakh"'
  'km     "Khmer"'
  'kn     "Kannada"'
  'ko     "Korean"'
  'lij    "Ligurian"'
  'lt     "Lithuanian"'
  'lv     "Latvian"'
  'mai    "Maithili"'
  'mk     "Macedonian"'
  'ml     "Malayalam"'
  'mr     "Marathi"'
  'ms     "Bahasa Melayu"'
  'nb-NO  "Norwegian (Bokmç–‡l)"'
  'nl     "Dutch"'
  'nn-NO  "Norwegian (Nynorsk)"'
  'or     "Oriya"'
  'pa-IN  "Punjabi"'
  'pl     "Polish"'
  'pt-BR  "Portuguese (Brazilian)"'
  'pt-PT  "Portuguese (Portugal)"'
  'rm     "Romansh"'
  'ro     "Romanian"'
  'ru     "Russian"'
  'si     "Sinhala"'
  'sk     "Slovak"'
  'sl     "Slovenian"'
  'son    "Songhay"'
  'sq     "Albanian"'
  'sr     "Serbian"'
  'sv-SE  "Swedish"'
  'ta     "Tamil"'
  'te     "Telugu"'
  'th     "Thai"'
  'tr     "Turkish"'
  'uk     "Ukrainian"'
  'vi     "Vietnamese"'
  'xh     "Xhosa"'
  'zh-CN  "Chinese (Simplified)"'
  'zh-TW  "Chinese (Traditional)"'
)

pkgname=('firefox-i18n')
source=()
_url=https://download-installer.cdn.mozilla.net/pub/firefox/releases/${pkgver}/linux-x86_64/xpi

for _lang in "${_languages[@]}"; do
  _locale=${_lang%% *}
  _pkgname=firefox-i18n-${_locale,,}

  pkgname+=($_pkgname)
  source+=("firefox-i18n-$pkgver-$_locale.xpi::$_url/$_locale.xpi")
  eval "package_$_pkgname() {
    _package $_lang
  }"
done

# Don't extract anything
noextract=(${source[@]%%::*})

package_firefox-i18n() {
  pkgdesc="Transition package to split build"
  depends=("firefox-kde=${pkgver}" "firefox-langpack=${pkgver}")
}

_package() {
  pkgdesc="$2 language pack for Firefox"
  provides=("firefox-langpack=${pkgver}")
  conflicts=("firefox-i18n<31.0")
  install -Dm644 firefox-i18n-$pkgver-$1.xpi \
    "$pkgdir/usr/lib/firefox/browser/extensions/langpack-$1@firefox.mozilla.org.xpi"

  # Fix a few broken langpacks
  # https://bugzilla.mozilla.org/show_bug.cgi?id=832060
  if in_array $1 bg br; then
    pushd "$pkgdir/usr/lib/firefox/browser/extensions" >/dev/null
    unzip langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    sed -i '/./,$!d' install.rdf
    zip -u langpack-$1@firefox.mozilla.org.xpi install.rdf >/dev/null
    rm install.rdf
    popd >/dev/null
  fi
}

sha256sums=('56dc5eaa8e02f7e13415930360a4e3c8b055ffe7d5188361ef8c7fb8888c0410'
            'e101aeda9dc9bf9b20a3070aa283dd2ec684a1c571f8aaa8818d22f4f7716231'
            '40a07223b39cce45aad88d0ef75b0f73f7e2f1223c57171b2043ec2cfb657071'
            '4666099155dd015ee53199e26ba926c33646dff4134ec342da495071eea697b5'
            'f8ef8121d66596127e1029016bb3b60f341d3b544dcae775e384c92d32d7d045'
            '2a6b66aeb5da4b6153d421c33da197f2de4bff177e7c2fcf5c857e36a8a8a2f6'
            '8c5ff0d55d43b3ad3237ee53e49a53974457aa60f27198c8f0b5dc25fbce6660'
            '1576e07c9ab4bf8387a83460c676274ce815151c42e94bd23bcf1cc8b303c129'
            'fd8d535163ca560f5744318ccde0db57cf0934e8348fb46771b8f5167645b6e5'
            '9c3b6870d1a7d33caf0af204d844e997e2565a583fca6fc1a67137f5729874b9'
            '54afe1e5be21314719fb3ede2df3aac23b04eb23521877db786b0c1a36f45d59'
            '9e3f7ef5b9cc9c425ab9befab0bf40a214a9d5f99bb148ac711e0f5631295820'
            '30f43527cc50da52d1b7dab24498ae1f8787004f44c7f06629db1da9fbb41231'
            '59631efcc33e26e7c4a5c7ca07952ec9d305ba3267e9713ed3dc5932f2f0254c'
            '5bf01dd56e527022486a50f560a54962527cbaff31cfc50032323e80ba419de4'
            '2f9becef4ae0c97a620200a8fa7249135da22ebc52f4da1b0b60b229e7a1cf0b'
            '29de3e60b330473ebf3d1ce26027c36276be324b4c904f0006ca2d6822fcc01a'
            'fbd3829c764da34249c4a597056def10932994dbca6b6bd7a83fae2b4b7a27e6'
            'b1c5741f0a875b6e2ec80f3fcc6588126a36f518d3ef0b40c40b1e203cd9af12'
            '5e36194e28722a354bc613d22cc31318fab0d88ea598fd16213363d3217e6d41'
            '76075f6950b0abf38162d8150bdb8d23cacfc82fce6b2edbca2d91400eef7724'
            'f9c26adfb3421345b79f76e2109470fa73eee3336def081c54dafef2e519a22e'
            '1a930acf0317f02f06af71e2f2ad55d8e8a92c06036c10575ffd6afd8ff9106a'
            '5580e578fa16d96a076972190d5bea06a48586da76a181065441260bda92503a'
            'eb04556df4572e61ce3cd7131e23a02720e0e39c9e015144eb05f21508978ee3'
            'e0ffed981a5c98c460904d03dd5c6978a3d84a33b97c90c6d07d8d827cad2f36'
            '83831f431ad639fac44d7669153fe45a8a4002b2d5e914224eeecda647401de3'
            'ffbc714531bec72d1a1e42204d6e1eb9271e1b0e4876d933025f97a0a319a27b'
            'c26e6762e5554590d118b612a867e56cb14bab770dcb6360708f38da5b601185'
            '466d581ce65717da63932f4e37ed453dbc55a17fa618d76668662cfc75c2d0eb'
            '8f3b2a796e2db1b1440f272c7dc87b24aca0f2d61cd07d1fffed29dd50034de6'
            '007ad4093a66755d73caa5924e92173dba8c73ed9597f39f1cc9072c3121a246'
            'fcf5022d4fc5a96aec1fa3b09eaf9e965d305577c534787b346c3dbf7659d0de'
            '187b2888edb7f768102af1602ef1cc6e907e3a8d4d34588b287275db2e4c0559'
            '585fce47ff678115a247a5914ae45dc2c70bf67655c3d90c58086ba4820050b6'
            '834d6cb306e7e684d41ae5ca336aeaf35d61465db4a0c29b730c88877f5ace06'
            'ed67023e9a032767055352dd914c00d21b6a3b4c8857ef38aca0c5631e46fff1'
            '4f72b72b33631d79ff4d556bd1695e1e251e9f0387a29e68488cc93cb7276629'
            '94c5e8656e2752440e782e6ba2a49a2ec16e4c3587dac59051390b83f44f118a'
            '7722c7aa1873c45449e62ff55bc7d7a8f6f5cc3bf0763fc94046932919e13593'
            '448621d288654a28784aec401a53039d41fbc68dd7c40a48275e3a013a8f78e9'
            '41a998b286451c8072f7e369f762b09b82e4badbea9e98cada28d41cb7eb6dde'
            'e1595df7feb72c5769f0f9dac4bc1eef3c612bf29eb36f3da8c1ff1a8c6442e5'
            '261208915bc975b0fb94ddc6c87cacc4ccf4af7cb0045092a58516905298989a'
            '175a40f9c376d071a95dcaf5d85a88fda3918dcd31d9978a488c82ccf0f66e6c'
            '5356f26ed4e6990f4061f12ec93277b2c746dcbafc2bf35f3de78b098968b342'
            'd747bedc176df04cd8785b8684e0925b7bfc2bb20782dc46ac9baef29c002b6f'
            '9429e8087148ef60e3dac3e0229a8333bc30ec8baa1bab0ecf2b906cb83175b8'
            'e00382f39ef6f57473a1fdab2bd1b60af05d1725962e59dd22a578b988aa953d'
            '06ca6799ad39b81ac9bdc7bc8b8c15257a5454238ab732829527c09456ab6b36'
            'e076d2532b0d3891acce920b34b2ef7da3a0414e69a6f18d170508c7108a7db7'
            '0ed34410ae6a064993c938dd3af2ad314cbf55ba159e940a527df1d983b04be7'
            'db2c9b54a890f01dcbb89d30bc9494762d1dfd8fe8c7bfd3e1cacd12c00513ef'
            '15a25ee8d94363529adeb0c0ceaeacb7e942f63b990e3831446fa70da8f0a05f'
            'da0deb7f491b00dcc4d58a9edf36e18ed1b1218b2cd78d52f0c7c977fd29e7a1'
            '97b9e32c6198372db3fdfcfcb5e961e33cb5680803c94365df5416b876bf489d'
            'b971bfc08e01fcd10ef566f5129464e27f23c2459aa1b5a82ee164185082bd47'
            '86655efc6ab59ea134fd425d480919f64d5f1a4720c2e9a683651254704ac030'
            '70ab3235552e4e96fb7c7f08ce76372b3bf902ac8fe154996f87256c56347a66'
            'cd8e3476df4af591efddadf7665c134e82c1589bfe6ef6ae3cc0e1c991594a45'
            '4cf3f5f00df1c2012124afcbf47ed6e59bd2d9ed726cf3e9ddafae09c0f3d60d'
            '20c5d73a79ef2437dfea4050dbbda874debe4ae820bf143b24d1aed481c75a69'
            '17be58baae3bb02127bf5de0d550ee2728e2e99a083fb49b9cfe9e719c710952'
            'c34c5d39d1afe3696f9c9a0d4ea92cb536a4ac975007d1ee12f313e6f75e471f'
            '50f36445b4479a149d2694161eecbf46a9af74679c77e0838f5f950e21c0a202'
            '35c7536c1cafad5c6e26fd474521b881769031c2b33c4eb58c4ea17012b3ac1e'
            '9a4a9887f6a153a985390f8c86fe7c6f7ac2cb278301855a87e2e72278e968c6'
            '918fa01b87924bc19ca8654e38af5965ad71a434aee70dd31c167ec436272223'
            '309ec7da1709d18b54c4d965f8c14e6d0c6a91659cca0067bf541362884de46d'
            'ff478997ac54905be6a1234a54d7d55144e8373f682c1a424a32f70cc606bc1c'
            '0700b793a47501668fcf16541b562439778e9c6fc3d960367c3aad8edb70419c'
            '01ec60d5b20bc6cb01aaa2e2c5a66e2ac2c782def62454fa1ab0541cf451e374'
            '96f4835afdb69c140b0435073ec63f49de2fa90807f4d4f870933ace90601b8e'
            '9cfcf6a92e0a81e27a462ebde916d581b1e024e40a97fa383270ab1142e7d838'
            '6d5ab6f8f63fc3128796619801d9d6002639f555466d65962c5e98edd7309f4e'
            '7c85a3a60185138a433100c021e9e32971129bb70c419956f81e6de0fb88ef93'
            '29f0998967f5a3d7483234f983a26c70189031d3524d83eae09c609b059d0d17'
            '60787eb9c4867f3069d251e3e8bc95c66a3dd33d40a0f98b78fcbf3343c8f9bd'
            '62839a602e7bd65d615bdbb891da2589c0a9fc1ba54149dbbdee78c4ad6fc98a'
            '3c5c906aa5f67496bcd64bca42a4aeae2358b05ad9050f273de1aefde73581d9'
            '5f5249fc6d6617b50534dfbb3994fe8745c0ffeb775d4fad8664b69f5d5549ce'
            'a1156687d70bd46dce3a03ab19a9ed302d3c9823611bd869671e2febb0f91e0f'
            '9353431f7449764e0e4978c50f313264bc8acbf8d1d1e52fc49ded2a5be0f7ff'
            '9ab77e7d2755a6aa9f39f7b3a9616208704d993cc217ccc92c589e5efe0d3d44'
            'b31baf4e0fd99ed53db1ede24ddd81e0149d7eebe4103200acf7fbfb2441fd37'
            '97e824c8e16382691d1dc7376c446859475c8bad8613c5f52fe4488adb278079'
            '7f0f4a733d13c8a11aada610f34dce365c380ecaec82c9059f202953c1318dbc')

